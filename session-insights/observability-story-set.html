<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Business Observability Requirements — Story Set Workspace</title>
  <style>
/* === Story Set Form — Data-Driven Application CSS === */
/* Extracted from builder output, signal-type CSS data-attribute selectors removed (replaced by Alpine x-show) */

:root {
  --po-accent: #2980B9;
  --po-tint: #EBF5FB;
  --dev-accent: #27AE60;
  --dev-tint: #E8F8F5;
  --platform-accent: #E67E22;
  --platform-tint: #FEF5E7;
  --through-accent: #8E44AD;
  --through-tint: #F4ECF7;
  /* WF Standard Gray Palette */
  --wf-gray-50:  #F9FAFB;
  --wf-gray-100: #F3F4F6;
  --wf-gray-200: #E5E7EB;
  --wf-gray-300: #D1D5DB;
  --wf-gray-400: #9CA3AF;
  --wf-gray-500: #6B7280;
  --wf-gray-700: #374151;
  --wf-gray-900: #111827;
  --card-radius: 8px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }
html { background: var(--wf-gray-100); }

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
  color: var(--wf-gray-700);
  line-height: 1.6;
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px 24px 80px 24px;
}

/* --- Document header --- */
.doc-header {
  border-bottom: 4px solid #D71E28;
  padding-bottom: 12px;
  margin-bottom: 8px;
}
.doc-header h1 {
  font-size: 24px;
  font-weight: bold;
  color: var(--wf-gray-700);
  margin-bottom: 4px;
}
.doc-header .subtitle {
  font-size: 14px;
  color: var(--wf-gray-500);
}

/* --- Epic banner (dark) --- */
.epic-banner {
  background: var(--wf-gray-900);
  color: #FFFFFF;
  padding: 16px 20px;
  border-radius: 6px;
  margin: 16px 0 24px 0;
}
.epic-banner .epic-label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--wf-gray-400);
  margin-bottom: 6px;
}
.epic-banner .epic-title {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 6px;
}
.epic-banner .epic-desc {
  font-size: 14px;
  color: var(--wf-gray-200);
  line-height: 1.5;
}
.epic-meta {
  display: flex;
  gap: 24px;
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid var(--wf-gray-700);
}
.epic-meta-item {
  font-size: 12px;
  color: var(--wf-gray-400);
}
.epic-meta-item strong {
  color: var(--wf-gray-200);
}

/* --- Tabs (raised style with top-border color) --- */
.tab-nav {
  display: flex;
  gap: 2px;
  margin-bottom: 0;
  border-bottom: 2px solid var(--wf-gray-200);
}
.tab-btn {
  padding: 10px 18px;
  font-size: 13px;
  font-weight: bold;
  border: none;
  background: var(--wf-gray-200);
  color: var(--wf-gray-500);
  cursor: pointer;
  border-radius: 6px 6px 0 0;
  transition: background 0.15s;
}
.tab-btn:hover { background: var(--wf-gray-200); }
.tab-btn.active { background: #FFFFFF; color: var(--wf-gray-700); border-bottom: 2px solid #FFFFFF; margin-bottom: -2px; }
.tab-btn.po { border-top: 3px solid transparent; }
.tab-btn.po.active { border-top-color: var(--po-accent); }
.tab-btn.dev { border-top: 3px solid transparent; }
.tab-btn.dev.active { border-top-color: var(--dev-accent); }
.tab-btn.plat { border-top: 3px solid transparent; }
.tab-btn.plat.active { border-top-color: var(--platform-accent); }
.tab-btn.how { border-top: 3px solid transparent; }
.tab-btn.how.active { border-top-color: var(--through-accent); }
.tab-btn.status { border-top: 3px solid transparent; }
.tab-btn.status.active { border-top-color: var(--wf-gray-500); }
.tab-btn.flow { border-top: 3px solid transparent; }
.tab-btn.flow.active { border-top-color: var(--through-accent); }

/* --- Tab panels --- */
.tab-panel {
  background: var(--wf-gray-50);
  padding: 28px 24px;
  border-radius: 0 0 var(--card-radius) var(--card-radius);
  border: 1px solid var(--wf-gray-200);
  border-top: none;
}

/* --- Story header (per tab) --- */
.story-header {
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid #E5E7EB;
}
.story-num {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 4px;
}
.story-num.po { color: var(--po-accent); }
.story-num.dev { color: var(--dev-accent); }
.story-num.plat { color: var(--platform-accent); }
.story-num.how { color: var(--through-accent); }
.story-num.status { color: var(--wf-gray-500); }
.story-num.flow { color: var(--through-accent); }
.story-header h2 {
  font-size: 20px;
  color: var(--wf-gray-700);
  margin-bottom: 10px;
}
.story-statement {
  font-size: 15px;
  color: var(--wf-gray-700);
  line-height: 1.7;
  padding: 12px 16px;
  background: var(--wf-gray-50);
  border-radius: 4px;
  border-left: 3px solid var(--wf-gray-200);
}
.story-statement strong { color: var(--wf-gray-700); }

/* --- AC Sections --- */
.ac-section { margin-bottom: 40px; }
.ac-section + .ac-section { margin-top: 12px; }
.ac-label {
  font-size: 13px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 10px 14px 10px 18px;
  margin: 0 -24px 12px -24px;
  border-radius: 2px;
}
.ac-label.po { color: var(--po-accent); background: var(--po-tint); border-left: 4px solid var(--po-accent); }
.ac-label.dev { color: var(--dev-accent); background: var(--dev-tint); border-left: 4px solid var(--dev-accent); }
.ac-label.plat { color: var(--platform-accent); background: var(--platform-tint); border-left: 4px solid var(--platform-accent); }
.ac-desc {
  font-size: 11px;
  color: var(--wf-gray-400);
  margin-bottom: 10px;
  line-height: 1.4;
}
.mirror-note {
  font-size: 12px;
  color: var(--wf-gray-500);
  font-style: italic;
  margin-bottom: 12px;
  padding: 6px 10px;
  background: var(--wf-gray-50);
  border-radius: 3px;
}

/* --- Cards --- */
.card {
  position: relative;
  background: #FFFFFF;
  border: 1px solid var(--wf-gray-200);
  border-radius: var(--card-radius);
  padding: 20px;
  margin-bottom: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
}
.po-card    { border-left: 3px solid var(--po-accent); }
.dev-card   { border-left: 3px solid var(--dev-accent); }
.platform-card { border-left: 3px solid var(--platform-accent); }
.po-card, .category-container  { --card-accent: var(--po-accent); --card-tint: var(--po-tint); }
.dev-card                       { --card-accent: var(--dev-accent); --card-tint: var(--dev-tint); }
.platform-card                  { --card-accent: var(--platform-accent); --card-tint: var(--platform-tint); }

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--wf-gray-100);
}
.card-number {
  font-size: 11px;
  color: var(--wf-gray-400);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.signal-ref {
  font-size: 13px;
  font-weight: 600;
  color: var(--wf-gray-700);
}
.mirror-context {
  font-size: 12px;
  color: var(--wf-gray-500);
  background: var(--wf-gray-50);
  padding: 6px 10px;
  border-radius: 3px;
  margin-bottom: 12px;
}
.remove-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  background: none;
  border: 1px solid var(--wf-gray-200);
  color: var(--wf-gray-400);
  font-size: 16px;
  cursor: pointer;
  width: 24px;
  height: 24px;
  border-radius: 3px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s ease;
  opacity: 0.5;
}
.remove-btn:hover { color: #E74C3C; border-color: #E74C3C; opacity: 1; }
.remove-chain-btn {
  background: transparent;
  border: none;
  color: var(--wf-gray-200);
  font-size: 16px;
  cursor: pointer;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  align-self: center;
  opacity: 0.6;
  transition: all 0.15s ease;
}
.remove-chain-btn:hover { opacity: 1; color: #E74C3C; }

/* --- Card name input --- */
.card-name-input {
  font-size: 15px;
  font-weight: bold;
  color: var(--wf-gray-700);
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
  background: transparent;
  border: none;
  border-bottom: 1px solid var(--wf-gray-200);
  padding: 2px 4px;
  width: 100%;
  outline: none;
  margin-bottom: 10px;
  transition: border-color 0.2s, background 0.2s;
}
.card-name-input:hover {
  background: var(--wf-gray-50);
  border-bottom-color: var(--wf-gray-400);
}
.card-name-input:focus {
  background: var(--card-tint, transparent);
  border-bottom-color: var(--card-accent, var(--wf-gray-400));
}

/* --- Field rows --- */
.field-list { display: flex; flex-direction: column; gap: 4px; }
.field-sub-header {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--wf-gray-500);
  padding: 10px 0 4px 0;
  margin-top: 6px;
  border-top: 1px solid var(--wf-gray-200);
}
.field-row {
  display: flex;
  align-items: baseline;
  padding: 5px 0;
  font-size: 14px;
  line-height: 1.5;
}
.field-label {
  flex: 0 0 200px;
  color: var(--wf-gray-500);
  font-size: 12px;
  white-space: nowrap;
}
.required { color: #E74C3C; }
.field-helper-text {
  font-size: 11px;
  color: var(--wf-gray-400);
  padding: 2px 0 6px 0;
  line-height: 1.4;
}

/* --- Field input: prose --- */
.field-input-prose {
  flex: 1;
  font-size: 13.5px;
  color: var(--wf-gray-700);
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
  background: transparent;
  border: none;
  border-bottom: 1px solid var(--wf-gray-200);
  padding: 2px 4px;
  outline: none;
  transition: border-color 0.2s, background 0.2s;
}
.field-input-prose::placeholder { color: var(--wf-gray-400); font-style: italic; }
.field-input-prose:hover {
  background: var(--wf-gray-50);
  border-bottom-color: var(--wf-gray-400);
}
.field-input-prose:focus,
textarea.field-input-prose:focus {
  background: var(--card-tint, transparent);
  border-bottom-color: var(--card-accent, var(--wf-gray-400));
}

/* --- Field input: code --- */
.field-input-code {
  flex: 1;
  font-size: 12.5px;
  color: var(--wf-gray-700);
  font-family: 'Courier New', Consolas, monospace;
  background: var(--wf-gray-100);
  border: 1px solid var(--wf-gray-200);
  border-radius: 3px;
  padding: 3px 8px;
  outline: none;
  transition: border-color 0.2s, background 0.2s;
}
.field-input-code::placeholder { color: var(--wf-gray-500); font-style: italic; }
.field-input-code:hover {
  background: var(--wf-gray-200);
  border-color: var(--wf-gray-400);
}
.field-input-code:focus {
  background: var(--wf-gray-300);
  border-color: var(--card-accent, var(--wf-gray-400));
}

textarea.field-input-prose,
textarea.field-input-code {
  resize: vertical;
  min-height: 42px;
}

/* --- Dropdown --- */
.meta-select {
  font-size: 11px;
  font-weight: bold;
  text-transform: uppercase;
  padding: 3px 8px;
  border-radius: 3px;
  border: 1px solid var(--wf-gray-200);
  cursor: pointer;
  outline: none;
  appearance: auto;
  transition: border-color 0.2s, background 0.2s;
}
.meta-select:hover { border-color: var(--wf-gray-400); }
.meta-select:focus { border-color: var(--card-accent, var(--wf-gray-400)); }

/* Badge colors */
.badge-impact-customer_experience { background: #EBF5FB; color: #1A5276; }
.badge-impact-financial { background: #FEF9E7; color: #7D6608; }
.badge-impact-legal_risk { background: #FDEDEC; color: #922B21; }
.badge-impact-operational { background: var(--wf-gray-100); color: var(--wf-gray-500); }
.badge-priority-CRITICAL { background: #FADBD8; color: #922B21; }
.badge-priority-HIGH { background: #FADBD8; color: #922B21; }
.badge-priority-MEDIUM { background: #FDEBD0; color: #935116; }
.badge-priority-LOW { background: #D5F5E3; color: #1E8449; }
.badge-signal-sli_ratio { background: #D4EFDF; color: #1E8449; }
.badge-signal-sli_threshold { background: #D6EAF8; color: #1A5276; }
.badge-signal-business_impact { background: #F9EBEA; color: #922B21; }

/* --- Add button --- */
.add-btn {
  display: inline-block;
  padding: 8px 16px;
  font-size: 13px;
  font-weight: 500;
  color: var(--wf-gray-500);
  background: var(--wf-gray-50);
  border: 1.5px dashed var(--wf-gray-300);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
  margin-top: 8px;
}
.add-btn:hover {
  color: var(--wf-gray-700);
  border-color: var(--wf-gray-500);
  background: var(--wf-gray-100);
}

/* --- Category Chain View (Section 1.2) --- */
.category-container {
  background: #FFFFFF;
  border: 1px solid var(--wf-gray-200);
  border-radius: var(--card-radius);
  padding: 16px 18px;
  margin-bottom: 16px;
  border-left: 4px solid var(--wf-gray-200);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
}
.category-container[data-category="customer_experience"] { border-left-color: #1A5276; }
.category-container[data-category="financial"] { border-left-color: #7D6608; }
.category-container[data-category="legal_risk"] { border-left-color: #922B21; }
.category-container[data-category="operational"] { border-left-color: var(--wf-gray-500); }

.category-header {
  font-size: 14px;
  font-weight: bold;
  text-transform: uppercase;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.category-container[data-category="customer_experience"] .category-header { color: #1A5276; }
.category-container[data-category="financial"] .category-header { color: #7D6608; }
.category-container[data-category="legal_risk"] .category-header { color: #922B21; }
.category-container[data-category="operational"] .category-header { color: var(--wf-gray-500); }

.cat-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}
.category-container[data-category="customer_experience"] .cat-dot { background: #1A5276; }
.category-container[data-category="financial"] .cat-dot { background: #7D6608; }
.category-container[data-category="legal_risk"] .cat-dot { background: #922B21; }
.category-container[data-category="operational"] .cat-dot { background: var(--wf-gray-500); }

.chain-row {
  display: flex;
  align-items: flex-start;
  gap: 0;
  padding: 8px 0;
  border-bottom: 1px solid var(--wf-gray-200);
}
.chain-row:last-of-type { border-bottom: none; }

.chain-segment {
  display: flex;
  flex-direction: column;
  border: 1px solid var(--wf-gray-200);
  border-radius: 4px;
  padding: 8px 10px;
  background: #FFFFFF;
}
.chain-segment.seg-stakeholder {
  flex: 0 0 180px;
}
.chain-segment.seg-stakeholder .card-name-input {
  font-size: 14px;
}
.chain-segment.seg-stakeholder .meta-select {
  background: transparent;
  color: var(--wf-gray-500);
}
.chain-segment.seg-expectation,
.chain-segment.seg-impact {
  flex: 1 1 auto;
  min-width: 200px;
}
.chain-segment-label {
  font-size: 11px;
  color: var(--wf-gray-500);
  margin-bottom: 2px;
}

.chain-arrow {
  color: var(--wf-gray-200);
  font-size: 16px;
  padding: 0 10px;
  align-self: center;
  flex-shrink: 0;
}

.category-empty {
  font-style: italic;
  color: var(--wf-gray-200);
  padding: 8px 0;
  font-size: 13px;
}

.empty-state {
  font-size: 13px;
  color: var(--wf-gray-400);
  font-style: italic;
  padding: 16px;
  text-align: center;
}

/* --- GQM Bridge Elements --- */
.bridge-element {
  background: var(--wf-gray-50);
  border: 1px solid var(--wf-gray-200);
  border-left: 4px solid #8E44AD;
  border-radius: var(--card-radius);
  padding: 16px 20px;
  margin: 20px 0;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
}
.bridge-header {
  font-size: 12px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: #8E44AD;
  margin-bottom: 12px;
}
.bridge-prompt {
  font-size: 13px;
  color: var(--wf-gray-500);
  margin-bottom: 16px;
  line-height: 1.5;
}
.bridge-prompt strong { font-weight: bold; }
.coverage-category { margin-top: 10px; }
.coverage-category-header {
  font-size: 11px;
  font-weight: bold;
  text-transform: uppercase;
}
.coverage-category-header .cat-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-right: 6px;
  vertical-align: middle;
}
.coverage-expectation {
  padding-left: 16px;
  font-size: 12.5px;
  color: var(--wf-gray-700);
  margin: 4px 0;
}
.coverage-stakeholder {
  font-size: 11px;
  color: var(--wf-gray-500);
}
.coverage-signals {
  padding-left: 28px;
  font-size: 12px;
  color: var(--wf-gray-700);
}
.coverage-signals .arrow { color: #27AE60; }
.coverage-gap {
  color: #E74C3C;
  font-style: italic;
}
.coverage-orphan {
  color: #E74C3C;
  font-style: italic;
  padding-left: 16px;
}
/* --- Bridge Summary Metrics Card (C8) --- */
.bridge-summary-metrics {
  display: flex;
  gap: 0;
  background: #FFFFFF;
  border: 1px solid var(--wf-gray-200);
  border-left: 4px solid var(--through-accent);
  border-radius: var(--card-radius);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
  margin-top: 20px;
  overflow: hidden;
}
.bridge-metric {
  flex: 1;
  text-align: center;
  padding: 16px 12px;
}
.bridge-metric + .bridge-metric {
  border-left: 1px solid var(--wf-gray-100);
}
.bridge-metric-value {
  display: block;
  font-size: 24px;
  font-weight: 700;
  color: var(--wf-gray-700);
  line-height: 1;
  margin-bottom: 6px;
}
.bridge-metric-zero {
  color: var(--wf-gray-400);
}
.bridge-metric-accent {
  color: var(--through-accent);
}
.bridge-metric-label {
  display: block;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--wf-gray-400);
}

/* --- Trace Checkbox Fields --- */
.trace-checkbox-list {
  padding: 6px 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.trace-checkbox {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12.5px;
  color: var(--wf-gray-700);
  cursor: pointer;
}
.trace-checkbox input[type="checkbox"] { cursor: pointer; }
.trace-badge {
  display: inline-block;
  font-size: 10px;
  text-transform: uppercase;
  padding: 1px 6px;
  border-radius: 3px;
  font-weight: bold;
}
.trace-checkbox .stakeholder-name {
  font-size: 11px;
  color: var(--wf-gray-500);
}
.trace-checkbox-list:focus-within {
  border-left: 2px solid var(--po-accent);
  padding-left: 4px;
}

/* --- Tables --- */
.through-line-table-wrapper { overflow-x: auto; }
.through-line-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12.5px;
  margin-bottom: 16px;
}
.through-line-table th {
  background: var(--wf-gray-100);
  font-weight: 600;
  text-align: left;
  padding: 8px 10px;
  border-bottom: 2px solid var(--wf-gray-200);
  font-size: 11px;
  text-transform: uppercase;
  color: var(--wf-gray-500);
  letter-spacing: 0.3px;
}
.through-line-table td {
  padding: 8px 10px;
  border-bottom: 1px solid var(--wf-gray-200);
  vertical-align: top;
  word-break: break-word;
}
.through-line-table .sig-name { font-weight: 600; }
.through-line-table tr:hover td { background: var(--wf-gray-50); }

/* --- Flow-step pattern --- */
.flow-step {
  display: flex;
  margin-bottom: 4px;
  align-items: stretch;
}
.flow-actor {
  flex: 0 0 90px;
  padding: 10px 12px;
  font-size: 12px;
  font-weight: bold;
  text-transform: uppercase;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px 0 0 4px;
  color: #FFFFFF;
}
.flow-actor.po { background: #2980B9; }
.flow-actor.dev { background: #27AE60; }
.flow-actor.plat { background: #E67E22; }
.flow-content {
  flex: 1;
  padding: 10px 14px;
  background: var(--wf-gray-50);
  border: 1px solid #E5E7EB;
  border-left: none;
  border-radius: 0 4px 4px 0;
  font-size: 13px;
  display: flex;
  align-items: center;
}
.flow-content .flow-fields {
  color: var(--wf-gray-500);
  font-size: 12px;
  margin-left: 8px;
}
.flow-arrow {
  text-align: center;
  padding: 2px 0;
  color: var(--wf-gray-400);
  font-size: 18px;
  margin-left: 40px;
}

/* --- Causal chain pattern --- */
.causal-chain { margin: 16px 0; }
.causal-step {
  display: flex;
  margin-bottom: 4px;
  align-items: stretch;
}
.causal-layer {
  flex: 0 0 110px;
  padding: 12px 10px;
  font-size: 11px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-radius: 4px 0 0 4px;
  color: #FFFFFF;
  text-align: center;
  line-height: 1.3;
}
.causal-layer .layer-num { font-size: 13px; margin-bottom: 2px; }
.causal-layer.l1 { background: var(--wf-gray-500); }
.causal-layer.l2 { background: #935116; }
.causal-layer.l3 { background: #922B21; }
.causal-layer.l4 { background: #1A5276; }
.causal-content {
  flex: 1;
  padding: 10px 14px;
  background: var(--wf-gray-50);
  border: 1px solid #E5E7EB;
  border-left: none;
  border-radius: 0 4px 4px 0;
  font-size: 13px;
}
.causal-content strong { color: var(--wf-gray-700); }
.causal-content .causal-actor {
  font-size: 11px;
  color: var(--wf-gray-500);
  margin-top: 2px;
}
.causal-arrow {
  text-align: center;
  padding: 2px 0;
  color: var(--wf-gray-400);
  font-size: 18px;
  margin-left: 50px;
}

/* --- Actor badges --- */
.actor-badge {
  display: inline-block;
  font-size: 11px;
  font-weight: bold;
  text-transform: uppercase;
  padding: 2px 8px;
  border-radius: 3px;
  color: #FFFFFF;
}
.actor-badge.po { background: #2980B9; }
.actor-badge.dev { background: #27AE60; }
.actor-badge.plat { background: #E67E22; }

/* --- Layer sub-tabs --- */
.layer-tab-nav {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
  padding: 8px 0;
  border-bottom: 1px solid #E5E7EB;
}
.layer-tab-btn {
  padding: 6px 14px;
  font-size: 12px;
  font-weight: 600;
  border: 1px solid var(--wf-gray-200);
  border-radius: 4px;
  background: var(--wf-gray-50);
  color: var(--wf-gray-500);
  cursor: pointer;
}
.layer-tab-btn:hover { background: var(--wf-gray-200); }
.layer-tab-btn.active {
  background: var(--wf-gray-900);
  color: #FFFFFF;
  border-color: var(--wf-gray-900);
}
.layer-panel { display: none; }
.layer-panel.active { display: block; }

/* --- Dashboard Preview tab --- */
.dash-section {
  background: #fff;
  border: 1px solid var(--wf-gray-200);
  border-radius: 6px;
  padding: 16px 20px;
  margin-bottom: 16px;
}
.dash-section-heading {
  font-size: 16px;
  font-weight: bold;
  margin-bottom: 12px;
}
.dash-ac-ref {
  font-size: 11px;
  color: var(--wf-gray-500);
  font-weight: normal;
  margin-left: 8px;
}
.dash-layer-card {
  border: 1px solid #E5E7EB;
  border-radius: 4px;
  padding: 12px 16px;
  margin-bottom: 12px;
}
.dash-layer-badge {
  font-size: 11px;
  font-weight: bold;
  color: #fff;
  padding: 2px 8px;
  border-radius: 3px;
  margin-right: 8px;
}
.dash-signal-row {
  display: grid;
  grid-template-columns: auto 1fr auto auto;
  gap: 12px;
  align-items: center;
  padding: 6px 0;
  border-bottom: 1px solid rgba(0,0,0,0.05);
}
.dash-signal-row-impact {
  display: grid;
  grid-template-columns: auto 1fr auto auto;
  gap: 12px;
  align-items: center;
  padding: 6px 0;
  border-bottom: 1px solid rgba(0,0,0,0.05);
}
.dash-status-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
}
.dash-impact-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.dash-impact-card {
  padding: 14px;
  border-radius: 6px;
  border: 1px solid #E5E7EB;
}
.dash-ops-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}
.dash-stakeholder-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}
.dash-stakeholder-table th {
  text-align: left;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--wf-gray-500);
  padding: 8px 10px;
  border-bottom: 2px solid var(--wf-gray-200);
}
.dash-stakeholder-table td {
  padding: 8px 10px;
  border-bottom: 1px solid var(--wf-gray-100);
  vertical-align: top;
}
/* --- Completeness evaluation --- */
.completeness-dim { margin: 12px 0; }
.completeness-dim strong { font-size: 14px; }
.completeness-missing { padding-left: 16px; font-size: 12.5px; color: #E74C3C; }
.completeness-ok { color: #27AE60; }
/* --- Dashboard meta label --- */
.dash-meta-label { font-size: 11px; font-weight: 600; text-transform: uppercase; color: var(--wf-gray-500); }

/* --- Print-friendly --- */
@media print {
  .tab-nav { display: none; }
  .tab-panel { display: block !important; page-break-inside: avoid; }
}

/* --- Service Manager View --- */
.service-manager { max-width: 1200px; margin: 0 auto; padding: 24px 0; }
.service-manager h2 { font-size: 20px; color: var(--wf-gray-700); margin-bottom: 4px; }
.service-manager .manager-subtitle { font-size: 14px; color: var(--wf-gray-500); margin-bottom: 24px; }
.service-manager .empty-message { font-size: 14px; color: var(--wf-gray-500); margin-bottom: 24px; }

.service-card {
  background: white; border: 1px solid var(--wf-gray-200); border-radius: 6px;
  padding: 16px; margin-bottom: 12px; cursor: pointer;
  display: flex; justify-content: space-between; align-items: center;
}
.service-card:hover { border-color: var(--wf-gray-400); }
.service-card-info { flex: 1; }
.service-card-name { font-size: 16px; color: var(--wf-gray-700); font-weight: bold; }
.service-card-meta { font-size: 12px; color: var(--wf-gray-500); margin-top: 4px; }
.service-card-completion { font-size: 11px; color: var(--wf-gray-500); margin-top: 2px; }
.service-card-actions { display: flex; gap: 8px; }
.service-card-delete {
  background: none; border: 1px solid #E74C3C; color: #E74C3C;
  border-radius: 4px; padding: 4px 10px; font-size: 12px; cursor: pointer;
}
.service-card-delete:hover { background: #FDEDEC; }
.service-card-clone {
  background: none; border: 1px solid var(--wf-gray-200); color: var(--wf-gray-500);
  border-radius: 4px; padding: 4px 10px; font-size: 12px; cursor: pointer;
}
.service-card-clone:hover { background: var(--wf-gray-100); }

.manager-actions { display: flex; gap: 12px; margin-bottom: 24px; }
.btn-new-service {
  padding: 8px 20px; border-radius: 4px; font-size: 14px; cursor: pointer;
  background: white; border: 1px solid #27AE60; color: #27AE60;
}
.btn-new-service:hover { background: #E8F8F5; }
.btn-import {
  padding: 8px 20px; border-radius: 4px; font-size: 14px; cursor: pointer;
  background: white; border: 1px solid var(--wf-gray-500); color: var(--wf-gray-500);
}
.btn-import:hover { background: var(--wf-gray-100); }

/* --- Service pill bar --- */
.service-pill-bar {
  display: flex; gap: 8px; padding: 8px 0; margin-bottom: 12px;
  border-bottom: 1px solid var(--wf-gray-200); align-items: center; flex-wrap: wrap;
}
.service-pill {
  padding: 6px 16px; border-radius: 16px; border: 1px solid var(--wf-gray-200);
  background: white; cursor: pointer; font-size: 13px; color: var(--wf-gray-700);
}
.service-pill:hover { border-color: var(--wf-gray-400); }
.service-pill.active { background: var(--wf-gray-700); color: white; border-color: var(--wf-gray-700); }
.pill-all-services {
  font-size: 12px; color: var(--wf-gray-500); margin-left: auto; cursor: pointer;
  background: none; border: none; text-decoration: underline;
}
.pill-all-services:hover { color: var(--wf-gray-700); }

/* --- Export status bar --- */
.export-status-bar {
  position: fixed; bottom: 0; left: 0; right: 0;
  padding: 8px 16px; font-size: 12px;
  border-top: 1px solid var(--wf-gray-200); background: white;
  display: flex; align-items: center; justify-content: space-between;
  z-index: 100;
}
.export-status-text.green { color: #27AE60; }
.export-status-text.amber { color: #E67E22; }
.export-status-text.red { color: #E74C3C; }
.export-btn-bar { display: flex; gap: 8px; }
.export-btn-bar button {
  padding: 4px 12px; border-radius: 4px; font-size: 12px; cursor: pointer;
  background: white; border: 1px solid var(--wf-gray-200); color: var(--wf-gray-700);
}
.export-btn-bar button:hover { background: var(--wf-gray-100); }
.workspace-actions {
  margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--wf-gray-200);
  display: flex; align-items: center; gap: 8px;
}
.workspace-actions-label { font-size: 12px; color: var(--wf-gray-500); }
.btn-reset, .btn-reset-example {
  color: var(--wf-gray-500); border: 1px solid var(--wf-gray-200); background: transparent;
  font-size: 12px; padding: 4px 12px; border-radius: 4px; cursor: pointer;
}
.btn-reset:hover, .btn-reset-example:hover { color: #E74C3C; background: #FDF2F2; }
/* Severity badges (Phase 9 - P0-2) */
.severity-badge {
  display: inline-block;
  font-size: 10px;
  font-weight: bold;
  text-transform: uppercase;
  padding: 1px 6px;
  border-radius: 3px;
  margin-left: 4px;
}
.severity-warning { background: #FEF9E7; color: #B7950B; }
.severity-critical { background: #FDEDEC; color: #C0392B; }
/* Example Library (Phase 10) */
.example-library { margin-bottom: 24px; }
.section-header { font-size: 14px; font-weight: bold; color: var(--wf-gray-500); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.section-dot.example-dot { width: 8px; height: 8px; border-radius: 50%; background: #8E44AD; display: inline-block; }
.example-card { border: 1px solid var(--wf-gray-200); border-left: 3px solid #8E44AD; border-radius: 4px; padding: 12px 16px; margin-bottom: 8px; background: white; display: flex; flex-direction: column; gap: 4px; }
.example-card:hover { background: rgba(142, 68, 173, 0.03); }
.example-card-header { display: flex; align-items: center; gap: 8px; }
.archetype-badge { display: inline-block; font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 10px; background: #8E44AD; color: white; text-transform: uppercase; }
.example-name { font-weight: bold; font-size: 14px; color: var(--wf-gray-700); }
.example-card-desc { font-size: 12px; color: var(--wf-gray-500); line-height: 1.4; }
.example-card-domain { font-size: 11px; color: var(--wf-gray-500); }
.example-card-actions { display: flex; justify-content: flex-end; align-items: center; gap: 8px; margin-top: 4px; }
.btn-load { padding: 4px 16px; border-radius: 4px; font-size: 12px; cursor: pointer; background: #8E44AD; color: white; border: none; }
.btn-load:hover { background: #7D3C98; }
.loaded-indicator { color: #27AE60; font-size: 12px; font-weight: bold; }
.example-card .btn-reset-example { background: none; border: none; color: var(--wf-gray-500); font-size: 11px; cursor: pointer; text-decoration: underline; padding: 0; }
.example-card .btn-reset-example:hover { color: var(--wf-gray-500); }
/* Service Definition Guide (Phase 10) */
.service-guide {
  margin-bottom: 14px;
}
.service-guide-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  background: var(--wf-gray-100);
  border-left: 3px solid var(--wf-gray-400);
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  color: var(--wf-gray-500);
  user-select: none;
}
.service-guide-header:hover {
  background: var(--wf-gray-200);
}
.service-guide-indicator {
  font-size: 12px;
  transition: transform 0.2s;
}
.service-guide-body {
  padding: 14px;
  border: 1px solid var(--wf-gray-200);
  border-top: none;
  border-radius: 0 0 6px 6px;
  background: var(--wf-gray-100);
  font-size: 13px;
  line-height: 1.6;
  color: var(--wf-gray-700);
}
.pattern-card {
  padding: 10px 12px;
  margin-bottom: 8px;
  background: white;
  border: 1px solid var(--wf-gray-200);
  border-radius: 4px;
}
.pattern-card:last-child {
  margin-bottom: 0;
}
.pattern-name {
  font-weight: 600;
  font-size: 13px;
  color: var(--wf-gray-700);
  margin-bottom: 4px;
}
.pattern-desc {
  font-size: 12px;
  color: var(--wf-gray-500);
  margin-bottom: 4px;
}
.pattern-example {
  font-size: 12px;
  color: var(--wf-gray-500);
  font-style: italic;
}
.pattern-best-when {
  font-size: 11px;
  color: var(--wf-gray-400);
  margin-top: 4px;
}
.granularity-test {
  margin-top: 12px;
  padding: 10px 14px;
  background: white;
  border-left: 3px solid var(--wf-gray-300);
  border-radius: 0 4px 4px 0;
  font-size: 12px;
  line-height: 1.6;
}
.granularity-test strong {
  font-size: 13px;
  color: var(--wf-gray-700);
}

/* --- Grounding Page --- */
.grounding-label {
  font-size: 13px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 10px 14px;
  margin: 0 0 12px 0;
  border-radius: 2px;
  color: var(--wf-gray-500);
  background: var(--wf-gray-100);
}
.grounding-panel {
  background: #FFFFFF;
  padding: 20px 24px;
  border-radius: 6px;
  border: 1px solid var(--wf-gray-200);
  margin-bottom: 20px;
}
.objective-cards {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}
.objective-card {
  flex: 1;
  min-width: 280px;
  background: white;
  border: 1px solid var(--wf-gray-200);
  border-radius: 6px;
  padding: 16px 18px;
  border-top: 3px solid var(--wf-gray-300);
  display: flex;
  flex-direction: column;
}
.objective-card .objective-summary {
  flex: 1;
}
.objective-card h4 {
  font-size: 14px;
  font-weight: bold;
  color: var(--wf-gray-700);
  margin-bottom: 8px;
}
.objective-summary {
  font-size: 13px;
  color: var(--wf-gray-700);
  margin-bottom: 12px;
  line-height: 1.5;
}
.objective-card ul {
  list-style: none;
  padding: 0;
  margin: 0 0 12px 0;
}
.objective-card li {
  font-size: 12px;
  color: var(--wf-gray-500);
  padding: 4px 0 4px 12px;
  border-left: 2px solid var(--wf-gray-200);
  margin-bottom: 4px;
  line-height: 1.4;
}
.measures-label {
  font-size: 11px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--wf-gray-400);
  margin-bottom: 6px;
  margin-top: 4px;
}
.objective-card .measure-item {
  font-size: 12px;
  color: var(--wf-gray-700);
  padding: 3px 0 3px 12px;
  border-left: 2px solid var(--wf-gray-400);
  margin-bottom: 3px;
  line-height: 1.4;
}
/* ═══════════════════════════════════════════════════
   EMBEDDED PERSONA FLOW GRAPHIC
   ═══════════════════════════════════════════════════ */
.persona-bar {
  position: relative;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 0 0 10px;
  padding: 0 86px 0 56px;
}
.persona-bar-track {
  position: absolute;
  top: 50%;
  left: 0;
  width: 100%;
  height: 8px;
  transform: translateY(-50%);
  display: flex;
  border-radius: 999px;
  overflow: hidden;
  z-index: 0;
}
.persona-bar-track .seg-po  { flex: 1; background: var(--po-accent); }
.persona-bar-track .seg-dev { flex: 1; background: var(--dev-accent); }
.persona-bar-track .seg-ops { flex: 1; background: var(--platform-accent); }
.persona-circle {
  position: relative;
  z-index: 1;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  border: 2.5px solid;
  background: white;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  box-shadow: 0 1px 4px rgba(0,0,0,0.10);
}
.persona-circle.po  { border-color: var(--po-accent); }
.persona-circle.dev { border-color: var(--dev-accent); }
.persona-circle.ops { border-color: var(--platform-accent); }
.persona-circle .abbrev {
  font-size: 16px;
  font-weight: 700;
  color: var(--wf-gray-900);
  line-height: 1;
}
.persona-circle .role-name {
  font-size: 8px;
  text-transform: uppercase;
  font-weight: 600;
  color: var(--wf-gray-500);
  line-height: 1.1;
  margin-top: 1px;
  text-align: center;
}
.persona-rows {
  position: relative;
  padding: 0 24px;
}
.persona-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 4px;
}
.persona-row:last-child {
  margin-bottom: 0;
}
.row-label {
  width: 120px;
  min-width: 120px;
  display: flex;
  align-items: center;
  padding: 2px 10px;
  border-radius: 0 4px 4px 0;
  border-left: 5px solid;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  color: var(--wf-gray-700);
}
.row-label.po  { border-color: var(--po-accent);  background: rgba(41,128,185,0.08); }
.row-label.dev { border-color: var(--dev-accent); background: rgba(39,174,96,0.08); }
.row-label.ops { border-color: var(--platform-accent); background: rgba(230,126,34,0.08); }
.row-desc {
  flex: 1;
  border: 1.5px solid;
  border-radius: 8px;
  padding: 4px 12px;
  background: white;
  font-size: 13px;
  color: var(--wf-gray-700);
  line-height: 1.45;
  display: flex;
  align-items: center;
}
.row-desc.po  { border-color: var(--po-accent); }
.row-desc.dev { border-color: var(--dev-accent); }
.row-desc.ops { border-color: var(--platform-accent); }
.row-desc p, .row-output p {
  margin: 0;
}
.row-desc strong {
  color: var(--wf-gray-900);
}
.row-output {
  width: 160px;
  min-width: 160px;
  border: 1.5px solid;
  border-radius: 6px;
  padding: 4px 10px;
  background: white;
  font-size: 12px;
  color: var(--wf-gray-700);
  line-height: 1.4;
  display: flex;
  align-items: center;
}
.row-output.po  { border-color: var(--po-accent); }
.row-output.dev { border-color: var(--dev-accent); }
.row-output.ops { border-color: var(--platform-accent); }
.row-output strong {
  color: var(--wf-gray-900);
}
.row-connector {
  width: 24px;
  margin-left: -8px;
  margin-right: -8px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.row-connector .dash {
  height: 2px;
  width: 100%;
}
.row-connector .dash.po  { background: var(--po-accent); }
.row-connector .dash.dev { background: var(--dev-accent); }
.row-connector .dash.ops { background: var(--platform-accent); }
.feedback-box {
  margin-top: 6px;
  background: var(--wf-gray-100);
  border: 1px solid var(--wf-gray-300);
  border-radius: 8px;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.feedback-box .sync-icon {
  width: 22px;
  height: 22px;
  color: var(--wf-gray-400);
  animation: spin-slow 3s linear infinite;
  flex-shrink: 0;
}
@keyframes spin-slow {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
.feedback-box p {
  font-size: 13px;
  color: var(--wf-gray-700);
  line-height: 1.4;
  margin: 0;
}
.feedback-box strong {
  color: var(--wf-gray-900);
  letter-spacing: 0.3px;
}
.persona-footer {
  margin-top: 8px;
  text-align: center;
  font-size: 13px;
  font-style: italic;
  color: var(--wf-gray-700);
  line-height: 1.4;
}
.grounding-cta {
  text-align: center;
  padding: 24px 0;
}
.btn-enter-workspace {
  padding: 12px 32px;
  border-radius: 6px;
  font-size: 16px;
  font-weight: 600;
  background: var(--wf-gray-900);
  color: white;
  border: none;
  cursor: pointer;
  letter-spacing: 0.3px;
}
.btn-enter-workspace:hover {
  background: var(--wf-gray-700);
}
.grounding-cta .secondary-text {
  font-size: 12px;
  color: var(--wf-gray-400);
  margin-top: 10px;
}
.about-link {
  font-size: 12px;
  color: var(--wf-gray-500);
  cursor: pointer;
  margin-bottom: 12px;
  display: inline-block;
}
.about-link:hover {
  text-decoration: underline;
}
  </style>
</head>
<body>

<!-- ═══════════════════════════════════════════════════════════════════
     SCRIPT LOADING ORDER:
     1. Constants + helper functions (no Alpine dependency)
     2. alpine:init event listener (Alpine ref only inside handler)
     3. Alpine.js source (defines window.Alpine, auto-start STRIPPED)
     4. HTML body with x-data elements (parsed after scripts)
     5. Alpine.start() at end of body (after DOM is ready)
     ═══════════════════════════════════════════════════════════════════ -->

<!-- 1. Application constants and helper functions -->
<script>
// ── Category definitions ──
var CATEGORY_COLORS = {
  customer_experience: { name: 'Customer Experience', bg: '#EBF5FB', text: '#2980B9', dot: '#2980B9' },
  financial:           { name: 'Financial Impact',    bg: '#FEF9E7', text: '#B7950B', dot: '#B7950B' },
  legal_risk:          { name: 'Legal & Compliance Risk', bg: '#FDEDEC', text: '#C0392B', dot: '#C0392B' },
  operational:         { name: 'Operational Efficiency', bg: '#E8F8F5', text: '#1ABC9C', dot: '#1ABC9C' },
};
var CATEGORY_ORDER = ['customer_experience', 'financial', 'legal_risk', 'operational'];

var CATEGORY_COLORS_BADGE = {
  customer_experience: { bg: '#EBF5FB', text: '#1A5276' },
  financial:           { bg: '#FEF9E7', text: '#7D6608' },
  legal_risk:          { bg: '#FDEDEC', text: '#922B21' },
  operational:         { bg: 'var(--wf-gray-100)', text: 'var(--wf-gray-500)' },
};

// ── Dropdown options ──
var DROPDOWN_OPTS = {
  priority: [
    { value: 'CRITICAL', label: 'Critical' },
    { value: 'HIGH', label: 'High' },
    { value: 'MEDIUM', label: 'Medium' },
    { value: 'LOW', label: 'Low' },
  ],
  signalType: [
    { value: 'sli_ratio', label: 'Ratio' },
    { value: 'sli_threshold', label: 'Threshold' },
    { value: 'business_impact', label: 'Impact' },
  ],
  signalTypeL3: [
    { value: 'sli_ratio', label: 'Ratio' },
    { value: 'sli_threshold', label: 'Threshold' },
  ],
  signalTypeL2: [
    { value: 'sli_ratio', label: 'Ratio' },
    { value: 'sli_threshold', label: 'Threshold' },
  ],
  signalTypeL1: [
    { value: 'sli_ratio', label: 'Ratio' },
    { value: 'sli_threshold', label: 'Threshold' },
  ],
  thresholdOperator: [
    { value: 'lt', label: '< (less than)' },
    { value: 'gt', label: '> (greater than)' },
    { value: 'lte', label: '<= (less or equal)' },
    { value: 'gte', label: '>= (greater or equal)' },
    { value: 'eq', label: '== (equals)' },
  ],
  thresholdUnit: [
    { value: '%', label: '%' },
    { value: 'ms', label: 'ms' },
    { value: 'seconds', label: 'seconds' },
    { value: 'count', label: 'count' },
    { value: 'errors/min', label: 'errors/min' },
    { value: 'requests/sec', label: 'requests/sec' },
    { value: 'bytes', label: 'bytes' },
    { value: 'minutes', label: 'minutes' },
    { value: 'days', label: 'days' },
  ],
  impactCategory: CATEGORY_ORDER.map(function(code) {
    return { value: code, label: CATEGORY_COLORS[code].name };
  }),
  tier: [
    { value: 'Tier 1', label: 'Tier 1' },
    { value: 'Tier 2', label: 'Tier 2' },
    { value: 'Tier 3', label: 'Tier 3' },
  ],
  dataSource: [
    { value: 'Splunk', label: 'Splunk' },
    { value: 'AppDynamics', label: 'AppDynamics' },
    { value: 'Dynatrace', label: 'Dynatrace' },
    { value: 'ThousandEyes', label: 'ThousandEyes' },
    { value: 'Grafana', label: 'Grafana' },
    { value: 'Custom', label: 'Custom' },
  ],
  severity: [
    { value: 'warning', label: 'Warning' },
    { value: 'critical', label: 'Critical' },
  ],
  status: [
    { value: 'draft', label: 'Draft' },
    { value: 'active', label: 'Active' },
    { value: 'production', label: 'Production' },
    { value: 'deprecated', label: 'Deprecated' },
    { value: 'retired', label: 'Retired' },
  ],
};

// ── Functional Category Suggestions (BIAN-informed, not BIAN-compliant) ──
var FUNCTIONAL_CATEGORIES = [
  'Credit Assessment', 'Payments Processing', 'Collateral Management',
  'Loan Origination', 'Account Administration', 'Customer Onboarding',
  'Wire Transfer', 'Card Processing', 'Fraud Detection',
  'Regulatory Reporting', 'Document Management', 'Customer Communication',
  'Rate Management', 'Underwriting', 'Disbursement', 'Servicing', 'Collections',
];

// ── Seed Data (embedded from seed-data/credit-check.json) ──
var SEED_DATA = {
  'credit-check': {
    name: 'Credit Check Service',
    isExample: true,
    created: '2025-11-23 14:08:17',
    updated: '2025-11-23 14:08:17',
    identity: {
      serviceName: 'Credit Check Service',
      serviceId: 'SVC_CC_001',
      description: 'Validate borrower creditworthiness for loan approval decisions',
      tier: 'Tier 2',
      productLine: 'Consumer Lending',
      businessDomain: 'Consumer Lending',
      functionalCategory: 'Credit Assessment',
      orgProduct: 'PROD-CL-001',
      technicalOwner: 'robert.kim@example.com',
      status: 'active',
    },
    stakeholders: [
      { id: 'ctx-svc002-001', stakeholder: 'Loan Applicants', expectationStatement: 'Credit checks return valid scores within acceptable timeframe', impactDescription: 'Customer Impact: Loan applicants unable to proceed with application', impactCategory: 'customer_experience', priority: 'HIGH' },
      { id: 'ctx-svc002-002', stakeholder: 'Consumer Lending', expectationStatement: 'Credit checks complete successfully without failures', impactDescription: 'Financial Impact: Lost loan origination revenue opportunity', impactCategory: 'financial', priority: 'HIGH' },
      { id: 'ctx-svc002-003', stakeholder: 'Regulatory Body', expectationStatement: 'Credit checks meet FCRA 30-day timing requirements', impactDescription: 'Compliance Risk: Regulatory compliance violation risk', impactCategory: 'legal_risk', priority: 'HIGH' },
      { id: 'ctx-svc002-004', stakeholder: 'Loan Processors', expectationStatement: 'Credit checks complete successfully without manual intervention', impactDescription: 'Operational Impact: Manual workarounds reduce processing capacity', impactCategory: 'operational', priority: 'MEDIUM' },
    ],
    signals: [
      { id: 'sig-svc002-001', name: 'Credit Check Success Rate', signalType: 'sli_ratio', layer: 'L3', whatItTellsMe: 'Credit check returns valid score within 30 seconds', sloTarget: 85, timeWindow: '1h', whyThisTarget: 'Credit bureau connectivity issues expected; focus on rapid recovery', impactCategory: '', impactUnit: '', queryNumerator: "status='SUCCESS' AND score BETWEEN 300 AND 850 AND response_time_ms<30000", queryDenominator: "request_type='CREDIT_CHECK'", technicalOwner: 'platform-engineering-team', alertThreshold: 80, pageThreshold: 75, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=app_events', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc002-001', 'ctx-svc002-002'], quantifies: [] },
      { id: 'sig-svc002-002', name: 'Customers Blocked', signalType: 'business_impact', layer: 'L4', whatItTellsMe: 'Loan applicants unable to proceed due to missing credit scores', sloTarget: null, timeWindow: '', whyThisTarget: '', impactCategory: 'customer_experience', impactUnit: 'customers', queryNumerator: 'COUNT(DISTINCT applicant_id) WHERE credit_score IS NULL', queryDenominator: '', technicalOwner: 'platform-engineering-team', alertThreshold: null, pageThreshold: null, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=app_events', alertSeverity: 'warning', pageSeverity: 'critical', quantifies: ['ctx-svc002-001'], verifies: [] },
      { id: 'sig-svc002-003', name: 'Loan Revenue at Risk', signalType: 'business_impact', layer: 'L4', whatItTellsMe: 'Loan origination revenue opportunity lost to failed credit checks', sloTarget: null, timeWindow: '', whyThisTarget: '', impactCategory: 'financial', impactUnit: 'dollars', queryNumerator: "SUM(loan_amount) WHERE credit_check_status='FAILED'", queryDenominator: '', technicalOwner: 'platform-engineering-team', alertThreshold: null, pageThreshold: null, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=app_events', alertSeverity: 'warning', pageSeverity: 'critical', quantifies: ['ctx-svc002-002'], verifies: [] },
      { id: 'sig-svc002-004', name: 'FCRA Timing Violations', signalType: 'business_impact', layer: 'L4', whatItTellsMe: 'Credit checks exceeding 30-day FCRA requirement', sloTarget: null, timeWindow: '', whyThisTarget: '', impactCategory: 'legal_risk', impactUnit: 'violations', queryNumerator: 'COUNT(*) WHERE response_time_days > 30', queryDenominator: '', technicalOwner: 'platform-engineering-team', alertThreshold: null, pageThreshold: null, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=app_events', alertSeverity: 'warning', pageSeverity: 'critical', quantifies: ['ctx-svc002-003'], verifies: [] },
      { id: 'sig-svc002-005', name: 'Manual Interventions Required', signalType: 'business_impact', layer: 'L4', whatItTellsMe: 'Credit check failures requiring manual processor intervention', sloTarget: null, timeWindow: '', whyThisTarget: '', impactCategory: 'operational', impactUnit: 'interventions', queryNumerator: "COUNT(*) WHERE requires_manual_review='TRUE'", queryDenominator: '', technicalOwner: 'platform-engineering-team', alertThreshold: null, pageThreshold: null, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=app_events', alertSeverity: 'warning', pageSeverity: 'critical', quantifies: ['ctx-svc002-004'], verifies: [] },
      { id: 'sig-svc002-006', name: 'Credit Score Retrieval %', signalType: 'sli_ratio', layer: 'L3', whatItTellsMe: 'Credit scores successfully retrieved from bureau', sloTarget: 99.5, timeWindow: '1h', whyThisTarget: 'Credit score retrieval success rate', impactCategory: '', impactUnit: '', queryNumerator: "status='SUCCESS' AND score IS NOT NULL", queryDenominator: "request_type='CREDIT_CHECK'", technicalOwner: 'platform-engineering-team', alertThreshold: 97, pageThreshold: 95, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=app_events', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc002-001'], quantifies: [] },
      { id: 'sig-svc002-007', name: 'Valid Score Return Rate', signalType: 'sli_ratio', layer: 'L3', whatItTellsMe: 'Credit bureau returns valid scorable response', sloTarget: 99.8, timeWindow: '1h', whyThisTarget: 'Valid score return ensures accurate lending decisions', impactCategory: '', impactUnit: '', queryNumerator: "score_valid=true AND score_range='300-850'", queryDenominator: "request_status='COMPLETE'", technicalOwner: 'platform-engineering-team', alertThreshold: 99, pageThreshold: 98, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=app_events', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc002-001'], quantifies: [] },
      { id: 'sig-svc002-008', name: 'Credit Check Response Time', signalType: 'sli_threshold', layer: 'L2', whatItTellsMe: 'End-to-end credit check request completes within acceptable time for applicant experience', sloTarget: 5, timeWindow: '1h', whyThisTarget: 'Loan applicants expect near-instant decisioning; 5-second threshold balances bureau response variability with applicant experience', impactCategory: '', impactUnit: '', queryNumerator: 'response_time_seconds', queryDenominator: '', technicalOwner: 'platform-engineering-team', alertThreshold: 7, pageThreshold: 10, thresholdOperator: 'lt', thresholdUnit: 'seconds', dataSource: 'Splunk', dataSourceDetails: 'index=app_events', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc002-001'], quantifies: [] },
      { id: 'sig-svc002-009', name: 'Bureau Connection Health', signalType: 'sli_threshold', layer: 'L1', whatItTellsMe: 'Credit bureau API connections succeed at rate sufficient to support credit check processing', sloTarget: 95, timeWindow: '1h', whyThisTarget: 'Bureau connection failures directly cause credit check failures; 95% accounts for routine network variability while catching sustained outages', impactCategory: '', impactUnit: '', queryNumerator: 'SELECT AVG(connection_success) FROM bureau_health', queryDenominator: '', technicalOwner: 'platform-engineering-team', alertThreshold: 90, pageThreshold: 85, thresholdOperator: 'gte', thresholdUnit: 'percent', dataSource: 'AppDynamics', dataSourceDetails: 'credit-bureau-api health check', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc002-002', 'ctx-svc002-004'], quantifies: [] },
    ],
    operational: {
      alertNotificationTargets: 'page:platform-oncall',
      escalationPolicy: '',
      dashboardUrl: 'https://grafana.internal/d/credit-check-slo',
      dashboardDescription: 'Credit bureau integration service',
      runbookUrl: 'https://confluence.internal/credit-check-runbook',
      runbookDescription: '',
    },
  },
  'eod-batch': {
    name: 'GL Reconciliation EOD Report',
    isExample: true,
    created: '2026-01-09 10:00:00',
    updated: '2026-01-09 10:00:00',
    identity: {
      serviceName: 'GL Reconciliation EOD Report',
      serviceId: 'SVC_GL_001',
      description: 'Autosys-scheduled nightly GL reconciliation for commercial banking — aggregates daily transactions, formats per Fed Reg D, transmits to regulatory file gateway',
      tier: 'Tier 1',
      productLine: 'Consumer Lending',
      businessDomain: 'Wholesale Banking',
      orgProduct: 'PROD-WB-001',
      technicalOwner: 'sre-data-platform',
      status: 'active',
    },
    stakeholders: [
      { id: 'ctx-svc003-001', stakeholder: 'Federal Reserve Regulators', expectationStatement: 'Daily GL reconciliation report complete, accurate, and available for regulatory review by 6:00 AM EST', impactDescription: 'Legal Risk: Late or missing report triggers Fed Reg D non-compliance penalties ($10K-$50K per occurrence)', impactCategory: 'legal_risk', priority: 'CRITICAL' },
      { id: 'ctx-svc003-002', stakeholder: 'Banking Operations VP', expectationStatement: 'Job executes reliably every night with proactive alerting if at risk of missing SLA — no surprises at 6:00 AM', impactDescription: 'Operational Impact: Failure without early warning causes manual scramble (avg 2.5 hours unplanned work per incident)', impactCategory: 'operational', priority: 'CRITICAL' },
      { id: 'ctx-svc003-003', stakeholder: 'Finance Operations Team', expectationStatement: 'Daily transaction totals reconcile with core banking within $0.01 tolerance — discrepancies flagged immediately', impactDescription: 'Financial Impact: Undetected reconciliation errors compound daily; historical corrections avg $125K in quarterly adjustments', impactCategory: 'financial', priority: 'HIGH' },
      { id: 'ctx-svc003-004', stakeholder: 'Banking Customers', expectationStatement: 'Regulatory compliance maintained so loan processing continues uninterrupted', impactDescription: 'Customer Impact: Enforcement could restrict originations — worst case 48-72hr freeze affecting ~2,400 pending applications', impactCategory: 'customer_experience', priority: 'HIGH' },
    ],
    signals: [
      { id: 'sig-svc003-001', name: 'Job Started On Schedule', signalType: 'sli_threshold', layer: 'L1', whatItTellsMe: 'Batch job initiated within 15 minutes of scheduled 2:00 AM EST start time', sloTarget: 15, timeWindow: '30d', whyThisTarget: 'T1 batch jobs must start within 15 minutes of schedule; late start compresses processing window before 6 AM SLA', impactCategory: '', impactUnit: '', queryNumerator: "ABS(job_start_time - scheduled_time) FROM autosys_event_log WHERE job='GL_EOD_RECON_001'", queryDenominator: '', technicalOwner: 'sre-data-platform', alertThreshold: 20, pageThreshold: 30, thresholdOperator: 'lte', thresholdUnit: 'minutes', dataSource: 'Splunk', dataSourceDetails: 'index=autosys_events sourcetype=job_start', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc003-002'], quantifies: [] },
      { id: 'sig-svc003-002', name: 'Job Success Rate', signalType: 'sli_ratio', layer: 'L2', whatItTellsMe: 'Percentage of job executions completing successfully — 99% allows ~3 failures per year', sloTarget: 99, timeWindow: '30d', whyThisTarget: 'T1 regulatory jobs require 99% success rate; each failure triggers manual recovery and potential SLA miss', impactCategory: '', impactUnit: '', queryNumerator: "COUNT(job_runs WHERE status='SUCCESS')", queryDenominator: 'COUNT(job_runs)', technicalOwner: 'sre-data-platform', alertThreshold: 98.5, pageThreshold: 97, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=autosys_job_history sourcetype=job_completion', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc003-002'], quantifies: [] },
      { id: 'sig-svc003-003', name: 'Job Duration Within Limit', signalType: 'sli_threshold', layer: 'L2', whatItTellsMe: 'Job completes within 60-minute maximum allowed runtime (typical runtime: 45 minutes)', sloTarget: 60, timeWindow: '30d', whyThisTarget: 'Must complete in 60 min to allow buffer before 6 AM SLA; normal runtime is 45 min', impactCategory: '', impactUnit: '', queryNumerator: "job_end_time - job_start_time FROM autosys_job_history WHERE job='GL_EOD_RECON_001'", queryDenominator: '', technicalOwner: 'sre-data-platform', alertThreshold: 75, pageThreshold: 90, thresholdOperator: 'lte', thresholdUnit: 'minutes', dataSource: 'Splunk', dataSourceDetails: 'index=autosys_job_history sourcetype=job_completion', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc003-002'], quantifies: [] },
      { id: 'sig-svc003-004', name: 'Report Available by SLA', signalType: 'sli_ratio', layer: 'L3', whatItTellsMe: 'GL reconciliation report arrives at regulatory SFTP gateway before 6:00 AM EST deadline', sloTarget: 99.5, timeWindow: '365d', whyThisTarget: 'Fed Reg D allows 1-2 late submissions per year before triggering formal regulatory review', impactCategory: '', impactUnit: '', queryNumerator: "COUNT(days WHERE file_arrival_time <= '06:00 EST')", queryDenominator: 'COUNT(business_days)', technicalOwner: 'sre-data-platform', alertThreshold: 99, pageThreshold: 98, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=sftp_gateway sourcetype=file_receipt gl_recon_*.csv', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc003-001'], quantifies: [] },
      { id: 'sig-svc003-005', name: 'Reconciliation Accuracy', signalType: 'sli_ratio', layer: 'L3', whatItTellsMe: 'GL report totals reconcile with core banking source data within $0.01 tolerance', sloTarget: 99.9, timeWindow: '30d', whyThisTarget: 'Financial accuracy is non-negotiable; reconciliation gaps trigger SOX control remediation', impactCategory: '', impactUnit: '', queryNumerator: 'COUNT(days WHERE ABS(report_total - source_total) <= 0.01)', queryDenominator: 'COUNT(days)', technicalOwner: 'sre-data-platform', alertThreshold: 99.5, pageThreshold: 99, thresholdOperator: '', thresholdUnit: '', dataSource: 'Custom', dataSourceDetails: 'Snowflake query: ABS(report_total - source_total) vs $0.01 tolerance', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc003-001', 'ctx-svc003-003'], quantifies: [] },
      { id: 'sig-svc003-006', name: 'Regulatory Penalty Exposure', signalType: 'business_impact', layer: 'L4', whatItTellsMe: 'Potential Fed Reg D penalties when SLA breached — $10K first, $25K second, $50K+ third with formal review', sloTarget: null, timeWindow: '', whyThisTarget: '', impactCategory: 'legal_risk', impactUnit: 'USD', queryNumerator: 'penalty_matrix_lookup(breach_count_rolling_12m)', queryDenominator: '', technicalOwner: 'sre-data-platform', alertThreshold: null, pageThreshold: null, thresholdOperator: '', thresholdUnit: '', dataSource: 'Custom', dataSourceDetails: 'Calculated: Fed Reg D penalty schedule x breach history in rolling 12-month window', alertSeverity: 'warning', pageSeverity: 'critical', verifies: [], quantifies: ['ctx-svc003-001'] },
      { id: 'sig-svc003-007', name: 'Customer Applications at Risk', signalType: 'business_impact', layer: 'L4', whatItTellsMe: 'Pending loan applications affected if regulatory enforcement restricts originations (~800/day x 72hr = ~2,400)', sloTarget: null, timeWindow: '', whyThisTarget: '', impactCategory: 'customer_experience', impactUnit: 'applications', queryNumerator: "COUNT(applications WHERE status='PENDING') AT restriction_time", queryDenominator: '', technicalOwner: 'sre-data-platform', alertThreshold: null, pageThreshold: null, thresholdOperator: '', thresholdUnit: '', dataSource: 'Custom', dataSourceDetails: 'Calculated: pipeline count x estimated restriction duration from enforcement patterns', alertSeverity: 'warning', pageSeverity: 'critical', verifies: [], quantifies: ['ctx-svc003-004'] },
    ],
    operational: {
      alertNotificationTargets: 'pagerduty:PD_SERVICE_XYZ, email:sre-data-platform, servicenow:Banking_L2_Support',
      escalationPolicy: 'TIER1_BATCH_CRITICAL',
      dashboardUrl: 'https://grafana.internal/d/gl-recon-001',
      dashboardDescription: 'GL reconciliation batch health',
      runbookUrl: 'https://confluence.internal/runbooks/gl-reconciliation',
      runbookDescription: '',
    },
  },
  'vendor-integration': {
    name: 'Vendor Lending Integration',
    isExample: true,
    created: '2025-11-23 14:08:17',
    updated: '2025-11-23 14:08:17',
    identity: {
      serviceName: 'Vendor Lending Integration',
      serviceId: 'SVC_VL_001',
      description: 'Bidirectional event-driven integration between loan origination platform and third-party lending vendor for application processing, document exchange, and compliance milestone tracking',
      tier: 'Tier 1',
      productLine: 'Consumer Lending',
      businessDomain: 'Consumer Lending',
      orgProduct: 'PROD-CL-001',
      technicalOwner: 'integration-platform-team',
      status: 'active',
    },
    stakeholders: [
      { id: 'ctx-svc004-001', stakeholder: 'Loan Applicants', expectationStatement: 'Mortgage application process flows without interruption between internal systems and vendor platform', impactDescription: 'Customer Impact: Applicants experience delays or failures in their mortgage application', impactCategory: 'customer_experience', priority: 'HIGH' },
      { id: 'ctx-svc004-002', stakeholder: 'Loan Officers', expectationStatement: 'Vendor data syncs correctly for loan processing and decisioning', impactDescription: 'Operational Impact: Loan officers unable to process applications without manual data reconciliation', impactCategory: 'operational', priority: 'HIGH' },
      { id: 'ctx-svc004-003', stakeholder: 'Consumer Lending Business', expectationStatement: 'Origination pipeline maintains throughput without integration-caused bottlenecks', impactDescription: 'Financial Impact: Origination revenue delayed or lost due to integration failures', impactCategory: 'financial', priority: 'HIGH' },
      { id: 'ctx-svc004-004', stakeholder: 'Compliance Team', expectationStatement: 'Application data exchanged with vendor platform meets data governance and privacy requirements', impactDescription: 'Compliance Risk: Data handling violations in third-party data exchange', impactCategory: 'legal_risk', priority: 'MEDIUM' },
    ],
    signals: [
      { id: 'sig-svc004-001', name: 'Outbound Event Success Rate', signalType: 'sli_ratio', layer: 'L3', whatItTellsMe: 'Outbound workflow events from origination to vendor platform complete successfully — covers document delivery, package distribution, and application progression events', sloTarget: 99.5, timeWindow: '1h', whyThisTarget: 'Vendor integration is the primary mortgage application path; failures directly block applicants', impactCategory: '', impactUnit: '', queryNumerator: "eventStatus='COMPLETE' WHERE direction='OUTBOUND' (OUTBOUND_DOCUMENT, PACKAGE_DISTRIBUTION, PRESUBMIT_* events)", queryDenominator: "all outbound events WHERE app_id='core'", technicalOwner: 'integration-platform-team', alertThreshold: 98, pageThreshold: 95, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=core, app_id=core, ElasticEvent JSON parsed via rex+spath', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc004-001', 'ctx-svc004-003'], quantifies: [] },
      { id: 'sig-svc004-002', name: 'Inbound Document Processing Rate', signalType: 'sli_ratio', layer: 'L3', whatItTellsMe: 'Inbound documents from vendor platform processed successfully — covers 4506T tax forms, compliance reports, customer uploads, and e-signed documents', sloTarget: 99.5, timeWindow: '1h', whyThisTarget: 'Failed inbound processing means origination system has stale application state, causing processing delays for loan officers', impactCategory: '', impactUnit: '', queryNumerator: "eventStatus='COMPLETE' WHERE eventName LIKE 'INBOUND_DOCUMENT_%'", queryDenominator: "all INBOUND_DOCUMENT_* events WHERE app_id='core'", technicalOwner: 'integration-platform-team', alertThreshold: 98, pageThreshold: 95, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=core, app_id=core, ElasticEvent JSON parsed via rex+spath', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc004-002'], quantifies: [] },
      { id: 'sig-svc004-003', name: 'Applications Blocked', signalType: 'business_impact', layer: 'L4', whatItTellsMe: 'Loan applications unable to proceed due to vendor lending integration failures', sloTarget: null, timeWindow: '', whyThisTarget: '', impactCategory: 'customer_experience', impactUnit: 'applications', queryNumerator: "COUNT(DISTINCT application_id) WHERE vendor_status='ERROR' AND retry_exhausted=true", queryDenominator: '', technicalOwner: 'integration-platform-team', alertThreshold: null, pageThreshold: null, thresholdOperator: '', thresholdUnit: '', dataSource: 'Splunk', dataSourceDetails: 'index=core (requires join to application records — not in event dashboard)', alertSeverity: 'warning', pageSeverity: 'critical', verifies: [], quantifies: ['ctx-svc004-001'] },
      { id: 'sig-svc004-004', name: 'Pipeline Revenue at Risk', signalType: 'business_impact', layer: 'L4', whatItTellsMe: 'Loan origination revenue delayed or at risk due to integration throughput issues', sloTarget: null, timeWindow: '', whyThisTarget: '', impactCategory: 'financial', impactUnit: 'dollars', queryNumerator: "SUM(estimated_loan_value) WHERE application_status='VENDOR_BLOCKED'", queryDenominator: '', technicalOwner: 'integration-platform-team', alertThreshold: null, pageThreshold: null, thresholdOperator: '', thresholdUnit: '', dataSource: 'Custom', dataSourceDetails: 'Requires loan value data from origination system — not in event stream', alertSeverity: 'warning', pageSeverity: 'critical', verifies: [], quantifies: ['ctx-svc004-003'] },
      { id: 'sig-svc004-005', name: 'Data Sync Discrepancies', signalType: 'business_impact', layer: 'L4', whatItTellsMe: 'Loan application records with mismatched data between internal systems and vendor platform systems', sloTarget: null, timeWindow: '', whyThisTarget: '', impactCategory: 'operational', impactUnit: 'records', queryNumerator: "COUNT(*) WHERE vendor_reconciliation_status='MISMATCH'", queryDenominator: '', technicalOwner: 'integration-platform-team', alertThreshold: null, pageThreshold: null, thresholdOperator: '', thresholdUnit: '', dataSource: 'Custom', dataSourceDetails: 'Reconciliation process comparing internal systems and vendor platform application state — separate from event monitoring', alertSeverity: 'warning', pageSeverity: 'critical', verifies: [], quantifies: ['ctx-svc004-002'] },
      { id: 'sig-svc004-006', name: 'Document Processing Response Time', signalType: 'sli_threshold', layer: 'L2', whatItTellsMe: 'Inbound document processing completes within the 6.5-second SLA — the real threshold from production dashboard SPL', sloTarget: 6.5, timeWindow: '1h', whyThisTarget: 'The 6.5-second threshold is the operational SLA evaluated in the dashboard query; documents taking longer indicate processing bottleneck', impactCategory: '', impactUnit: '', queryNumerator: "responseTimeInMillis WHERE eventName='INBOUND_DOC_RES_TIME'", queryDenominator: '', technicalOwner: 'integration-platform-team', alertThreshold: 8, pageThreshold: 10, thresholdOperator: 'lt', thresholdUnit: 'seconds', dataSource: 'Splunk', dataSourceDetails: 'index=core, app_id=core, ElasticEvent JSON, responseTimeInMillis field', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc004-001'], quantifies: [] },
      { id: 'sig-svc004-010', name: 'Fee Payment Response Time', signalType: 'sli_threshold', layer: 'L2', whatItTellsMe: 'Fee payment processing completes within the 10-second SLA — longer threshold than documents because financial transactions involve payment gateway round-trips', sloTarget: 10, timeWindow: '1h', whyThisTarget: 'The 10-second threshold is the production SLA; fee payments are borrower-facing financial transactions with longer processing time', impactCategory: '', impactUnit: '', queryNumerator: "responseTimeInMillis WHERE eventName='FEE_PAYMENT_RES_TIME'", queryDenominator: '', technicalOwner: 'integration-platform-team', alertThreshold: 15, pageThreshold: 20, thresholdOperator: 'lt', thresholdUnit: 'seconds', dataSource: 'Splunk', dataSourceDetails: 'index=core, app_id=core, ElasticEvent JSON, responseTimeInMillis field', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc004-001'], quantifies: [] },
      { id: 'sig-svc004-007', name: 'Document Exchange Throughput', signalType: 'sli_threshold', layer: 'L2', whatItTellsMe: 'Document exchange rate between internal systems and vendor platform stays within expected operational range (observed: ~119 outbound docs/hour)', sloTarget: 100, timeWindow: '1h', whyThisTarget: 'Sustained throughput below 100 docs/hour during business hours indicates processing bottleneck; baseline from dashboard: 358 OUTBOUND_DOCUMENT events in 3 hours', impactCategory: '', impactUnit: '', queryNumerator: "COUNT(eventName='OUTBOUND_DOCUMENT') WHERE app_id='core' AND period='1h'", queryDenominator: '', technicalOwner: 'integration-platform-team', alertThreshold: 50, pageThreshold: 25, thresholdOperator: 'gte', thresholdUnit: 'count', dataSource: 'Splunk', dataSourceDetails: 'index=core, app_id=core, OUTBOUND_DOCUMENT event count (not thresholded in real dashboard)', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc004-002', 'ctx-svc004-003'], quantifies: [] },
      { id: 'sig-svc004-008', name: 'Vendor Endpoint Connectivity', signalType: 'sli_threshold', layer: 'L1', whatItTellsMe: 'Network connectivity to Vendor API endpoints is healthy and responsive', sloTarget: 99.9, timeWindow: '5m', whyThisTarget: 'Any connectivity loss immediately blocks all integration operations', impactCategory: '', impactUnit: '', queryNumerator: "health_check_success_percent WHERE endpoint='vendor-api'", queryDenominator: '', technicalOwner: 'platform-engineering-team', alertThreshold: 99, pageThreshold: 95, thresholdOperator: 'gte', thresholdUnit: '%', dataSource: 'ThousandEyes', dataSourceDetails: 'vendor-api synthetic test (not in app-level Splunk dashboard)', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc004-001', 'ctx-svc004-003'], quantifies: [] },
      { id: 'sig-svc004-009', name: 'Integration Certificate Health', signalType: 'sli_threshold', layer: 'L1', whatItTellsMe: 'TLS certificates for vendor lending integration are valid and not approaching expiration', sloTarget: 30, timeWindow: '1d', whyThisTarget: 'Certificates expiring within 30 days require renewal action; expired certs cause total integration outage', impactCategory: '', impactUnit: '', queryNumerator: "MIN(days_until_expiration) FROM certificate_inventory WHERE service='vendor-integration'", queryDenominator: '', technicalOwner: 'platform-engineering-team', alertThreshold: 14, pageThreshold: 7, thresholdOperator: 'gte', thresholdUnit: 'days', dataSource: 'Splunk', dataSourceDetails: 'index=certificate_inventory (separate from app-level event dashboard)', alertSeverity: 'warning', pageSeverity: 'critical', verifies: ['ctx-svc004-001'], quantifies: [] },
    ],
    operational: {
      alertNotificationTargets: 'page:integration-platform-oncall',
      escalationPolicy: '',
      dashboardUrl: 'https://splunk.internal/app/lending/vendor_integration_health',
      dashboardDescription: 'Vendor lending integration — 30 event types, per-event success rates, response time SLIs',
      runbookUrl: 'https://confluence.internal/vendor-lending-integration-runbook',
      runbookDescription: '',
    },
  },
};

var EXAMPLE_CATALOG = [
  {
    key: 'credit-check',
    name: 'Credit Check Service',
    archetype: 'Synchronous API',
    description: 'External credit bureau integration with regulatory timing requirements.',
    domain: 'Consumer Lending'
  },
  {
    key: 'vendor-integration',
    name: 'Vendor Lending Integration',
    archetype: 'Vendor Integration',
    description: 'Event-driven bidirectional integration with third-party mortgage platform — 30 workflow event types, document exchange, compliance milestones.',
    domain: 'Consumer Lending'
  },
  {
    key: 'eod-batch',
    name: 'GL Reconciliation EOD Report',
    archetype: 'Batch Processing',
    description: 'Autosys-scheduled nightly GL reconciliation for regulatory compliance — Fed Reg D reporting with SLA deadlines and data accuracy monitoring.',
    domain: 'Wholesale Banking'
  }
];

function isExampleLoaded(key) {
  var store = Alpine.store('app');
  var name = SEED_DATA[key] && SEED_DATA[key].name;
  if (!name) return false;
  return Object.keys(store.services).some(function(id) {
    return store.services[id].isExample && store.services[id].name === name;
  });
}

// ── Utilities ──
function generateId(prefix) {
  return prefix + '-' + Date.now() + '-' + Math.random().toString(16).slice(2, 6);
}

function categoryStyle(code) {
  var c = CATEGORY_COLORS_BADGE[code] || { bg: '#EEE', text: '#333' };
  return 'background:' + c.bg + ';color:' + c.text;
}

function categoryName(code) {
  return (CATEGORY_COLORS[code] || { name: code }).name;
}

// ── Persistence ──
var persistTimer = null;
function schedulePersist() {
  clearTimeout(persistTimer);
  persistTimer = setTimeout(function() {
    var store = Alpine.store('app');
    var active = store.activeServiceId && store.services[store.activeServiceId];
    if (active) {
      active.updated = new Date().toISOString();
    }
    localStorage.setItem('bos-story-sets', JSON.stringify({
      services: store.services,
      meta: store.meta,
      showGrounding: store.showGrounding,
    }));
    store.meta.changesSinceExport = (store.meta.changesSinceExport || 0) + 1;
  }, 300);
}

function loadFromStorage() {
  var raw = localStorage.getItem('bos-story-sets');
  if (raw) {
    try {
      var data = JSON.parse(raw);
      var store = Alpine.store('app');
      store.services = data.services || {};
      store.meta = data.meta || { lastExport: null, changesSinceExport: 0 };
      store.showGrounding = data.showGrounding !== undefined ? data.showGrounding : true;
    } catch (e) {
      console.warn('Failed to load from localStorage:', e);
    }
  }
}

function migrateSignals() {
  var store = Alpine.store('app');
  var OPERATOR_MAP = { '<': 'lt', '>': 'gt', '<=': 'lte', '>=': 'gte', '==': 'eq' };
  var migrated = false;

  Object.values(store.services).forEach(function(svc) {
    (svc.signals || []).forEach(function(sig) {
      if (sig.dataSource === undefined) { sig.dataSource = ''; migrated = true; }
      if (sig.dataSourceDetails === undefined) { sig.dataSourceDetails = ''; migrated = true; }
      if (sig.alertSeverity === undefined) { sig.alertSeverity = 'warning'; migrated = true; }
      if (sig.pageSeverity === undefined) { sig.pageSeverity = 'critical'; migrated = true; }
      if (sig.thresholdOperator && OPERATOR_MAP[sig.thresholdOperator]) {
        sig.thresholdOperator = OPERATOR_MAP[sig.thresholdOperator];
        migrated = true;
      }
    });
  });

  if (migrated) {
    localStorage.setItem('bos-story-sets', JSON.stringify({
      services: store.services,
      meta: store.meta,
      showGrounding: store.showGrounding,
    }));
  }
}

// ── Service management ──
function createService() {
  var id = generateId('svc');
  var store = Alpine.store('app');
  store.services[id] = {
    id: id,
    name: 'New Service',
    created: new Date().toISOString(),
    updated: new Date().toISOString(),
    isExample: false,
    identity: {
      serviceName: '', serviceId: '', description: '', tier: '',
      productLine: '', businessDomain: '', functionalCategory: '', orgProduct: '',
      technicalOwner: '', status: '',
    },
    stakeholders: [],
    signals: [],
    operational: {
      alertNotificationTargets: '', escalationPolicy: '',
      dashboardUrl: '', dashboardDescription: '',
      runbookUrl: '', runbookDescription: '',
    },
  };
  store.activeServiceId = id;
  schedulePersist();
  return id;
}

function getActiveService() {
  var store = Alpine.store('app');
  return store.activeServiceId ? store.services[store.activeServiceId] : null;
}

function deleteService(id) {
  if (confirm('Delete this service and all its data?')) {
    var store = Alpine.store('app');
    delete store.services[id];
    if (store.activeServiceId === id) {
      store.activeServiceId = null;
    }
    schedulePersist();
  }
}

function cloneService(serviceId) {
  var store = Alpine.store('app');
  var source = store.services[serviceId];
  if (!source) return;
  var clone = JSON.parse(JSON.stringify(source));
  clone.id = generateId('svc');
  clone.name = 'Copy of ' + source.name;
  clone.isExample = false;
  clone.created = new Date().toISOString();
  clone.updated = new Date().toISOString();
  clone.identity.serviceName = '';
  clone.identity.serviceId = '';
  clone.identity.description = '';
  clone.identity.technicalOwner = '';
  clone.identity.status = 'draft';
  store.services[clone.id] = clone;
  store.activeServiceId = clone.id;
  schedulePersist();
  return clone.id;
}

function resetWorkspace() {
  var store = Alpine.store('app');
  var serviceCount = Object.keys(store.services).length;
  var changes = store.meta.changesSinceExport || 0;
  var msg = 'Reset workspace? This will delete all services and cannot be undone.';
  if (changes > 0) {
    msg = 'Reset workspace? You have ' + changes + ' unexported changes across ' + serviceCount + ' services. This cannot be undone.';
  }
  if (confirm(msg)) {
    store.services = {};
    store.activeServiceId = null;
    store.meta = { lastExport: null, changesSinceExport: 0 };
    localStorage.removeItem('bos-story-sets');
    return true;
  }
  return false;
}

function resetToExamples() {
  var didReset = resetWorkspace();
  if (didReset) {
    EXAMPLE_CATALOG.forEach(function(ex) {
      loadExample(ex.key);
    });
    Alpine.store('app').activeServiceId = null;
  }
}

function loadExample(key) {
  var store = Alpine.store('app');
  var data = JSON.parse(JSON.stringify(SEED_DATA[key]));
  if (!data) return;
  var existingId = null;
  Object.keys(store.services).forEach(function(id) {
    if (store.services[id].isExample && store.services[id].name === data.name) {
      existingId = id;
    }
  });
  if (existingId) {
    if (confirm(data.name + ' example already loaded. Reset to original example data?')) {
      var existing = store.services[existingId];
      Object.keys(data).forEach(function(key) {
        if (key !== 'id') {
          existing[key] = data[key];
        }
      });
      existing.updated = new Date().toISOString();
      schedulePersist();
    }
    store.activeServiceId = existingId;
  } else {
    data.id = generateId('svc');
    store.services[data.id] = data;
    store.activeServiceId = data.id;
    schedulePersist();
  }
}

function exportService(serviceId) {
  var store = Alpine.store('app');
  var service = store.services[serviceId || store.activeServiceId];
  if (!service) return;
  var exportData = {
    version: '1.0',
    exportedAt: new Date().toISOString(),
    service: JSON.parse(JSON.stringify(service)),
  };
  var blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.download = (service.identity.serviceName || 'service') + '-story-set.json';
  a.click();
  URL.revokeObjectURL(url);
  store.meta.lastExport = new Date().toISOString();
  store.meta.changesSinceExport = 0;
  // Save directly — schedulePersist() would increment counter
  localStorage.setItem('bos-story-sets', JSON.stringify({
    services: store.services,
    meta: store.meta,
    showGrounding: store.showGrounding,
  }));
}

function importService(file) {
  var reader = new FileReader();
  reader.onload = function(e) {
    try {
      var data = JSON.parse(e.target.result);
      if (data.version && data.service) {
        var store = Alpine.store('app');
        var service = data.service;
        if (store.services[service.id]) {
          var existingName = store.services[service.id].identity.serviceName || store.services[service.id].name || 'Untitled';
          if (confirm('A service with this ID already exists (' + existingName + '). Replace it with the imported data?')) {
            // Replace: overwrite with imported data, preserve ID
          } else {
            // Add as copy: new ID
            service.id = generateId('svc');
          }
        }
        store.services[service.id] = service;
        store.activeServiceId = service.id;
        schedulePersist();
      } else {
        alert('Invalid file format. Expected a story set export with version and service data.');
      }
    } catch (err) {
      alert('Failed to parse import file: ' + err.message);
    }
  };
  reader.readAsText(file);
}

function exportMarkdown() {
  var store = Alpine.store('app');
  var service = store.services[store.activeServiceId];
  if (!service) return;
  var id = service.identity || {};
  var md = '';

  md += '# ' + (id.serviceName || 'Service') + ' — Business Observability User Story Set\n\n';
  md += '**Service:** ' + (id.serviceName || '') + ' (' + (id.serviceId || '') + ')\n';
  md += '**Business Domain:** ' + (id.businessDomain || '') + '\n';
  md += '**Technical Owner:** ' + (id.technicalOwner || '') + '\n\n---\n\n';

  md += '## EPIC: Implement Business Observability for ' + (id.serviceName || 'Service') + '\n\n';
  md += '> Enable structured business observability for ' + (id.serviceName || 'this service');
  md += ' so that stakeholder expectations are defined, health and impact signals are instrumented,';
  md += ' and operational artifacts are built from verifiable requirements.\n\n---\n\n';

  md += '## Story 1 of 3: Product Owner — Define Business Observability Requirements\n\n';
  md += '### AC 1.1 — Service Context\n\n';
  md += '| Field | Value |\n|-------|-------|\n';
  md += '| Service Name | ' + (id.serviceName || '') + ' |\n';
  md += '| Service ID | ' + (id.serviceId || '') + ' |\n';
  md += '| Description | ' + (id.description || '') + ' |\n';
  md += '| Tier | ' + (id.tier || '') + ' |\n';
  md += '| Product Line | ' + (id.productLine || '') + ' |\n';
  md += '| Business Domain | ' + (id.businessDomain || '') + ' |\n';
  md += '| Functional Category | ' + (id.functionalCategory || '') + ' |\n';
  md += '| Org Product | ' + (id.orgProduct || '') + ' |\n';
  md += '| Technical Owner | ' + (id.technicalOwner || '') + ' |\n';
  md += '| Status | ' + (id.status || '') + ' |\n\n';

  md += '### AC 1.2 — Stakeholder Expectations\n\n';
  (service.stakeholders || []).forEach(function(stk) {
    md += '**Stakeholder: ' + (stk.stakeholder || '(unnamed)') + '**\n';
    md += '| Field | Value |\n|-------|-------|\n';
    md += '| As a stakeholder... | ' + (stk.stakeholder || '') + ' |\n';
    md += '| I expect... | ' + (stk.expectationStatement || '') + ' |\n';
    md += '| If it fails... | ' + (stk.impactDescription || '') + ' |\n';
    md += '| Impact Category | ' + (stk.impactCategory || '') + ' |\n';
    md += '| Priority | ' + (stk.priority || '') + ' |\n\n';
  });

  md += '### AC 1.3 — Business Health Signals\n\n';
  (service.signals || []).filter(function(s) { return s.layer === 'L3'; }).forEach(function(sig) {
    md += '**Signal: ' + (sig.name || '(unnamed)') + '** (' + (sig.signalType || '') + ', ' + layerDisplayName(sig.layer) + ')\n';
    md += '| Field | Value |\n|-------|-------|\n';
    md += '| What would I look at? | ' + (sig.name || '') + ' |\n';
    md += '| What does it tell me? | ' + (sig.whatItTellsMe || '') + ' |\n';
    md += '| Target | ' + (sig.sloTarget != null ? sig.sloTarget : '') + (sig.signalType === 'sli_ratio' ? '%' : '') + ' |\n';
    md += '| Time Window | ' + (sig.timeWindow || '') + ' |\n';
    md += '| Why this target? | ' + (sig.whyThisTarget || '') + ' |\n\n';
  });

  md += '### AC 1.4 — Business Impact Signals\n\n';
  (service.signals || []).filter(function(s) { return s.layer === 'L4'; }).forEach(function(sig) {
    md += '**Signal: ' + (sig.name || '(unnamed)') + '** (business_impact)\n';
    md += '| Field | Value |\n|-------|-------|\n';
    md += '| What would I look at? | ' + (sig.name || '') + ' |\n';
    md += '| What does it tell me? | ' + (sig.whatItTellsMe || '') + ' |\n';
    md += '| Impact Category | ' + (sig.impactCategory || '') + ' |\n';
    md += '| Impact Unit | ' + (sig.impactUnit || '') + ' |\n\n';
  });

  md += '---\n\n';

  md += '## Story 2 of 3: Developer — Implement Signals\n\n';
  md += '### AC 2.1 — Health Signal Queries\n\n';
  (service.signals || []).filter(function(s) { return s.layer === 'L3'; }).forEach(function(sig) {
    md += '**For: ' + (sig.name || '(unnamed)') + '**\n';
    md += '| Field | Value |\n|-------|-------|\n';
    md += '| Signal Type | ' + (sig.signalType || '') + ' |\n';
    if (sig.signalType === 'sli_ratio') {
      md += '| Good Events Query | `' + (sig.queryNumerator || '') + '` |\n';
      md += '| Total Events Query | `' + (sig.queryDenominator || '') + '` |\n';
    } else {
      md += '| Measurement Query | `' + (sig.queryNumerator || '') + '` |\n';
    }
    md += '| Data Source | ' + (sig.dataSource || '') + ' |\n';
    md += '| Data Source Details | ' + (sig.dataSourceDetails || '') + ' |\n';
    md += '| Technical Owner | ' + (sig.technicalOwner || '') + ' |\n\n';
  });

  md += '### AC 2.2 — Process Signals\n\n';
  (service.signals || []).filter(function(s) { return s.layer === 'L2'; }).forEach(function(sig) {
    md += '**Signal: ' + (sig.name || '(unnamed)') + '** (' + layerDisplayName(sig.layer) + ')\n';
    md += '| Field | Value |\n|-------|-------|\n';
    md += '| What would I look at? | ' + (sig.name || '') + ' |\n';
    md += '| What does it tell me? | ' + (sig.whatItTellsMe || '') + ' |\n';
    md += '| Target | ' + (sig.sloTarget != null ? sig.sloTarget : '') + ' |\n';
    md += '| Time Window | ' + (sig.timeWindow || '') + ' |\n';
    md += '| Signal Type | ' + (sig.signalType || '') + ' |\n';
    if (sig.signalType === 'sli_ratio') {
      md += '| Good Events Query | `' + (sig.queryNumerator || '') + '` |\n';
      md += '| Total Events Query | `' + (sig.queryDenominator || '') + '` |\n';
    } else {
      md += '| Measurement Query | `' + (sig.queryNumerator || '') + '` |\n';
    }
    md += '| Data Source | ' + (sig.dataSource || '') + ' |\n';
    md += '| Data Source Details | ' + (sig.dataSourceDetails || '') + ' |\n';
    md += '| Technical Owner | ' + (sig.technicalOwner || '') + ' |\n\n';
  });

  md += '### AC 2.3 — Impact Signal Queries\n\n';
  (service.signals || []).filter(function(s) { return s.layer === 'L4'; }).forEach(function(sig) {
    md += '**For: ' + (sig.name || '(unnamed)') + '**\n';
    md += '| Field | Value |\n|-------|-------|\n';
    md += '| Signal Type | business_impact |\n';
    md += '| Measurement Query | `' + (sig.queryNumerator || '') + '` |\n';
    md += '| Data Source | ' + (sig.dataSource || '') + ' |\n';
    md += '| Data Source Details | ' + (sig.dataSourceDetails || '') + ' |\n';
    md += '| Technical Owner | ' + (sig.technicalOwner || '') + ' |\n\n';
  });

  md += '---\n\n';

  md += '## Story 3 of 3: Platform — Operationalize\n\n';
  md += '### AC 3.1 — System Signals\n\n';
  (service.signals || []).filter(function(s) { return s.layer === 'L1'; }).forEach(function(sig) {
    md += '**Signal: ' + (sig.name || '(unnamed)') + '** (' + layerDisplayName(sig.layer) + ')\n';
    md += '| Field | Value |\n|-------|-------|\n';
    md += '| What would I look at? | ' + (sig.name || '') + ' |\n';
    md += '| What does it tell me? | ' + (sig.whatItTellsMe || '') + ' |\n';
    md += '| Target | ' + (sig.sloTarget != null ? sig.sloTarget : '') + ' |\n';
    md += '| Time Window | ' + (sig.timeWindow || '') + ' |\n';
    md += '| Signal Type | ' + (sig.signalType || '') + ' |\n';
    md += '| Measurement Query | `' + (sig.queryNumerator || '') + '` |\n';
    md += '| Technical Owner | ' + (sig.technicalOwner || '') + ' |\n\n';
  });

  md += '### AC 3.2 — Alert Thresholds\n\n';
  (service.signals || []).filter(function(s) { return s.layer !== 'L4'; }).forEach(function(sig) {
    if (sig.alertThreshold || sig.pageThreshold) {
      md += '**For: ' + (sig.name || '(unnamed)') + '** (' + layerDisplayName(sig.layer) + ')\n';
      md += '| Field | Value |\n|-------|-------|\n';
      md += '| Alerting Threshold | ' + (sig.alertThreshold || '') + ' |\n';
      md += '| Alert Severity | ' + (sig.alertSeverity || '') + ' |\n';
      md += '| Page Threshold | ' + (sig.pageThreshold || '') + ' |\n';
      md += '| Page Severity | ' + (sig.pageSeverity || '') + ' |\n';
      md += '| Operator | ' + (sig.thresholdOperator ? formatOperator(sig.thresholdOperator) : '') + ' |\n\n';
    }
  });

  var ops = service.operational || {};
  md += '### AC 3.3 — Alert Routing\n\n';
  md += '| Field | Value |\n|-------|-------|\n';
  md += '| Alert Notification Targets | ' + (ops.alertNotificationTargets || '') + ' |\n';
  md += '| Escalation Policy | ' + (ops.escalationPolicy || '') + ' |\n\n';

  md += '### AC 3.4 — Dashboard\n\n';
  md += '| Field | Value |\n|-------|-------|\n';
  md += '| Dashboard URL | ' + (ops.dashboardUrl || '') + ' |\n';
  md += '| Dashboard Description | ' + (ops.dashboardDescription || '') + ' |\n\n';

  md += '### AC 3.5 — Playbook\n\n';
  md += '| Field | Value |\n|-------|-------|\n';
  md += '| Runbook URL | ' + (ops.runbookUrl || '') + ' |\n';
  md += '| Runbook Description | ' + (ops.runbookDescription || '') + ' |\n';

  var blob = new Blob([md], { type: 'text/markdown' });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.download = (id.serviceName || 'service') + '-story-set.md';
  a.click();
  URL.revokeObjectURL(url);
}

function computeFieldCount(svc) {
  if (!svc) return '0/9';
  var filled = 0;
  var identityFields = ['serviceName','serviceId','description','tier','productLine',
                        'businessDomain','orgProduct','technicalOwner','status'];
  var identity = svc.identity || {};
  identityFields.forEach(function(f) { if (identity[f]) filled++; });
  filled += (svc.stakeholders || []).length;
  filled += (svc.signals || []).length;
  var total = 9 + (svc.stakeholders || []).length + (svc.signals || []).length;
  if (total < 9) total = 9;
  return filled + '/' + total + ' fields';
}

function formatTimestamp(iso) {
  if (!iso) return '';
  var d = new Date(iso);
  var now = new Date();
  var diff = now - d;
  if (diff < 60000) return 'just now';
  if (diff < 3600000) return Math.floor(diff / 60000) + ' min ago';
  if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
  return d.toLocaleDateString();
}

// ── Stakeholder CRUD ──
function addStakeholder(category) {
  var service = getActiveService();
  if (!service) return;
  service.stakeholders.push({
    id: generateId('ctx'),
    stakeholder: '',
    expectationStatement: '',
    impactDescription: '',
    impactCategory: category,
    priority: '',
  });
  schedulePersist();
}

function removeStakeholder(stk) {
  var service = getActiveService();
  if (!service) return;
  var idx = service.stakeholders.indexOf(stk);
  if (idx > -1) {
    service.signals.forEach(function(sig) {
      sig.verifies = sig.verifies.filter(function(id) { return id !== stk.id; });
      sig.quantifies = sig.quantifies.filter(function(id) { return id !== stk.id; });
    });
    service.stakeholders.splice(idx, 1);
    schedulePersist();
  }
}

// ── Signal CRUD ──
function addSignal(layer) {
  var service = getActiveService();
  if (!service) return;
  var signalType = layer === 'L4' ? 'business_impact' : '';
  service.signals.push({
    id: generateId('sig'),
    name: '',
    signalType: signalType,
    layer: layer,
    verifies: [],
    quantifies: [],
    whatItTellsMe: '',
    sloTarget: null,
    timeWindow: '',
    whyThisTarget: '',
    impactCategory: null,
    impactUnit: null,
    queryNumerator: '',
    queryDenominator: '',
    technicalOwner: '',
    alertThreshold: null,
    pageThreshold: null,
    thresholdOperator: '',
    thresholdUnit: '',
    dataSource: '',
    dataSourceDetails: '',
    alertSeverity: 'warning',
    pageSeverity: 'critical',
  });
  schedulePersist();
}

function removeSignal(sig) {
  var service = getActiveService();
  if (!service) return;
  var idx = service.signals.indexOf(sig);
  if (idx > -1) {
    service.signals.splice(idx, 1);
    schedulePersist();
  }
}

// ── Trace link toggling ──
function toggleTrace(sig, field, stakeholderId) {
  var arr = sig[field];
  var idx = arr.indexOf(stakeholderId);
  if (idx > -1) {
    arr.splice(idx, 1);
  } else {
    arr.push(stakeholderId);
  }
  sig[field] = sig[field].slice();
  schedulePersist();
}

// ── Bridge coverage computation ──
function computeCoverage(bridgeType) {
  var service = getActiveService();
  if (!service) return { categories: [], orphans: [], covered: 0, total: 0, signalCount: 0 };

  var signals = bridgeType === 'health'
    ? service.signals.filter(function(s) { return s.layer === 'L3'; })
    : service.signals.filter(function(s) { return s.layer === 'L4'; });
  var traceField = bridgeType === 'health' ? 'verifies' : 'quantifies';
  var labelField = bridgeType === 'health' ? 'expectationStatement' : 'impactDescription';

  var coverageMap = {};
  service.stakeholders.forEach(function(stk) { coverageMap[stk.id] = []; });

  var orphans = [];
  signals.forEach(function(sig) {
    var traced = sig[traceField];
    if (traced.length === 0) {
      orphans.push(sig.name || '(unnamed)');
    } else {
      traced.forEach(function(stkId) {
        if (coverageMap[stkId]) {
          coverageMap[stkId].push(sig.name || '(unnamed)');
        }
      });
    }
  });

  var categories = CATEGORY_ORDER.map(function(catCode) {
    var stks = service.stakeholders.filter(function(s) { return s.impactCategory === catCode; });
    return {
      code: catCode,
      expectations: stks.map(function(stk) {
        return {
          label: stk[labelField],
          stakeholder: stk.stakeholder,
          signals: coverageMap[stk.id] || [],
        };
      }),
    };
  }).filter(function(cat) { return cat.expectations.length > 0; });

  var covered = service.stakeholders.filter(function(stk) {
    return (coverageMap[stk.id] || []).length > 0;
  }).length;

  return {
    categories: categories,
    orphans: orphans,
    covered: covered,
    total: service.stakeholders.length,
    signalCount: signals.length,
  };
}

// ── Completeness evaluation (Tab 5) ──
var REQUIRED_FIELDS = {
  sli_ratio: {
    defining: ['name','whatItTellsMe','sloTarget','timeWindow','whyThisTarget'],
    implementing: ['signalType','queryNumerator','queryDenominator','dataSource'],
    operationalizing: ['alertThreshold','alertSeverity','pageThreshold','pageSeverity']
  },
  sli_threshold: {
    defining: ['name','whatItTellsMe','sloTarget','timeWindow','whyThisTarget'],
    implementing: ['signalType','queryNumerator','thresholdOperator','dataSource'],
    operationalizing: ['alertThreshold','alertSeverity','pageThreshold','pageSeverity']
  },
  business_impact: {
    defining: ['name','whatItTellsMe','impactCategory','impactUnit'],
    implementing: ['queryNumerator','dataSource'],
    operationalizing: []
  }
};

function _isEmpty(v) {
  return v === null || v === undefined || v === '';
}

function signalTypeLabel(type) {
  if (type === 'sli_ratio') return 'Ratio';
  if (type === 'sli_threshold') return 'Threshold';
  if (type === 'business_impact') return 'Impact';
  return type || '';
}

function layerDisplayName(layer) {
  if (layer === 'L1') return 'System';
  if (layer === 'L2') return 'Process';
  if (layer === 'L3') return 'Business Health';
  if (layer === 'L4') return 'Business Impact';
  return layer || '';
}

function signalJourneyPO(sig) {
  if (sig.layer === 'L4') return 'Defined impact: ' + (sig.whatItTellsMe || '(pending)');
  if (sig.layer === 'L3') return 'Target: ' + (sig.sloTarget || '(pending)');
  return '';
}

function signalJourneyDev(sig) {
  if (sig.layer === 'L4') return 'Query: ' + (sig.queryNumerator || '(pending)');
  if (sig.layer === 'L3') return 'Type: ' + (sig.signalType || '(pending)');
  if (sig.layer === 'L2') return 'Target: ' + (sig.sloTarget || '(pending)') + ', Type: ' + (sig.signalType || '(pending)');
  return '';
}

function signalJourneyPlat(sig) {
  if (sig.layer === 'L4') return 'Operationalizes impact dashboard + playbook';
  if (sig.layer === 'L1') return 'Target: ' + (sig.sloTarget || '(pending)') + ', Alert: ' + (sig.alertThreshold || '(pending)') + ', Page: ' + (sig.pageThreshold || '(pending)');
  if (!_isEmpty(sig.alertThreshold) || !_isEmpty(sig.pageThreshold)) {
    return 'Alert: ' + (sig.alertThreshold || '(pending)') + ', Page: ' + (sig.pageThreshold || '(pending)');
  }
  return 'Thresholds pending';
}

function evaluateLayerCoverage(signals) {
  var layers = [
    { layer: 'L1', label: 'System', count: 0 },
    { layer: 'L2', label: 'Process', count: 0 },
    { layer: 'L3', label: 'Business Health', count: 0 },
    { layer: 'L4', label: 'Business Impact', count: 0 }
  ];
  signals.forEach(function(sig) {
    layers.forEach(function(l) {
      if (sig.layer === l.layer) l.count++;
    });
  });
  return layers;
}

function evaluateSignalCompleteness(signals) {
  return signals.filter(function(sig) {
    return sig.signalType && REQUIRED_FIELDS[sig.signalType];
  }).map(function(sig) {
    var req = REQUIRED_FIELDS[sig.signalType];
    var allFields = req.defining.concat(req.implementing).concat(req.operationalizing);
    var filled = allFields.filter(function(f) { return !_isEmpty(sig[f]); }).length;
    var missing = allFields.filter(function(f) { return _isEmpty(sig[f]); });
    return { name: sig.name || '(unnamed)', type: sig.signalType, layer: sig.layer, total: allFields.length, filled: filled, missing: missing };
  });
}

function evaluateThresholds(signals) {
  var health = signals.filter(function(s) { return s.layer !== 'L4'; });
  var withThresholds = health.filter(function(s) { return !_isEmpty(s.alertThreshold) && !_isEmpty(s.pageThreshold); });
  var missing = health.filter(function(s) { return _isEmpty(s.alertThreshold) || _isEmpty(s.pageThreshold); }).map(function(s) { return s.name || '(unnamed)'; });
  return { total: health.length, defined: withThresholds.length, missing: missing };
}

function evaluateTraceability(signals, stakeholders) {
  var l4Cats = signals.filter(function(s) { return s.layer === 'L4'; }).map(function(s) { return s.impactCategory; }).filter(Boolean);
  var traced = stakeholders.filter(function(stk) {
    return l4Cats.indexOf(stk.impactCategory) > -1;
  });
  var untraced = stakeholders.filter(function(stk) {
    return l4Cats.indexOf(stk.impactCategory) === -1;
  }).map(function(stk) { return stk.stakeholder || categoryName(stk.impactCategory); });
  return { total: stakeholders.length, traced: traced.length, untraced: untraced };
}

function evaluateOperational(operational) {
  if (!operational) return { total: 3, defined: 0, missing: ['alertNotificationTargets', 'dashboardUrl', 'runbookUrl'] };
  var fields = ['alertNotificationTargets', 'dashboardUrl', 'runbookUrl'];
  var defined = fields.filter(function(f) { return !_isEmpty(operational[f]); });
  var missing = fields.filter(function(f) { return _isEmpty(operational[f]); });
  return { total: 3, defined: defined.length, missing: missing };
}

// ── Dashboard Preview helpers (Tab 6) ──
function formatOperator(op) {
  var MAP = { lt: '<', gt: '>', lte: '<=', gte: '>=', eq: '==' };
  return MAP[op] || op;
}

function formatTarget(sig) {
  if (!sig.sloTarget) return '';
  if (sig.signalType === 'sli_ratio') return sig.sloTarget + '%';
  if (sig.signalType === 'sli_threshold') {
    return formatOperator(sig.thresholdOperator) + ' ' + sig.sloTarget + ' ' + (sig.thresholdUnit || '');
  }
  return String(sig.sloTarget);
}

function formatThreshold(value, sig) {
  if (_isEmpty(value)) return '';
  if (sig.signalType === 'sli_ratio') return value + '%';
  return String(value) + ' ' + (sig.thresholdUnit || '');
}

function dashImpactDescription(sig, stakeholders) {
  if (!sig.impactCategory || !stakeholders) return '';
  var match = stakeholders.filter(function(stk) { return stk.impactCategory === sig.impactCategory; });
  return match.length > 0 ? (match[0].impactDescription || '') : '';
}
</script>

<!-- 2. Alpine store initialization (listener registered BEFORE Alpine loads) -->
<script>
document.addEventListener('alpine:init', function() {
  Alpine.store('app', {
    activeServiceId: null,
    activeTab: 'po',
    guideExpanded: false,
    showGrounding: true,
    services: {},
    meta: { lastExport: null, changesSinceExport: 0 },
  });

  loadFromStorage();
  migrateSignals();

  window.addEventListener('beforeunload', function(e) {
    var store = Alpine.store('app');
    if (store.meta.changesSinceExport > 0) {
      e.preventDefault();
      e.returnValue = '';
    }
  });
});
</script>

<!-- 3. Alpine.js 3.14.8 (inlined, auto-start stripped — we call Alpine.start() at end of body) -->
<script>
(()=>{var nt=!1,it=!1,W=[],ot=-1;function Ut(e){Rn(e)}function Rn(e){W.includes(e)||W.push(e),Mn()}function Wt(e){let t=W.indexOf(e);t!==-1&&t>ot&&W.splice(t,1)}function Mn(){!it&&!nt&&(nt=!0,queueMicrotask(Nn))}function Nn(){nt=!1,it=!0;for(let e=0;e<W.length;e++)W[e](),ot=e;W.length=0,ot=-1,it=!1}var T,N,$,at,st=!0;function Gt(e){st=!1,e(),st=!0}function Jt(e){T=e.reactive,$=e.release,N=t=>e.effect(t,{scheduler:r=>{st?Ut(r):r()}}),at=e.raw}function ct(e){N=e}function Yt(e){let t=()=>{};return[n=>{let i=N(n);return e._x_effects||(e._x_effects=new Set,e._x_runEffects=()=>{e._x_effects.forEach(o=>o())}),e._x_effects.add(i),t=()=>{i!==void 0&&(e._x_effects.delete(i),$(i))},i},()=>{t()}]}function ve(e,t){let r=!0,n,i=N(()=>{let o=e();JSON.stringify(o),r?n=o:queueMicrotask(()=>{t(o,n),n=o}),r=!1});return()=>$(i)}var Xt=[],Zt=[],Qt=[];function er(e){Qt.push(e)}function te(e,t){typeof t=="function"?(e._x_cleanups||(e._x_cleanups=[]),e._x_cleanups.push(t)):(t=e,Zt.push(t))}function Ae(e){Xt.push(e)}function Oe(e,t,r){e._x_attributeCleanups||(e._x_attributeCleanups={}),e._x_attributeCleanups[t]||(e._x_attributeCleanups[t]=[]),e._x_attributeCleanups[t].push(r)}function lt(e,t){e._x_attributeCleanups&&Object.entries(e._x_attributeCleanups).forEach(([r,n])=>{(t===void 0||t.includes(r))&&(n.forEach(i=>i()),delete e._x_attributeCleanups[r])})}function tr(e){for(e._x_effects?.forEach(Wt);e._x_cleanups?.length;)e._x_cleanups.pop()()}var ut=new MutationObserver(mt),ft=!1;function ue(){ut.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),ft=!0}function dt(){kn(),ut.disconnect(),ft=!1}var le=[];function kn(){let e=ut.takeRecords();le.push(()=>e.length>0&&mt(e));let t=le.length;queueMicrotask(()=>{if(le.length===t)for(;le.length>0;)le.shift()()})}function m(e){if(!ft)return e();dt();let t=e();return ue(),t}var pt=!1,Se=[];function rr(){pt=!0}function nr(){pt=!1,mt(Se),Se=[]}function mt(e){if(pt){Se=Se.concat(e);return}let t=[],r=new Set,n=new Map,i=new Map;for(let o=0;o<e.length;o++)if(!e[o].target._x_ignoreMutationObserver&&(e[o].type==="childList"&&(e[o].removedNodes.forEach(s=>{s.nodeType===1&&s._x_marker&&r.add(s)}),e[o].addedNodes.forEach(s=>{if(s.nodeType===1){if(r.has(s)){r.delete(s);return}s._x_marker||t.push(s)}})),e[o].type==="attributes")){let s=e[o].target,a=e[o].attributeName,c=e[o].oldValue,l=()=>{n.has(s)||n.set(s,[]),n.get(s).push({name:a,value:s.getAttribute(a)})},u=()=>{i.has(s)||i.set(s,[]),i.get(s).push(a)};s.hasAttribute(a)&&c===null?l():s.hasAttribute(a)?(u(),l()):u()}i.forEach((o,s)=>{lt(s,o)}),n.forEach((o,s)=>{Xt.forEach(a=>a(s,o))});for(let o of r)t.some(s=>s.contains(o))||Zt.forEach(s=>s(o));for(let o of t)o.isConnected&&Qt.forEach(s=>s(o));t=null,r=null,n=null,i=null}function Ce(e){return z(B(e))}function k(e,t,r){return e._x_dataStack=[t,...B(r||e)],()=>{e._x_dataStack=e._x_dataStack.filter(n=>n!==t)}}function B(e){return e._x_dataStack?e._x_dataStack:typeof ShadowRoot=="function"&&e instanceof ShadowRoot?B(e.host):e.parentNode?B(e.parentNode):[]}function z(e){return new Proxy({objects:e},Dn)}var Dn={ownKeys({objects:e}){return Array.from(new Set(e.flatMap(t=>Object.keys(t))))},has({objects:e},t){return t==Symbol.unscopables?!1:e.some(r=>Object.prototype.hasOwnProperty.call(r,t)||Reflect.has(r,t))},get({objects:e},t,r){return t=="toJSON"?Pn:Reflect.get(e.find(n=>Reflect.has(n,t))||{},t,r)},set({objects:e},t,r,n){let i=e.find(s=>Object.prototype.hasOwnProperty.call(s,t))||e[e.length-1],o=Object.getOwnPropertyDescriptor(i,t);return o?.set&&o?.get?o.set.call(n,r)||!0:Reflect.set(i,t,r)}};function Pn(){return Reflect.ownKeys(this).reduce((t,r)=>(t[r]=Reflect.get(this,r),t),{})}function Te(e){let t=n=>typeof n=="object"&&!Array.isArray(n)&&n!==null,r=(n,i="")=>{Object.entries(Object.getOwnPropertyDescriptors(n)).forEach(([o,{value:s,enumerable:a}])=>{if(a===!1||s===void 0||typeof s=="object"&&s!==null&&s.__v_skip)return;let c=i===""?o:`${i}.${o}`;typeof s=="object"&&s!==null&&s._x_interceptor?n[o]=s.initialize(e,c,o):t(s)&&s!==n&&!(s instanceof Element)&&r(s,c)})};return r(e)}function Re(e,t=()=>{}){let r={initialValue:void 0,_x_interceptor:!0,initialize(n,i,o){return e(this.initialValue,()=>In(n,i),s=>ht(n,i,s),i,o)}};return t(r),n=>{if(typeof n=="object"&&n!==null&&n._x_interceptor){let i=r.initialize.bind(r);r.initialize=(o,s,a)=>{let c=n.initialize(o,s,a);return r.initialValue=c,i(o,s,a)}}else r.initialValue=n;return r}}function In(e,t){return t.split(".").reduce((r,n)=>r[n],e)}function ht(e,t,r){if(typeof t=="string"&&(t=t.split(".")),t.length===1)e[t[0]]=r;else{if(t.length===0)throw error;return e[t[0]]||(e[t[0]]={}),ht(e[t[0]],t.slice(1),r)}}var ir={};function y(e,t){ir[e]=t}function fe(e,t){let r=Ln(t);return Object.entries(ir).forEach(([n,i])=>{Object.defineProperty(e,`$${n}`,{get(){return i(t,r)},enumerable:!1})}),e}function Ln(e){let[t,r]=_t(e),n={interceptor:Re,...t};return te(e,r),n}function or(e,t,r,...n){try{return r(...n)}catch(i){re(i,e,t)}}function re(e,t,r=void 0){e=Object.assign(e??{message:"No error message given."},{el:t,expression:r}),console.warn(`Alpine Expression Error: ${e.message}

${r?'Expression: "'+r+`"

`:""}`,t),setTimeout(()=>{throw e},0)}var Me=!0;function ke(e){let t=Me;Me=!1;let r=e();return Me=t,r}function R(e,t,r={}){let n;return x(e,t)(i=>n=i,r),n}function x(...e){return sr(...e)}var sr=xt;function ar(e){sr=e}function xt(e,t){let r={};fe(r,e);let n=[r,...B(e)],i=typeof t=="function"?$n(n,t):Fn(n,t,e);return or.bind(null,e,t,i)}function $n(e,t){return(r=()=>{},{scope:n={},params:i=[]}={})=>{let o=t.apply(z([n,...e]),i);Ne(r,o)}}var gt={};function jn(e,t){if(gt[e])return gt[e];let r=Object.getPrototypeOf(async function(){}).constructor,n=/^[\n\s]*if.*\(.*\)/.test(e.trim())||/^(let|const)\s/.test(e.trim())?`(async()=>{ ${e} })()`:e,o=(()=>{try{let s=new r(["__self","scope"],`with (scope) { __self.result = ${n} }; __self.finished = true; return __self.result;`);return Object.defineProperty(s,"name",{value:`[Alpine] ${e}`}),s}catch(s){return re(s,t,e),Promise.resolve()}})();return gt[e]=o,o}function Fn(e,t,r){let n=jn(t,r);return(i=()=>{},{scope:o={},params:s=[]}={})=>{n.result=void 0,n.finished=!1;let a=z([o,...e]);if(typeof n=="function"){let c=n(n,a).catch(l=>re(l,r,t));n.finished?(Ne(i,n.result,a,s,r),n.result=void 0):c.then(l=>{Ne(i,l,a,s,r)}).catch(l=>re(l,r,t)).finally(()=>n.result=void 0)}}}function Ne(e,t,r,n,i){if(Me&&typeof t=="function"){let o=t.apply(r,n);o instanceof Promise?o.then(s=>Ne(e,s,r,n)).catch(s=>re(s,i,t)):e(o)}else typeof t=="object"&&t instanceof Promise?t.then(o=>e(o)):e(t)}var wt="x-";function C(e=""){return wt+e}function cr(e){wt=e}var De={};function d(e,t){return De[e]=t,{before(r){if(!De[r]){console.warn(String.raw`Cannot find directive \`${r}\`. \`${e}\` will use the default order of execution`);return}let n=G.indexOf(r);G.splice(n>=0?n:G.indexOf("DEFAULT"),0,e)}}}function lr(e){return Object.keys(De).includes(e)}function pe(e,t,r){if(t=Array.from(t),e._x_virtualDirectives){let o=Object.entries(e._x_virtualDirectives).map(([a,c])=>({name:a,value:c})),s=Et(o);o=o.map(a=>s.find(c=>c.name===a.name)?{name:`x-bind:${a.name}`,value:`"${a.value}"`}:a),t=t.concat(o)}let n={};return t.map(dr((o,s)=>n[o]=s)).filter(mr).map(zn(n,r)).sort(Kn).map(o=>Bn(e,o))}function Et(e){return Array.from(e).map(dr()).filter(t=>!mr(t))}var yt=!1,de=new Map,ur=Symbol();function fr(e){yt=!0;let t=Symbol();ur=t,de.set(t,[]);let r=()=>{for(;de.get(t).length;)de.get(t).shift()();de.delete(t)},n=()=>{yt=!1,r()};e(r),n()}function _t(e){let t=[],r=a=>t.push(a),[n,i]=Yt(e);return t.push(i),[{Alpine:K,effect:n,cleanup:r,evaluateLater:x.bind(x,e),evaluate:R.bind(R,e)},()=>t.forEach(a=>a())]}function Bn(e,t){let r=()=>{},n=De[t.type]||r,[i,o]=_t(e);Oe(e,t.original,o);let s=()=>{e._x_ignore||e._x_ignoreSelf||(n.inline&&n.inline(e,t,i),n=n.bind(n,e,t,i),yt?de.get(ur).push(n):n())};return s.runCleanups=o,s}var Pe=(e,t)=>({name:r,value:n})=>(r.startsWith(e)&&(r=r.replace(e,t)),{name:r,value:n}),Ie=e=>e;function dr(e=()=>{}){return({name:t,value:r})=>{let{name:n,value:i}=pr.reduce((o,s)=>s(o),{name:t,value:r});return n!==t&&e(n,t),{name:n,value:i}}}var pr=[];function ne(e){pr.push(e)}function mr({name:e}){return hr().test(e)}var hr=()=>new RegExp(`^${wt}([^:^.]+)\\b`);function zn(e,t){return({name:r,value:n})=>{let i=r.match(hr()),o=r.match(/:([a-zA-Z0-9\-_:]+)/),s=r.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],a=t||e[r]||r;return{type:i?i[1]:null,value:o?o[1]:null,modifiers:s.map(c=>c.replace(".","")),expression:n,original:a}}}var bt="DEFAULT",G=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",bt,"teleport"];function Kn(e,t){let r=G.indexOf(e.type)===-1?bt:e.type,n=G.indexOf(t.type)===-1?bt:t.type;return G.indexOf(r)-G.indexOf(n)}function J(e,t,r={}){e.dispatchEvent(new CustomEvent(t,{detail:r,bubbles:!0,composed:!0,cancelable:!0}))}function D(e,t){if(typeof ShadowRoot=="function"&&e instanceof ShadowRoot){Array.from(e.children).forEach(i=>D(i,t));return}let r=!1;if(t(e,()=>r=!0),r)return;let n=e.firstElementChild;for(;n;)D(n,t,!1),n=n.nextElementSibling}function E(e,...t){console.warn(`Alpine Warning: ${e}`,...t)}var _r=!1;function gr(){_r&&E("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),_r=!0,document.body||E("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),J(document,"alpine:init"),J(document,"alpine:initializing"),ue(),er(t=>S(t,D)),te(t=>P(t)),Ae((t,r)=>{pe(t,r).forEach(n=>n())});let e=t=>!Y(t.parentElement,!0);Array.from(document.querySelectorAll(br().join(","))).filter(e).forEach(t=>{S(t)}),J(document,"alpine:initialized"),setTimeout(()=>{Vn()})}var vt=[],xr=[];function yr(){return vt.map(e=>e())}function br(){return vt.concat(xr).map(e=>e())}function Le(e){vt.push(e)}function $e(e){xr.push(e)}function Y(e,t=!1){return j(e,r=>{if((t?br():yr()).some(i=>r.matches(i)))return!0})}function j(e,t){if(e){if(t(e))return e;if(e._x_teleportBack&&(e=e._x_teleportBack),!!e.parentElement)return j(e.parentElement,t)}}function wr(e){return yr().some(t=>e.matches(t))}var Er=[];function vr(e){Er.push(e)}var Hn=1;function S(e,t=D,r=()=>{}){j(e,n=>n._x_ignore)||fr(()=>{t(e,(n,i)=>{n._x_marker||(r(n,i),Er.forEach(o=>o(n,i)),pe(n,n.attributes).forEach(o=>o()),n._x_ignore||(n._x_marker=Hn++),n._x_ignore&&i())})})}function P(e,t=D){t(e,r=>{tr(r),lt(r),delete r._x_marker})}function Vn(){[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([t,r,n])=>{lr(r)||n.some(i=>{if(document.querySelector(i))return E(`found "${i}", but missing ${t} plugin`),!0})})}var St=[],At=!1;function ie(e=()=>{}){return queueMicrotask(()=>{At||setTimeout(()=>{je()})}),new Promise(t=>{St.push(()=>{e(),t()})})}function je(){for(At=!1;St.length;)St.shift()()}function Sr(){At=!0}function me(e,t){return Array.isArray(t)?Ar(e,t.join(" ")):typeof t=="object"&&t!==null?qn(e,t):typeof t=="function"?me(e,t()):Ar(e,t)}function Ar(e,t){let r=o=>o.split(" ").filter(Boolean),n=o=>o.split(" ").filter(s=>!e.classList.contains(s)).filter(Boolean),i=o=>(e.classList.add(...o),()=>{e.classList.remove(...o)});return t=t===!0?t="":t||"",i(n(t))}function qn(e,t){let r=a=>a.split(" ").filter(Boolean),n=Object.entries(t).flatMap(([a,c])=>c?r(a):!1).filter(Boolean),i=Object.entries(t).flatMap(([a,c])=>c?!1:r(a)).filter(Boolean),o=[],s=[];return i.forEach(a=>{e.classList.contains(a)&&(e.classList.remove(a),s.push(a))}),n.forEach(a=>{e.classList.contains(a)||(e.classList.add(a),o.push(a))}),()=>{s.forEach(a=>e.classList.add(a)),o.forEach(a=>e.classList.remove(a))}}function X(e,t){return typeof t=="object"&&t!==null?Un(e,t):Wn(e,t)}function Un(e,t){let r={};return Object.entries(t).forEach(([n,i])=>{r[n]=e.style[n],n.startsWith("--")||(n=Gn(n)),e.style.setProperty(n,i)}),setTimeout(()=>{e.style.length===0&&e.removeAttribute("style")}),()=>{X(e,r)}}function Wn(e,t){let r=e.getAttribute("style",t);return e.setAttribute("style",t),()=>{e.setAttribute("style",r||"")}}function Gn(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function he(e,t=()=>{}){let r=!1;return function(){r?t.apply(this,arguments):(r=!0,e.apply(this,arguments))}}d("transition",(e,{value:t,modifiers:r,expression:n},{evaluate:i})=>{typeof n=="function"&&(n=i(n)),n!==!1&&(!n||typeof n=="boolean"?Yn(e,r,t):Jn(e,n,t))});function Jn(e,t,r){Or(e,me,""),{enter:i=>{e._x_transition.enter.during=i},"enter-start":i=>{e._x_transition.enter.start=i},"enter-end":i=>{e._x_transition.enter.end=i},leave:i=>{e._x_transition.leave.during=i},"leave-start":i=>{e._x_transition.leave.start=i},"leave-end":i=>{e._x_transition.leave.end=i}}[r](t)}function Yn(e,t,r){Or(e,X);let n=!t.includes("in")&&!t.includes("out")&&!r,i=n||t.includes("in")||["enter"].includes(r),o=n||t.includes("out")||["leave"].includes(r);t.includes("in")&&!n&&(t=t.filter((g,b)=>b<t.indexOf("out"))),t.includes("out")&&!n&&(t=t.filter((g,b)=>b>t.indexOf("out")));let s=!t.includes("opacity")&&!t.includes("scale"),a=s||t.includes("opacity"),c=s||t.includes("scale"),l=a?0:1,u=c?_e(t,"scale",95)/100:1,p=_e(t,"delay",0)/1e3,h=_e(t,"origin","center"),w="opacity, transform",F=_e(t,"duration",150)/1e3,Ee=_e(t,"duration",75)/1e3,f="cubic-bezier(0.4, 0.0, 0.2, 1)";i&&(e._x_transition.enter.during={transformOrigin:h,transitionDelay:`${p}s`,transitionProperty:w,transitionDuration:`${F}s`,transitionTimingFunction:f},e._x_transition.enter.start={opacity:l,transform:`scale(${u})`},e._x_transition.enter.end={opacity:1,transform:"scale(1)"}),o&&(e._x_transition.leave.during={transformOrigin:h,transitionDelay:`${p}s`,transitionProperty:w,transitionDuration:`${Ee}s`,transitionTimingFunction:f},e._x_transition.leave.start={opacity:1,transform:"scale(1)"},e._x_transition.leave.end={opacity:l,transform:`scale(${u})`})}function Or(e,t,r={}){e._x_transition||(e._x_transition={enter:{during:r,start:r,end:r},leave:{during:r,start:r,end:r},in(n=()=>{},i=()=>{}){Fe(e,t,{during:this.enter.during,start:this.enter.start,end:this.enter.end},n,i)},out(n=()=>{},i=()=>{}){Fe(e,t,{during:this.leave.during,start:this.leave.start,end:this.leave.end},n,i)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(e,t,r,n){let i=document.visibilityState==="visible"?requestAnimationFrame:setTimeout,o=()=>i(r);if(t){e._x_transition&&(e._x_transition.enter||e._x_transition.leave)?e._x_transition.enter&&(Object.entries(e._x_transition.enter.during).length||Object.entries(e._x_transition.enter.start).length||Object.entries(e._x_transition.enter.end).length)?e._x_transition.in(r):o():e._x_transition?e._x_transition.in(r):o();return}e._x_hidePromise=e._x_transition?new Promise((s,a)=>{e._x_transition.out(()=>{},()=>s(n)),e._x_transitioning&&e._x_transitioning.beforeCancel(()=>a({isFromCancelledTransition:!0}))}):Promise.resolve(n),queueMicrotask(()=>{let s=Cr(e);s?(s._x_hideChildren||(s._x_hideChildren=[]),s._x_hideChildren.push(e)):i(()=>{let a=c=>{let l=Promise.all([c._x_hidePromise,...(c._x_hideChildren||[]).map(a)]).then(([u])=>u?.());return delete c._x_hidePromise,delete c._x_hideChildren,l};a(e).catch(c=>{if(!c.isFromCancelledTransition)throw c})})})};function Cr(e){let t=e.parentNode;if(t)return t._x_hidePromise?t:Cr(t)}function Fe(e,t,{during:r,start:n,end:i}={},o=()=>{},s=()=>{}){if(e._x_transitioning&&e._x_transitioning.cancel(),Object.keys(r).length===0&&Object.keys(n).length===0&&Object.keys(i).length===0){o(),s();return}let a,c,l;Xn(e,{start(){a=t(e,n)},during(){c=t(e,r)},before:o,end(){a(),l=t(e,i)},after:s,cleanup(){c(),l()}})}function Xn(e,t){let r,n,i,o=he(()=>{m(()=>{r=!0,n||t.before(),i||(t.end(),je()),t.after(),e.isConnected&&t.cleanup(),delete e._x_transitioning})});e._x_transitioning={beforeCancels:[],beforeCancel(s){this.beforeCancels.push(s)},cancel:he(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();o()}),finish:o},m(()=>{t.start(),t.during()}),Sr(),requestAnimationFrame(()=>{if(r)return;let s=Number(getComputedStyle(e).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,a=Number(getComputedStyle(e).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;s===0&&(s=Number(getComputedStyle(e).animationDuration.replace("s",""))*1e3),m(()=>{t.before()}),n=!0,requestAnimationFrame(()=>{r||(m(()=>{t.end()}),je(),setTimeout(e._x_transitioning.finish,s+a),i=!0)})})}function _e(e,t,r){if(e.indexOf(t)===-1)return r;let n=e[e.indexOf(t)+1];if(!n||t==="scale"&&isNaN(n))return r;if(t==="duration"||t==="delay"){let i=n.match(/([0-9]+)ms/);if(i)return i[1]}return t==="origin"&&["top","right","left","center","bottom"].includes(e[e.indexOf(t)+2])?[n,e[e.indexOf(t)+2]].join(" "):n}var I=!1;function A(e,t=()=>{}){return(...r)=>I?t(...r):e(...r)}function Tr(e){return(...t)=>I&&e(...t)}var Rr=[];function H(e){Rr.push(e)}function Mr(e,t){Rr.forEach(r=>r(e,t)),I=!0,kr(()=>{S(t,(r,n)=>{n(r,()=>{})})}),I=!1}var Be=!1;function Nr(e,t){t._x_dataStack||(t._x_dataStack=e._x_dataStack),I=!0,Be=!0,kr(()=>{Zn(t)}),I=!1,Be=!1}function Zn(e){let t=!1;S(e,(n,i)=>{D(n,(o,s)=>{if(t&&wr(o))return s();t=!0,i(o,s)})})}function kr(e){let t=N;ct((r,n)=>{let i=t(r);return $(i),()=>{}}),e(),ct(t)}function ge(e,t,r,n=[]){switch(e._x_bindings||(e._x_bindings=T({})),e._x_bindings[t]=r,t=n.includes("camel")?si(t):t,t){case"value":Qn(e,r);break;case"style":ti(e,r);break;case"class":ei(e,r);break;case"selected":case"checked":ri(e,t,r);break;default:Pr(e,t,r);break}}function Qn(e,t){if(Ot(e))e.attributes.value===void 0&&(e.value=t),window.fromModel&&(typeof t=="boolean"?e.checked=xe(e.value)===t:e.checked=Dr(e.value,t));else if(ze(e))Number.isInteger(t)?e.value=t:!Array.isArray(t)&&typeof t!="boolean"&&![null,void 0].includes(t)?e.value=String(t):Array.isArray(t)?e.checked=t.some(r=>Dr(r,e.value)):e.checked=!!t;else if(e.tagName==="SELECT")oi(e,t);else{if(e.value===t)return;e.value=t===void 0?"":t}}function ei(e,t){e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedClasses=me(e,t)}function ti(e,t){e._x_undoAddedStyles&&e._x_undoAddedStyles(),e._x_undoAddedStyles=X(e,t)}function ri(e,t,r){Pr(e,t,r),ii(e,t,r)}function Pr(e,t,r){[null,void 0,!1].includes(r)&&ci(t)?e.removeAttribute(t):(Ir(t)&&(r=t),ni(e,t,r))}function ni(e,t,r){e.getAttribute(t)!=r&&e.setAttribute(t,r)}function ii(e,t,r){e[t]!==r&&(e[t]=r)}function oi(e,t){let r=[].concat(t).map(n=>n+"");Array.from(e.options).forEach(n=>{n.selected=r.includes(n.value)})}function si(e){return e.toLowerCase().replace(/-(\w)/g,(t,r)=>r.toUpperCase())}function Dr(e,t){return e==t}function xe(e){return[1,"1","true","on","yes",!0].includes(e)?!0:[0,"0","false","off","no",!1].includes(e)?!1:e?Boolean(e):null}var ai=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function Ir(e){return ai.has(e)}function ci(e){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(e)}function Lr(e,t,r){return e._x_bindings&&e._x_bindings[t]!==void 0?e._x_bindings[t]:jr(e,t,r)}function $r(e,t,r,n=!0){if(e._x_bindings&&e._x_bindings[t]!==void 0)return e._x_bindings[t];if(e._x_inlineBindings&&e._x_inlineBindings[t]!==void 0){let i=e._x_inlineBindings[t];return i.extract=n,ke(()=>R(e,i.expression))}return jr(e,t,r)}function jr(e,t,r){let n=e.getAttribute(t);return n===null?typeof r=="function"?r():r:n===""?!0:Ir(t)?!![t,"true"].includes(n):n}function ze(e){return e.type==="checkbox"||e.localName==="ui-checkbox"||e.localName==="ui-switch"}function Ot(e){return e.type==="radio"||e.localName==="ui-radio"}function Ke(e,t){var r;return function(){var n=this,i=arguments,o=function(){r=null,e.apply(n,i)};clearTimeout(r),r=setTimeout(o,t)}}function He(e,t){let r;return function(){let n=this,i=arguments;r||(e.apply(n,i),r=!0,setTimeout(()=>r=!1,t))}}function Ve({get:e,set:t},{get:r,set:n}){let i=!0,o,s,a=N(()=>{let c=e(),l=r();if(i)n(Ct(c)),i=!1;else{let u=JSON.stringify(c),p=JSON.stringify(l);u!==o?n(Ct(c)):u!==p&&t(Ct(l))}o=JSON.stringify(e()),s=JSON.stringify(r())});return()=>{$(a)}}function Ct(e){return typeof e=="object"?JSON.parse(JSON.stringify(e)):e}function Fr(e){(Array.isArray(e)?e:[e]).forEach(r=>r(K))}var Z={},Br=!1;function zr(e,t){if(Br||(Z=T(Z),Br=!0),t===void 0)return Z[e];Z[e]=t,Te(Z[e]),typeof t=="object"&&t!==null&&t.hasOwnProperty("init")&&typeof t.init=="function"&&Z[e].init()}function Kr(){return Z}var Hr={};function Vr(e,t){let r=typeof t!="function"?()=>t:t;return e instanceof Element?Tt(e,r()):(Hr[e]=r,()=>{})}function qr(e){return Object.entries(Hr).forEach(([t,r])=>{Object.defineProperty(e,t,{get(){return(...n)=>r(...n)}})}),e}function Tt(e,t,r){let n=[];for(;n.length;)n.pop()();let i=Object.entries(t).map(([s,a])=>({name:s,value:a})),o=Et(i);return i=i.map(s=>o.find(a=>a.name===s.name)?{name:`x-bind:${s.name}`,value:`"${s.value}"`}:s),pe(e,i,r).map(s=>{n.push(s.runCleanups),s()}),()=>{for(;n.length;)n.pop()()}}var Ur={};function Wr(e,t){Ur[e]=t}function Gr(e,t){return Object.entries(Ur).forEach(([r,n])=>{Object.defineProperty(e,r,{get(){return(...i)=>n.bind(t)(...i)},enumerable:!1})}),e}var li={get reactive(){return T},get release(){return $},get effect(){return N},get raw(){return at},version:"3.14.8",flushAndStopDeferringMutations:nr,dontAutoEvaluateFunctions:ke,disableEffectScheduling:Gt,startObservingMutations:ue,stopObservingMutations:dt,setReactivityEngine:Jt,onAttributeRemoved:Oe,onAttributesAdded:Ae,closestDataStack:B,skipDuringClone:A,onlyDuringClone:Tr,addRootSelector:Le,addInitSelector:$e,interceptClone:H,addScopeToNode:k,deferMutations:rr,mapAttributes:ne,evaluateLater:x,interceptInit:vr,setEvaluator:ar,mergeProxies:z,extractProp:$r,findClosest:j,onElRemoved:te,closestRoot:Y,destroyTree:P,interceptor:Re,transition:Fe,setStyles:X,mutateDom:m,directive:d,entangle:Ve,throttle:He,debounce:Ke,evaluate:R,initTree:S,nextTick:ie,prefixed:C,prefix:cr,plugin:Fr,magic:y,store:zr,start:gr,clone:Nr,cloneNode:Mr,bound:Lr,$data:Ce,watch:ve,walk:D,data:Wr,bind:Vr},K=li;function Rt(e,t){let r=Object.create(null),n=e.split(",");for(let i=0;i<n.length;i++)r[n[i]]=!0;return t?i=>!!r[i.toLowerCase()]:i=>!!r[i]}var ui="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly";var Ls=Rt(ui+",async,autofocus,autoplay,controls,default,defer,disabled,hidden,loop,open,required,reversed,scoped,seamless,checked,muted,multiple,selected");var Jr=Object.freeze({}),$s=Object.freeze([]);var fi=Object.prototype.hasOwnProperty,ye=(e,t)=>fi.call(e,t),V=Array.isArray,oe=e=>Yr(e)==="[object Map]";var di=e=>typeof e=="string",qe=e=>typeof e=="symbol",be=e=>e!==null&&typeof e=="object";var pi=Object.prototype.toString,Yr=e=>pi.call(e),Mt=e=>Yr(e).slice(8,-1);var Ue=e=>di(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e;var We=e=>{let t=Object.create(null);return r=>t[r]||(t[r]=e(r))},mi=/-(\w)/g,js=We(e=>e.replace(mi,(t,r)=>r?r.toUpperCase():"")),hi=/\B([A-Z])/g,Fs=We(e=>e.replace(hi,"-$1").toLowerCase()),Nt=We(e=>e.charAt(0).toUpperCase()+e.slice(1)),Bs=We(e=>e?`on${Nt(e)}`:""),kt=(e,t)=>e!==t&&(e===e||t===t);var Dt=new WeakMap,we=[],L,Q=Symbol("iterate"),Pt=Symbol("Map key iterate");function _i(e){return e&&e._isEffect===!0}function rn(e,t=Jr){_i(e)&&(e=e.raw);let r=xi(e,t);return t.lazy||r(),r}function nn(e){e.active&&(on(e),e.options.onStop&&e.options.onStop(),e.active=!1)}var gi=0;function xi(e,t){let r=function(){if(!r.active)return e();if(!we.includes(r)){on(r);try{return bi(),we.push(r),L=r,e()}finally{we.pop(),sn(),L=we[we.length-1]}}};return r.id=gi++,r.allowRecurse=!!t.allowRecurse,r._isEffect=!0,r.active=!0,r.raw=e,r.deps=[],r.options=t,r}function on(e){let{deps:t}=e;if(t.length){for(let r=0;r<t.length;r++)t[r].delete(e);t.length=0}}var se=!0,Lt=[];function yi(){Lt.push(se),se=!1}function bi(){Lt.push(se),se=!0}function sn(){let e=Lt.pop();se=e===void 0?!0:e}function M(e,t,r){if(!se||L===void 0)return;let n=Dt.get(e);n||Dt.set(e,n=new Map);let i=n.get(r);i||n.set(r,i=new Set),i.has(L)||(i.add(L),L.deps.push(i),L.options.onTrack&&L.options.onTrack({effect:L,target:e,type:t,key:r}))}function U(e,t,r,n,i,o){let s=Dt.get(e);if(!s)return;let a=new Set,c=u=>{u&&u.forEach(p=>{(p!==L||p.allowRecurse)&&a.add(p)})};if(t==="clear")s.forEach(c);else if(r==="length"&&V(e))s.forEach((u,p)=>{(p==="length"||p>=n)&&c(u)});else switch(r!==void 0&&c(s.get(r)),t){case"add":V(e)?Ue(r)&&c(s.get("length")):(c(s.get(Q)),oe(e)&&c(s.get(Pt)));break;case"delete":V(e)||(c(s.get(Q)),oe(e)&&c(s.get(Pt)));break;case"set":oe(e)&&c(s.get(Q));break}let l=u=>{u.options.onTrigger&&u.options.onTrigger({effect:u,target:e,key:r,type:t,newValue:n,oldValue:i,oldTarget:o}),u.options.scheduler?u.options.scheduler(u):u()};a.forEach(l)}var wi=Rt("__proto__,__v_isRef,__isVue"),an=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(qe)),Ei=cn();var vi=cn(!0);var Xr=Si();function Si(){let e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...r){let n=_(this);for(let o=0,s=this.length;o<s;o++)M(n,"get",o+"");let i=n[t](...r);return i===-1||i===!1?n[t](...r.map(_)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...r){yi();let n=_(this)[t].apply(this,r);return sn(),n}}),e}function cn(e=!1,t=!1){return function(n,i,o){if(i==="__v_isReactive")return!e;if(i==="__v_isReadonly")return e;if(i==="__v_raw"&&o===(e?t?Bi:dn:t?Fi:fn).get(n))return n;let s=V(n);if(!e&&s&&ye(Xr,i))return Reflect.get(Xr,i,o);let a=Reflect.get(n,i,o);return(qe(i)?an.has(i):wi(i))||(e||M(n,"get",i),t)?a:It(a)?!s||!Ue(i)?a.value:a:be(a)?e?pn(a):et(a):a}}var Ai=Oi();function Oi(e=!1){return function(r,n,i,o){let s=r[n];if(!e&&(i=_(i),s=_(s),!V(r)&&It(s)&&!It(i)))return s.value=i,!0;let a=V(r)&&Ue(n)?Number(n)<r.length:ye(r,n),c=Reflect.set(r,n,i,o);return r===_(o)&&(a?kt(i,s)&&U(r,"set",n,i,s):U(r,"add",n,i)),c}}function Ci(e,t){let r=ye(e,t),n=e[t],i=Reflect.deleteProperty(e,t);return i&&r&&U(e,"delete",t,void 0,n),i}function Ti(e,t){let r=Reflect.has(e,t);return(!qe(t)||!an.has(t))&&M(e,"has",t),r}function Ri(e){return M(e,"iterate",V(e)?"length":Q),Reflect.ownKeys(e)}var Mi={get:Ei,set:Ai,deleteProperty:Ci,has:Ti,ownKeys:Ri},Ni={get:vi,set(e,t){return console.warn(`Set operation on key "${String(t)}" failed: target is readonly.`,e),!0},deleteProperty(e,t){return console.warn(`Delete operation on key "${String(t)}" failed: target is readonly.`,e),!0}};var $t=e=>be(e)?et(e):e,jt=e=>be(e)?pn(e):e,Ft=e=>e,Qe=e=>Reflect.getPrototypeOf(e);function Ge(e,t,r=!1,n=!1){e=e.__v_raw;let i=_(e),o=_(t);t!==o&&!r&&M(i,"get",t),!r&&M(i,"get",o);let{has:s}=Qe(i),a=n?Ft:r?jt:$t;if(s.call(i,t))return a(e.get(t));if(s.call(i,o))return a(e.get(o));e!==i&&e.get(t)}function Je(e,t=!1){let r=this.__v_raw,n=_(r),i=_(e);return e!==i&&!t&&M(n,"has",e),!t&&M(n,"has",i),e===i?r.has(e):r.has(e)||r.has(i)}function Ye(e,t=!1){return e=e.__v_raw,!t&&M(_(e),"iterate",Q),Reflect.get(e,"size",e)}function Zr(e){e=_(e);let t=_(this);return Qe(t).has.call(t,e)||(t.add(e),U(t,"add",e,e)),this}function Qr(e,t){t=_(t);let r=_(this),{has:n,get:i}=Qe(r),o=n.call(r,e);o?un(r,n,e):(e=_(e),o=n.call(r,e));let s=i.call(r,e);return r.set(e,t),o?kt(t,s)&&U(r,"set",e,t,s):U(r,"add",e,t),this}function en(e){let t=_(this),{has:r,get:n}=Qe(t),i=r.call(t,e);i?un(t,r,e):(e=_(e),i=r.call(t,e));let o=n?n.call(t,e):void 0,s=t.delete(e);return i&&U(t,"delete",e,void 0,o),s}function tn(){let e=_(this),t=e.size!==0,r=oe(e)?new Map(e):new Set(e),n=e.clear();return t&&U(e,"clear",void 0,void 0,r),n}function Xe(e,t){return function(n,i){let o=this,s=o.__v_raw,a=_(s),c=t?Ft:e?jt:$t;return!e&&M(a,"iterate",Q),s.forEach((l,u)=>n.call(i,c(l),c(u),o))}}function Ze(e,t,r){return function(...n){let i=this.__v_raw,o=_(i),s=oe(o),a=e==="entries"||e===Symbol.iterator&&s,c=e==="keys"&&s,l=i[e](...n),u=r?Ft:t?jt:$t;return!t&&M(o,"iterate",c?Pt:Q),{next(){let{value:p,done:h}=l.next();return h?{value:p,done:h}:{value:a?[u(p[0]),u(p[1])]:u(p),done:h}},[Symbol.iterator](){return this}}}}function q(e){return function(...t){{let r=t[0]?`on key "${t[0]}" `:"";console.warn(`${Nt(e)} operation ${r}failed: target is readonly.`,_(this))}return e==="delete"?!1:this}}function ki(){let e={get(o){return Ge(this,o)},get size(){return Ye(this)},has:Je,add:Zr,set:Qr,delete:en,clear:tn,forEach:Xe(!1,!1)},t={get(o){return Ge(this,o,!1,!0)},get size(){return Ye(this)},has:Je,add:Zr,set:Qr,delete:en,clear:tn,forEach:Xe(!1,!0)},r={get(o){return Ge(this,o,!0)},get size(){return Ye(this,!0)},has(o){return Je.call(this,o,!0)},add:q("add"),set:q("set"),delete:q("delete"),clear:q("clear"),forEach:Xe(!0,!1)},n={get(o){return Ge(this,o,!0,!0)},get size(){return Ye(this,!0)},has(o){return Je.call(this,o,!0)},add:q("add"),set:q("set"),delete:q("delete"),clear:q("clear"),forEach:Xe(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(o=>{e[o]=Ze(o,!1,!1),r[o]=Ze(o,!0,!1),t[o]=Ze(o,!1,!0),n[o]=Ze(o,!0,!0)}),[e,r,t,n]}var[Di,Pi,Ii,Li]=ki();function ln(e,t){let r=t?e?Li:Ii:e?Pi:Di;return(n,i,o)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?n:Reflect.get(ye(r,i)&&i in n?r:n,i,o)}var $i={get:ln(!1,!1)};var ji={get:ln(!0,!1)};function un(e,t,r){let n=_(r);if(n!==r&&t.call(e,n)){let i=Mt(e);console.warn(`Reactive ${i} contains both the raw and reactive versions of the same object${i==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var fn=new WeakMap,Fi=new WeakMap,dn=new WeakMap,Bi=new WeakMap;function zi(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Ki(e){return e.__v_skip||!Object.isExtensible(e)?0:zi(Mt(e))}function et(e){return e&&e.__v_isReadonly?e:mn(e,!1,Mi,$i,fn)}function pn(e){return mn(e,!0,Ni,ji,dn)}function mn(e,t,r,n,i){if(!be(e))return console.warn(`value cannot be made reactive: ${String(e)}`),e;if(e.__v_raw&&!(t&&e.__v_isReactive))return e;let o=i.get(e);if(o)return o;let s=Ki(e);if(s===0)return e;let a=new Proxy(e,s===2?n:r);return i.set(e,a),a}function _(e){return e&&_(e.__v_raw)||e}function It(e){return Boolean(e&&e.__v_isRef===!0)}y("nextTick",()=>ie);y("dispatch",e=>J.bind(J,e));y("watch",(e,{evaluateLater:t,cleanup:r})=>(n,i)=>{let o=t(n),a=ve(()=>{let c;return o(l=>c=l),c},i);r(a)});y("store",Kr);y("data",e=>Ce(e));y("root",e=>Y(e));y("refs",e=>(e._x_refs_proxy||(e._x_refs_proxy=z(Hi(e))),e._x_refs_proxy));function Hi(e){let t=[];return j(e,r=>{r._x_refs&&t.push(r._x_refs)}),t}var Bt={};function zt(e){return Bt[e]||(Bt[e]=0),++Bt[e]}function hn(e,t){return j(e,r=>{if(r._x_ids&&r._x_ids[t])return!0})}function _n(e,t){e._x_ids||(e._x_ids={}),e._x_ids[t]||(e._x_ids[t]=zt(t))}y("id",(e,{cleanup:t})=>(r,n=null)=>{let i=`${r}${n?`-${n}`:""}`;return Vi(e,i,t,()=>{let o=hn(e,r),s=o?o._x_ids[r]:zt(r);return n?`${r}-${s}-${n}`:`${r}-${s}`})});H((e,t)=>{e._x_id&&(t._x_id=e._x_id)});function Vi(e,t,r,n){if(e._x_id||(e._x_id={}),e._x_id[t])return e._x_id[t];let i=n();return e._x_id[t]=i,r(()=>{delete e._x_id[t]}),i}y("el",e=>e);gn("Focus","focus","focus");gn("Persist","persist","persist");function gn(e,t,r){y(t,n=>E(`You can't use [$${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${r}`,n))}d("modelable",(e,{expression:t},{effect:r,evaluateLater:n,cleanup:i})=>{let o=n(t),s=()=>{let u;return o(p=>u=p),u},a=n(`${t} = __placeholder`),c=u=>a(()=>{},{scope:{__placeholder:u}}),l=s();c(l),queueMicrotask(()=>{if(!e._x_model)return;e._x_removeModelListeners.default();let u=e._x_model.get,p=e._x_model.set,h=Ve({get(){return u()},set(w){p(w)}},{get(){return s()},set(w){c(w)}});i(h)})});d("teleport",(e,{modifiers:t,expression:r},{cleanup:n})=>{e.tagName.toLowerCase()!=="template"&&E("x-teleport can only be used on a <template> tag",e);let i=xn(r),o=e.content.cloneNode(!0).firstElementChild;e._x_teleport=o,o._x_teleportBack=e,e.setAttribute("data-teleport-template",!0),o.setAttribute("data-teleport-target",!0),e._x_forwardEvents&&e._x_forwardEvents.forEach(a=>{o.addEventListener(a,c=>{c.stopPropagation(),e.dispatchEvent(new c.constructor(c.type,c))})}),k(o,{},e);let s=(a,c,l)=>{l.includes("prepend")?c.parentNode.insertBefore(a,c):l.includes("append")?c.parentNode.insertBefore(a,c.nextSibling):c.appendChild(a)};m(()=>{s(o,i,t),A(()=>{S(o)})()}),e._x_teleportPutBack=()=>{let a=xn(r);m(()=>{s(e._x_teleport,a,t)})},n(()=>m(()=>{o.remove(),P(o)}))});var qi=document.createElement("div");function xn(e){let t=A(()=>document.querySelector(e),()=>qi)();return t||E(`Cannot find x-teleport element for selector: "${e}"`),t}var yn=()=>{};yn.inline=(e,{modifiers:t},{cleanup:r})=>{t.includes("self")?e._x_ignoreSelf=!0:e._x_ignore=!0,r(()=>{t.includes("self")?delete e._x_ignoreSelf:delete e._x_ignore})};d("ignore",yn);d("effect",A((e,{expression:t},{effect:r})=>{r(x(e,t))}));function ae(e,t,r,n){let i=e,o=c=>n(c),s={},a=(c,l)=>u=>l(c,u);if(r.includes("dot")&&(t=Ui(t)),r.includes("camel")&&(t=Wi(t)),r.includes("passive")&&(s.passive=!0),r.includes("capture")&&(s.capture=!0),r.includes("window")&&(i=window),r.includes("document")&&(i=document),r.includes("debounce")){let c=r[r.indexOf("debounce")+1]||"invalid-wait",l=tt(c.split("ms")[0])?Number(c.split("ms")[0]):250;o=Ke(o,l)}if(r.includes("throttle")){let c=r[r.indexOf("throttle")+1]||"invalid-wait",l=tt(c.split("ms")[0])?Number(c.split("ms")[0]):250;o=He(o,l)}return r.includes("prevent")&&(o=a(o,(c,l)=>{l.preventDefault(),c(l)})),r.includes("stop")&&(o=a(o,(c,l)=>{l.stopPropagation(),c(l)})),r.includes("once")&&(o=a(o,(c,l)=>{c(l),i.removeEventListener(t,o,s)})),(r.includes("away")||r.includes("outside"))&&(i=document,o=a(o,(c,l)=>{e.contains(l.target)||l.target.isConnected!==!1&&(e.offsetWidth<1&&e.offsetHeight<1||e._x_isShown!==!1&&c(l))})),r.includes("self")&&(o=a(o,(c,l)=>{l.target===e&&c(l)})),(Ji(t)||wn(t))&&(o=a(o,(c,l)=>{Yi(l,r)||c(l)})),i.addEventListener(t,o,s),()=>{i.removeEventListener(t,o,s)}}function Ui(e){return e.replace(/-/g,".")}function Wi(e){return e.toLowerCase().replace(/-(\w)/g,(t,r)=>r.toUpperCase())}function tt(e){return!Array.isArray(e)&&!isNaN(e)}function Gi(e){return[" ","_"].includes(e)?e:e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function Ji(e){return["keydown","keyup"].includes(e)}function wn(e){return["contextmenu","click","mouse"].some(t=>e.includes(t))}function Yi(e,t){let r=t.filter(o=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(o));if(r.includes("debounce")){let o=r.indexOf("debounce");r.splice(o,tt((r[o+1]||"invalid-wait").split("ms")[0])?2:1)}if(r.includes("throttle")){let o=r.indexOf("throttle");r.splice(o,tt((r[o+1]||"invalid-wait").split("ms")[0])?2:1)}if(r.length===0||r.length===1&&bn(e.key).includes(r[0]))return!1;let i=["ctrl","shift","alt","meta","cmd","super"].filter(o=>r.includes(o));return r=r.filter(o=>!i.includes(o)),!(i.length>0&&i.filter(s=>((s==="cmd"||s==="super")&&(s="meta"),e[`${s}Key`])).length===i.length&&(wn(e.type)||bn(e.key).includes(r[0])))}function bn(e){if(!e)return[];e=Gi(e);let t={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return t[e]=e,Object.keys(t).map(r=>{if(t[r]===e)return r}).filter(r=>r)}d("model",(e,{modifiers:t,expression:r},{effect:n,cleanup:i})=>{let o=e;t.includes("parent")&&(o=e.parentNode);let s=x(o,r),a;typeof r=="string"?a=x(o,`${r} = __placeholder`):typeof r=="function"&&typeof r()=="string"?a=x(o,`${r()} = __placeholder`):a=()=>{};let c=()=>{let h;return s(w=>h=w),En(h)?h.get():h},l=h=>{let w;s(F=>w=F),En(w)?w.set(h):a(()=>{},{scope:{__placeholder:h}})};typeof r=="string"&&e.type==="radio"&&m(()=>{e.hasAttribute("name")||e.setAttribute("name",r)});var u=e.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(e.type)||t.includes("lazy")?"change":"input";let p=I?()=>{}:ae(e,u,t,h=>{l(Kt(e,t,h,c()))});if(t.includes("fill")&&([void 0,null,""].includes(c())||ze(e)&&Array.isArray(c())||e.tagName.toLowerCase()==="select"&&e.multiple)&&l(Kt(e,t,{target:e},c())),e._x_removeModelListeners||(e._x_removeModelListeners={}),e._x_removeModelListeners.default=p,i(()=>e._x_removeModelListeners.default()),e.form){let h=ae(e.form,"reset",[],w=>{ie(()=>e._x_model&&e._x_model.set(Kt(e,t,{target:e},c())))});i(()=>h())}e._x_model={get(){return c()},set(h){l(h)}},e._x_forceModelUpdate=h=>{h===void 0&&typeof r=="string"&&r.match(/\./)&&(h=""),window.fromModel=!0,m(()=>ge(e,"value",h)),delete window.fromModel},n(()=>{let h=c();t.includes("unintrusive")&&document.activeElement.isSameNode(e)||e._x_forceModelUpdate(h)})});function Kt(e,t,r,n){return m(()=>{if(r instanceof CustomEvent&&r.detail!==void 0)return r.detail!==null&&r.detail!==void 0?r.detail:r.target.value;if(ze(e))if(Array.isArray(n)){let i=null;return t.includes("number")?i=Ht(r.target.value):t.includes("boolean")?i=xe(r.target.value):i=r.target.value,r.target.checked?n.includes(i)?n:n.concat([i]):n.filter(o=>!Xi(o,i))}else return r.target.checked;else{if(e.tagName.toLowerCase()==="select"&&e.multiple)return t.includes("number")?Array.from(r.target.selectedOptions).map(i=>{let o=i.value||i.text;return Ht(o)}):t.includes("boolean")?Array.from(r.target.selectedOptions).map(i=>{let o=i.value||i.text;return xe(o)}):Array.from(r.target.selectedOptions).map(i=>i.value||i.text);{let i;return Ot(e)?r.target.checked?i=r.target.value:i=n:i=r.target.value,t.includes("number")?Ht(i):t.includes("boolean")?xe(i):t.includes("trim")?i.trim():i}}})}function Ht(e){let t=e?parseFloat(e):null;return Zi(t)?t:e}function Xi(e,t){return e==t}function Zi(e){return!Array.isArray(e)&&!isNaN(e)}function En(e){return e!==null&&typeof e=="object"&&typeof e.get=="function"&&typeof e.set=="function"}d("cloak",e=>queueMicrotask(()=>m(()=>e.removeAttribute(C("cloak")))));$e(()=>`[${C("init")}]`);d("init",A((e,{expression:t},{evaluate:r})=>typeof t=="string"?!!t.trim()&&r(t,{},!1):r(t,{},!1)));d("text",(e,{expression:t},{effect:r,evaluateLater:n})=>{let i=n(t);r(()=>{i(o=>{m(()=>{e.textContent=o})})})});d("html",(e,{expression:t},{effect:r,evaluateLater:n})=>{let i=n(t);r(()=>{i(o=>{m(()=>{e.innerHTML=o,e._x_ignoreSelf=!0,S(e),delete e._x_ignoreSelf})})})});ne(Pe(":",Ie(C("bind:"))));var vn=(e,{value:t,modifiers:r,expression:n,original:i},{effect:o,cleanup:s})=>{if(!t){let c={};qr(c),x(e,n)(u=>{Tt(e,u,i)},{scope:c});return}if(t==="key")return Qi(e,n);if(e._x_inlineBindings&&e._x_inlineBindings[t]&&e._x_inlineBindings[t].extract)return;let a=x(e,n);o(()=>a(c=>{c===void 0&&typeof n=="string"&&n.match(/\./)&&(c=""),m(()=>ge(e,t,c,r))})),s(()=>{e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedStyles&&e._x_undoAddedStyles()})};vn.inline=(e,{value:t,modifiers:r,expression:n})=>{t&&(e._x_inlineBindings||(e._x_inlineBindings={}),e._x_inlineBindings[t]={expression:n,extract:!1})};d("bind",vn);function Qi(e,t){e._x_keyExpression=t}Le(()=>`[${C("data")}]`);d("data",(e,{expression:t},{cleanup:r})=>{if(eo(e))return;t=t===""?"{}":t;let n={};fe(n,e);let i={};Gr(i,n);let o=R(e,t,{scope:i});(o===void 0||o===!0)&&(o={}),fe(o,e);let s=T(o);Te(s);let a=k(e,s);s.init&&R(e,s.init),r(()=>{s.destroy&&R(e,s.destroy),a()})});H((e,t)=>{e._x_dataStack&&(t._x_dataStack=e._x_dataStack,t.setAttribute("data-has-alpine-state",!0))});function eo(e){return I?Be?!0:e.hasAttribute("data-has-alpine-state"):!1}d("show",(e,{modifiers:t,expression:r},{effect:n})=>{let i=x(e,r);e._x_doHide||(e._x_doHide=()=>{m(()=>{e.style.setProperty("display","none",t.includes("important")?"important":void 0)})}),e._x_doShow||(e._x_doShow=()=>{m(()=>{e.style.length===1&&e.style.display==="none"?e.removeAttribute("style"):e.style.removeProperty("display")})});let o=()=>{e._x_doHide(),e._x_isShown=!1},s=()=>{e._x_doShow(),e._x_isShown=!0},a=()=>setTimeout(s),c=he(p=>p?s():o(),p=>{typeof e._x_toggleAndCascadeWithTransitions=="function"?e._x_toggleAndCascadeWithTransitions(e,p,s,o):p?a():o()}),l,u=!0;n(()=>i(p=>{!u&&p===l||(t.includes("immediate")&&(p?a():o()),c(p),l=p,u=!1)}))});d("for",(e,{expression:t},{effect:r,cleanup:n})=>{let i=ro(t),o=x(e,i.items),s=x(e,e._x_keyExpression||"index");e._x_prevKeys=[],e._x_lookup={},r(()=>to(e,i,o,s)),n(()=>{Object.values(e._x_lookup).forEach(a=>m(()=>{P(a),a.remove()})),delete e._x_prevKeys,delete e._x_lookup})});function to(e,t,r,n){let i=s=>typeof s=="object"&&!Array.isArray(s),o=e;r(s=>{no(s)&&s>=0&&(s=Array.from(Array(s).keys(),f=>f+1)),s===void 0&&(s=[]);let a=e._x_lookup,c=e._x_prevKeys,l=[],u=[];if(i(s))s=Object.entries(s).map(([f,g])=>{let b=Sn(t,g,f,s);n(v=>{u.includes(v)&&E("Duplicate key on x-for",e),u.push(v)},{scope:{index:f,...b}}),l.push(b)});else for(let f=0;f<s.length;f++){let g=Sn(t,s[f],f,s);n(b=>{u.includes(b)&&E("Duplicate key on x-for",e),u.push(b)},{scope:{index:f,...g}}),l.push(g)}let p=[],h=[],w=[],F=[];for(let f=0;f<c.length;f++){let g=c[f];u.indexOf(g)===-1&&w.push(g)}c=c.filter(f=>!w.includes(f));let Ee="template";for(let f=0;f<u.length;f++){let g=u[f],b=c.indexOf(g);if(b===-1)c.splice(f,0,g),p.push([Ee,f]);else if(b!==f){let v=c.splice(f,1)[0],O=c.splice(b-1,1)[0];c.splice(f,0,O),c.splice(b,0,v),h.push([v,O])}else F.push(g);Ee=g}for(let f=0;f<w.length;f++){let g=w[f];g in a&&(m(()=>{P(a[g]),a[g].remove()}),delete a[g])}for(let f=0;f<h.length;f++){let[g,b]=h[f],v=a[g],O=a[b],ee=document.createElement("div");m(()=>{O||E('x-for ":key" is undefined or invalid',o,b,a),O.after(ee),v.after(O),O._x_currentIfEl&&O.after(O._x_currentIfEl),ee.before(v),v._x_currentIfEl&&v.after(v._x_currentIfEl),ee.remove()}),O._x_refreshXForScope(l[u.indexOf(b)])}for(let f=0;f<p.length;f++){let[g,b]=p[f],v=g==="template"?o:a[g];v._x_currentIfEl&&(v=v._x_currentIfEl);let O=l[b],ee=u[b],ce=document.importNode(o.content,!0).firstElementChild,qt=T(O);k(ce,qt,o),ce._x_refreshXForScope=On=>{Object.entries(On).forEach(([Cn,Tn])=>{qt[Cn]=Tn})},m(()=>{v.after(ce),A(()=>S(ce))()}),typeof ee=="object"&&E("x-for key cannot be an object, it must be a string or an integer",o),a[ee]=ce}for(let f=0;f<F.length;f++)a[F[f]]._x_refreshXForScope(l[u.indexOf(F[f])]);o._x_prevKeys=u})}function ro(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,r=/^\s*\(|\)\s*$/g,n=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=e.match(n);if(!i)return;let o={};o.items=i[2].trim();let s=i[1].replace(r,"").trim(),a=s.match(t);return a?(o.item=s.replace(t,"").trim(),o.index=a[1].trim(),a[2]&&(o.collection=a[2].trim())):o.item=s,o}function Sn(e,t,r,n){let i={};return/^\[.*\]$/.test(e.item)&&Array.isArray(t)?e.item.replace("[","").replace("]","").split(",").map(s=>s.trim()).forEach((s,a)=>{i[s]=t[a]}):/^\{.*\}$/.test(e.item)&&!Array.isArray(t)&&typeof t=="object"?e.item.replace("{","").replace("}","").split(",").map(s=>s.trim()).forEach(s=>{i[s]=t[s]}):i[e.item]=t,e.index&&(i[e.index]=r),e.collection&&(i[e.collection]=n),i}function no(e){return!Array.isArray(e)&&!isNaN(e)}function An(){}An.inline=(e,{expression:t},{cleanup:r})=>{let n=Y(e);n._x_refs||(n._x_refs={}),n._x_refs[t]=e,r(()=>delete n._x_refs[t])};d("ref",An);d("if",(e,{expression:t},{effect:r,cleanup:n})=>{e.tagName.toLowerCase()!=="template"&&E("x-if can only be used on a <template> tag",e);let i=x(e,t),o=()=>{if(e._x_currentIfEl)return e._x_currentIfEl;let a=e.content.cloneNode(!0).firstElementChild;return k(a,{},e),m(()=>{e.after(a),A(()=>S(a))()}),e._x_currentIfEl=a,e._x_undoIf=()=>{m(()=>{P(a),a.remove()}),delete e._x_currentIfEl},a},s=()=>{e._x_undoIf&&(e._x_undoIf(),delete e._x_undoIf)};r(()=>i(a=>{a?o():s()})),n(()=>e._x_undoIf&&e._x_undoIf())});d("id",(e,{expression:t},{evaluate:r})=>{r(t).forEach(i=>_n(e,i))});H((e,t)=>{e._x_ids&&(t._x_ids=e._x_ids)});ne(Pe("@",Ie(C("on:"))));d("on",A((e,{value:t,modifiers:r,expression:n},{cleanup:i})=>{let o=n?x(e,n):()=>{};e.tagName.toLowerCase()==="template"&&(e._x_forwardEvents||(e._x_forwardEvents=[]),e._x_forwardEvents.includes(t)||e._x_forwardEvents.push(t));let s=ae(e,t,r,a=>{o(()=>{},{scope:{$event:a},params:[a]})});i(()=>s())}));rt("Collapse","collapse","collapse");rt("Intersect","intersect","intersect");rt("Focus","trap","focus");rt("Mask","mask","mask");function rt(e,t,r){d(t,n=>E(`You can't use [x-${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${r}`,n))}K.setEvaluator(xt);K.setReactivityEngine({reactive:et,effect:rn,release:nn,raw:_});var Vt=K;window.Alpine=Vt;})();

</script>

<!-- 4. Application HTML -->
<div x-data="{ get service() { return getActiveService() } }">

  <!-- Document header (always visible) -->
  <div class="doc-header">
    <h1>Business Observability Requirements</h1>
    <div class="subtitle">Story Set Workspace</div>
  </div>

  <!-- GROUNDING PAGE VIEW -->
  <div class="grounding-view" x-show="$store.app.showGrounding && !$store.app.activeServiceId">

    <div class="grounding-label">THE PROBLEM TODAY</div>
    <div class="grounding-panel">
      <p style="font-size:14px; color:var(--wf-gray-700); line-height:1.6; margin:0;">Each service has monitoring, but there's no consistent way to answer across the portfolio: which ones have health signals tied to business outcomes, and which ones have gaps. When something breaks, the first hour or more is spent assembling context: calling Product Owners, digging through documentation, estimating who's affected. That context should exist before the incident.</p>
    </div>

    <div class="grounding-label">WHAT THIS TOOL DRIVES TOWARD</div>
    <div class="objective-cards">

      <div class="objective-card">
        <h4>Structured Observability Requirements</h4>
        <div class="objective-summary">Define what "healthy" means for each service, starting from who cares and what impacts them.</div>
        <div class="measures-label">MEASURE</div>
        <div class="measure-item">Every health signal traces to a stakeholder expectation and a business impact category</div>
      </div>

      <div class="objective-card">
        <h4>Measurable Operational Readiness</h4>
        <div class="objective-summary">Answer "is this service operationally ready?" with a completeness score based on what's defined, what's instrumented, and what's operational. The same question, across every service in the portfolio.</div>
        <div class="measures-label">MEASURE</div>
        <div class="measure-item">Per-service completeness score, visible on the Service Status tab</div>
      </div>

      <div class="objective-card">
        <h4>Incident Context Before the Incident</h4>
        <div class="objective-summary">When something breaks, the diagnostic context (who's affected, what's the business impact, what to check) already exists. Assembled during requirements, not during the 3 AM incident.</div>
        <div class="measures-label">MEASURE</div>
        <div class="measure-item">Every alert traces to affected stakeholders and impact categories</div>
      </div>

    </div>

    <div class="grounding-label">WHERE THIS FITS IN THE SDLC</div>
    <div class="grounding-panel">
    <div class="persona-flow">
      <div class="persona-bar">
        <div class="persona-bar-track">
          <div class="seg-po"></div>
          <div class="seg-dev"></div>
          <div class="seg-ops"></div>
        </div>
        <div class="persona-circle po">
          <span class="abbrev">PO</span>
          <span class="role-name">Product<br>Owner</span>
        </div>
        <div class="persona-circle dev">
          <span class="abbrev">DEV</span>
          <span class="role-name">Developer</span>
        </div>
        <div class="persona-circle ops">
          <span class="abbrev">OPS</span>
          <span class="role-name">Platform<br>Engineer</span>
        </div>
      </div>
      <div id="persona-rows" class="persona-rows">
        <div class="persona-row" data-row="po">
          <div class="row-label po"><span data-label="po">Product Owner</span></div>
          <div class="row-desc po">
            <p><strong>Defines what success looks like.</strong> Documents stakeholders, expectations, and impact categories for each service. Maps to PO Story tab.</p>
          </div>
          <div class="row-connector"><div class="dash po"></div></div>
          <div class="row-output po">
            <p><strong>Output:</strong> business context for each service.</p>
          </div>
        </div>
        <div class="persona-row" data-row="dev">
          <div class="row-label dev"><span data-label="dev">Developer</span></div>
          <div class="row-desc dev">
            <p><strong>Instruments how to measure it.</strong> Takes business context and adds telemetry: data sources, queries, metric paths. Maps to Dev Story tab.</p>
          </div>
          <div class="row-connector"><div class="dash dev"></div></div>
          <div class="row-output dev">
            <p><strong>Output:</strong> business signals in the code.</p>
          </div>
        </div>
        <div class="persona-row" data-row="ops">
          <div class="row-label ops"><span data-label="ops">Platform Engineer</span></div>
          <div class="row-desc ops">
            <p><strong>Creates visibility for everyone.</strong> Configures alerts, dashboards, and runbooks from instrumented signals. Maps to Platform Story tab.</p>
          </div>
          <div class="row-connector"><div class="dash ops"></div></div>
          <div class="row-output ops">
            <p><strong>Output:</strong> dashboards, alerts, runbooks.</p>
          </div>
        </div>
        <div class="feedback-box" data-row="feedback">
          <svg class="sync-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 2v6h-6"/><path d="M2.5 22v-6h6"/><path d="M2.5 11.5a10 10 0 0 1 18.4-4.3L21.5 8"/><path d="M21.5 12.5a10 10 0 0 1-18.4 4.3L2.5 16"/></svg>
          <p data-label="feedback"><strong>FEEDBACK LOOP:</strong> Dashboards and alerts feed back to all three roles: Product Owner validates business health, Developer refines instrumentation, Platform Engineer tunes operations.</p>
        </div>
      </div>
      <div class="persona-footer">
        Same roles. Same backlog. Same sprint gates. New requirement type, operational health, with specific acceptance criteria for each role.
      </div>
    </div>
    </div>

    <div class="grounding-cta">
      <button class="btn-enter-workspace" @click="$store.app.showGrounding = false; schedulePersist()">Enter Workspace →</button>
    </div>

  </div>

  <!-- SERVICE MANAGER VIEW -->
  <div class="service-manager" x-show="!$store.app.showGrounding && !$store.app.activeServiceId">
    <div class="empty-message" x-show="Object.keys($store.app.services).length === 0">
      Get started by loading an example below, or create a new service.
    </div>
    <div class="about-link" @click="$store.app.showGrounding = true">(i) About This Tool</div>
    <div class="manager-actions">
      <button class="btn-new-service" @click="createService()">+ New Service</button>
      <button class="btn-import" @click="$refs.importInput.click()">Import</button>
      <input type="file" accept=".json" x-ref="importInput" style="display:none"
        @change="if ($event.target.files[0]) { importService($event.target.files[0]); $event.target.value = ''; }">
    </div>
    <div class="example-library">
      <h3 class="section-header">
        <span class="section-dot example-dot"></span>Examples
      </h3>
      <template x-for="ex in EXAMPLE_CATALOG" :key="ex.key">
        <div class="example-card">
          <div class="example-card-header">
            <span class="archetype-badge" x-text="ex.archetype"></span>
            <span class="example-name" x-text="ex.name"></span>
          </div>
          <div class="example-card-desc" x-text="ex.description"></div>
          <div class="example-card-domain" x-text="ex.domain"></div>
          <div class="example-card-actions">
            <template x-if="!isExampleLoaded(ex.key)">
              <button class="btn-load" @click="loadExample(ex.key)">Load</button>
            </template>
            <template x-if="isExampleLoaded(ex.key)">
              <span>
                <span class="loaded-indicator">Loaded ✓</span>
                <button class="btn-reset-example" @click="loadExample(ex.key)">Reset</button>
              </span>
            </template>
          </div>
        </div>
      </template>
    </div>
    <template x-for="svcId in Object.keys($store.app.services)" :key="svcId">
      <div class="service-card" @click="$store.app.activeServiceId = svcId">
        <div class="service-card-info">
          <div class="service-card-name"
            x-text="$store.app.services[svcId].identity.serviceName || $store.app.services[svcId].name || 'Untitled Service'"></div>
          <div class="service-card-meta"
            x-text="'Last modified: ' + formatTimestamp($store.app.services[svcId].updated)"></div>
          <div class="service-card-completion"
            x-text="computeFieldCount($store.app.services[svcId])"></div>
        </div>
        <div class="service-card-actions" @click.stop>
          <button class="service-card-clone" @click.stop="cloneService(svcId)">Clone</button>
          <button class="service-card-delete" @click.stop="deleteService(svcId)">Delete</button>
        </div>
      </div>
    </template>
    <div class="workspace-actions" x-show="Object.keys($store.app.services).length > 0">
      <span class="workspace-actions-label">Workspace:</span>
      <button class="btn-reset" @click="resetWorkspace()">Reset</button>
      <button class="btn-reset-example" @click="resetToExamples()">Load All Examples</button>
    </div>
  </div>

  <!-- FORM VIEW -->
  <div x-show="$store.app.activeServiceId">

  <!-- Service pill bar -->
  <div class="service-pill-bar">
    <template x-for="svcId in Object.keys($store.app.services)" :key="svcId">
      <button class="service-pill"
        :class="{ active: $store.app.activeServiceId === svcId }"
        @click="$store.app.activeServiceId = svcId"
        x-text="$store.app.services[svcId].identity.serviceName || $store.app.services[svcId].name || 'Untitled'">
      </button>
    </template>
    <button class="pill-all-services" @click="$store.app.activeServiceId = null">All Services</button>
  </div>

  <!-- Tab bar -->
  <div class="tab-nav">
    <button class="tab-btn po" :class="{ active: $store.app.activeTab === 'po' }" @click="$store.app.activeTab = 'po'">PO Story</button>
    <button class="tab-btn dev" :class="{ active: $store.app.activeTab === 'dev' }" @click="$store.app.activeTab = 'dev'">Dev Story</button>
    <button class="tab-btn plat" :class="{ active: $store.app.activeTab === 'plat' }" @click="$store.app.activeTab = 'plat'">Platform Story</button>
    <button class="tab-btn how" :class="{ active: $store.app.activeTab === 'how' }" @click="$store.app.activeTab = 'how'">How It Works</button>
    <button class="tab-btn status" :class="{ active: $store.app.activeTab === 'status' }" @click="$store.app.activeTab = 'status'">Service Status</button>
    <button class="tab-btn flow" :class="{ active: $store.app.activeTab === 'flow' }" @click="$store.app.activeTab = 'flow'">Dashboard Preview</button>
  </div>

  <!-- Tab 1: PO Story -->
  <div class="tab-panel" x-show="$store.app.activeTab === 'po'">
    <div class="story-header">
      <div class="story-num po">STORY 1</div>
      <h2>Product Owner: Business Observability Requirements</h2>
      <div class="story-statement">
        <strong>As a</strong> Product Owner, <strong>I want to</strong> define business observability requirements
        so that my service's health and impact can be measured, monitored, and traced back to stakeholder expectations.
      </div>
    </div>

    <!-- Section 1.1: Service Context -->
    <div class="ac-section" id="section-1-1">
      <div class="ac-label po">AC 1.1 — SERVICE CONTEXT</div>
      <div class="ac-desc">Define the service identity: name, classification, ownership, and organizational placement. This metadata anchors all observability requirements to a specific service.</div>

      <!-- Service Definition Guide (collapsible) -->
      <div class="service-guide">
        <div class="service-guide-header"
             @click="$store.app.guideExpanded = !$store.app.guideExpanded">
          <span>(i) What counts as a service?</span>
          <span class="service-guide-indicator"
                :style="$store.app.guideExpanded ? 'transform: rotate(90deg)' : ''">&#9656;</span>
        </div>
        <div class="service-guide-body" x-show="$store.app.guideExpanded" x-cloak>
          <p style="margin-bottom: 12px;">A BOS service is whatever unit you can define business health for. It's not dictated by the CMDB entry, the org chart, or an architecture framework. It's defined by the ability to answer: "What does healthy look like for this thing, and who cares when it's not healthy?"</p>

          <div class="pattern-card">
            <div class="pattern-name">CMDB Application</div>
            <div class="pattern-desc">The CMDB app IS the service. One app, one BOS service.</div>
            <div class="pattern-example">Example: "Wire Transfer Engine", a single application that handles wire transfers end-to-end.</div>
            <div class="pattern-best-when">Best when: The app has a coherent business purpose, one team owns it, and stakeholders think of it as a single thing.</div>
          </div>

          <div class="pattern-card">
            <div class="pattern-name">Capability within an Application</div>
            <div class="pattern-desc">One CMDB app contains multiple distinct business functions. You define a BOS service for one of them.</div>
            <div class="pattern-example">Example: "Appraisal Order Processing", one capability within a larger lending platform.</div>
            <div class="pattern-best-when">Best when: The app is large or monolithic, different stakeholders care about different parts, and "the app is healthy" is too vague to be useful.</div>
          </div>

          <div class="pattern-card">
            <div class="pattern-name">Business Capability spanning Applications</div>
            <div class="pattern-desc">The thing stakeholders care about cuts across multiple CMDB apps. You define a BOS service for the capability, not the apps.</div>
            <div class="pattern-example">Example: "Mortgage Origination", spans credit check, appraisal, underwriting, closing, and funding systems.</div>
            <div class="pattern-best-when">Best when: Stakeholders think in terms of a customer journey or business process, not individual applications. Multiple teams contribute.</div>
          </div>

          <div class="granularity-test">
            <strong>Quick check: is this the right level?</strong><br>
            1. Can you name 2-3 stakeholders who care specifically about THIS service's health?<br>
            2. Can you describe what "healthy" looks like in business terms (not technical metrics)?<br><br>
            If yes to both → you've found your service boundary. If no → try a different level (narrower if too vague, broader if too detailed).
          </div>
        </div>
      </div>

      <div class="card po-card">
        <div class="field-sub-header">Identity</div>
        <div class="field-row">
          <span class="field-label">Service Name</span>
          <input type="text" class="field-input-prose" placeholder="Name of the service..."
            x-model="service.identity.serviceName" @input="schedulePersist()">
        </div>
        <div class="field-row">
          <span class="field-label">Service ID</span>
          <input type="text" class="field-input-prose" placeholder="e.g., SVC002"
            x-model="service.identity.serviceId" @input="schedulePersist()">
        </div>
        <div class="field-row">
          <span class="field-label">Description</span>
          <textarea class="field-input-prose" placeholder="What business function does this service perform?"
            x-model="service.identity.description" @input="schedulePersist()"></textarea>
        </div>
        <div class="field-sub-header">Classification</div>
        <div class="field-row">
          <span class="field-label">Tier</span>
          <select class="meta-select" x-model="service.identity.tier" @change="schedulePersist()">
            <option value="">Select tier...</option>
            <template x-for="opt in DROPDOWN_OPTS.tier" :key="opt.value">
              <option :value="opt.value" x-text="opt.label"></option>
            </template>
          </select>
        </div>
        <div class="field-row">
          <span class="field-label">Product Line</span>
          <input type="text" class="field-input-prose" placeholder="e.g., Consumer Lending"
            x-model="service.identity.productLine" @input="schedulePersist()">
        </div>
        <div class="field-row">
          <span class="field-label">Business Domain</span>
          <input type="text" class="field-input-prose" placeholder="e.g., Home Originations"
            x-model="service.identity.businessDomain" @input="schedulePersist()">
        </div>
          <div class="field-helper-text">
            Business Domain is the organizational home in the product hierarchy. Functional Category is what the service does. Two services in the same domain can serve different functions.
          </div>
        <div class="field-row">
          <span class="field-label">Functional Category</span>
          <input type="text" class="field-input-prose" list="functional-categories-list"
            placeholder="e.g., Credit Assessment, Payments Processing, Collateral Management"
            x-model="service.identity.functionalCategory" @input="schedulePersist()">
          <datalist id="functional-categories-list">
            <template x-for="cat in FUNCTIONAL_CATEGORIES" :key="cat">
              <option :value="cat"></option>
            </template>
          </datalist>
        </div>
        <div class="field-sub-header">Ownership</div>
        <div class="field-row">
          <span class="field-label">Org Product</span>
          <input type="text" class="field-input-prose" placeholder="e.g., Loan Origination System"
            x-model="service.identity.orgProduct" @input="schedulePersist()">
        </div>
        <div class="field-row">
          <span class="field-label">Technical Owner</span>
          <input type="text" class="field-input-prose" placeholder="CMDB technical owner..."
            x-model="service.identity.technicalOwner" @input="schedulePersist()">
        </div>
        <div class="field-row">
          <span class="field-label">Status</span>
          <select class="meta-select" x-model="service.identity.status" @change="schedulePersist()">
            <option value="">Select status...</option>
            <template x-for="opt in DROPDOWN_OPTS.status" :key="opt.value">
              <option :value="opt.value" x-text="opt.label"></option>
            </template>
          </select>
        </div>
      </div>
    </div>

    <!-- Section 1.2: Stakeholder Expectations -->
    <div class="ac-section" id="section-1-2">
      <div class="ac-label po">AC 1.2 — STAKEHOLDER EXPECTATIONS</div>
      <div class="ac-desc">Define stakeholders, their expectations, and the business impact when those expectations are not met. Each category container groups stakeholders by impact type.</div>

      <!-- Category containers: 4 fixed containers, stakeholders filtered by impactCategory -->
      <template x-for="cat in CATEGORY_ORDER" :key="cat">
        <div class="category-container" :data-category="cat">
          <div class="category-header">
            <span class="cat-dot"></span>
            <span x-text="categoryName(cat)"></span>
          </div>

          <!-- Chain rows for stakeholders in this category -->
          <template x-for="stk in service.stakeholders.filter(function(s) { return s.impactCategory === cat; })" :key="stk.id">
            <div class="chain-row">
              <!-- Segment 1: Stakeholder + Priority -->
              <div class="chain-segment seg-stakeholder">
                <div class="chain-segment-label">Stakeholder</div>
                <input type="text" class="card-name-input" placeholder="Stakeholder name..."
                  x-model="stk.stakeholder" @input="schedulePersist()">
                <select class="meta-select" x-model="stk.priority" @change="schedulePersist()">
                  <option value="">Priority...</option>
                  <template x-for="opt in DROPDOWN_OPTS.priority" :key="opt.value">
                    <option :value="opt.value" x-text="opt.label"></option>
                  </template>
                </select>
              </div>

              <!-- Arrow -->
              <span class="chain-arrow">&#8594;</span>

              <!-- Segment 2: Expectation -->
              <div class="chain-segment seg-expectation">
                <div class="chain-segment-label">I expect...</div>
                <textarea class="field-input-prose" placeholder="What does this stakeholder expect from the service?"
                  x-model="stk.expectationStatement" @input="schedulePersist()"></textarea>
              </div>

              <!-- Arrow -->
              <span class="chain-arrow">&#8594;</span>

              <!-- Segment 3: Impact -->
              <div class="chain-segment seg-impact">
                <div class="chain-segment-label">If it fails...</div>
                <textarea class="field-input-prose" placeholder="What happens when the expectation is not met?"
                  x-model="stk.impactDescription" @input="schedulePersist()"></textarea>
              </div>

              <!-- Remove button -->
              <button class="remove-chain-btn" @click="removeStakeholder(stk)" title="Remove stakeholder">&times;</button>
            </div>
          </template>

          <!-- Empty state per container -->
          <div class="category-empty" x-show="service.stakeholders.filter(function(s) { return s.impactCategory === cat; }).length === 0">
            No stakeholders in this category yet.
          </div>

          <!-- Add button per container -->
          <button class="add-btn" @click="addStakeholder(cat)">+ Add Stakeholder</button>
        </div>
      </template>
    </div>

    <!-- Health Bridge -->
    <div class="bridge-element" id="health-bridge">
      <div class="bridge-header">SIGNAL COVERAGE: Health</div>
      <div class="bridge-prompt">
        For each stakeholder expectation above, <strong>what would you measure</strong> to know if that expectation is being met?
        Each health signal below should verify at least one expectation.
      </div>
      <div class="coverage-matrix" id="health-coverage" x-data="{ get cov() { return computeCoverage('health') } }">
        <template x-for="cat in cov.categories" :key="cat.code">
          <div class="coverage-category">
            <div class="coverage-category-header">
              <span class="cat-dot" :style="'background:' + (CATEGORY_COLORS_BADGE[cat.code] || {}).text"></span>
              <span x-text="categoryName(cat.code)"></span>
            </div>
            <template x-for="exp in cat.expectations" :key="exp.stakeholder">
              <div>
                <div class="coverage-expectation">
                  <span x-text="exp.label || '(no expectation)'"></span>
                  <span class="coverage-stakeholder" x-text="'(' + (exp.stakeholder || 'unnamed') + ')'"></span>
                </div>
                <div class="coverage-signals" x-show="exp.signals.length > 0">
                  <span class="arrow">&#8594;</span>
                  <span x-text="exp.signals.join(', ')"></span>
                </div>
                <div class="coverage-gap" x-show="exp.signals.length === 0">No signals verify this expectation</div>
              </div>
            </template>
          </div>
        </template>
        <template x-for="orphan in cov.orphans" :key="orphan">
          <div class="coverage-orphan" x-text="orphan + ': unlinked signal (verifies no expectation)'"></div>
        </template>
        <div class="bridge-summary-metrics" x-show="cov.total > 0">
          <div class="bridge-metric">
            <span class="bridge-metric-value" x-text="cov.covered + '/' + cov.total"></span>
            <span class="bridge-metric-label">Expectations Covered</span>
          </div>
          <div class="bridge-metric">
            <span class="bridge-metric-value bridge-metric-zero" x-text="cov.orphans.length"></span>
            <span class="bridge-metric-label">Orphan Signals</span>
          </div>
          <div class="bridge-metric">
            <span class="bridge-metric-value bridge-metric-accent" x-text="cov.signalCount"></span>
            <span class="bridge-metric-label">Health Signals Defined</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Section 1.3: Health Signals (L3) -->
    <div class="ac-section" id="section-1-3">
      <div class="ac-label po">AC 1.3 — BUSINESS HEALTH SIGNALS</div>
      <div class="ac-desc">Define the signals that measure whether stakeholder expectations are being met. Each signal should verify at least one stakeholder expectation.</div>

      <!-- Signal cards -->
      <template x-for="sig in service.signals.filter(function(s) { return s.layer === 'L3'; })" :key="sig.id">
        <div class="card po-card signal-card">
          <button class="remove-btn" @click="removeSignal(sig)" title="Remove signal">&times;</button>
          <input type="text" class="card-name-input" placeholder="Signal name..."
            x-model="sig.name" @input="schedulePersist()">

          <!-- Verifies checkboxes (trace links to stakeholders) — CP4 -->
          <div class="field-row">
            <span class="field-label">Verifies</span>
            <div class="trace-checkbox-list">
              <template x-for="stk in service.stakeholders" :key="stk.id">
                <label class="trace-checkbox">
                  <input type="checkbox"
                    :checked="sig.verifies.includes(stk.id)"
                    @change="toggleTrace(sig, 'verifies', stk.id)">
                  <span class="trace-badge" :style="categoryStyle(stk.impactCategory)"
                    x-text="categoryName(stk.impactCategory)"></span>
                  <span x-text="stk.expectationStatement || '(no expectation)'"></span>
                  <span class="stakeholder-name" x-text="'(' + (stk.stakeholder || 'unnamed') + ')'"></span>
                </label>
              </template>
              <span class="empty-state" x-show="service.stakeholders.length === 0" style="padding:4px 0;text-align:left">No stakeholders defined yet</span>
            </div>
          </div>

          <!-- Description -->
          <div class="field-list">
            <div class="field-row">
              <span class="field-label">What it tells me</span>
              <textarea class="field-input-prose" placeholder="What does this signal measure?"
                x-model="sig.whatItTellsMe" @input="schedulePersist()"></textarea>
            </div>

            <!-- Signal type (read-only — Dev selects type in Section 2.1) -->
            <div class="field-row">
              <span class="field-label">Signal type</span>
              <span style="color:var(--wf-gray-500);font-style:italic;" x-text="sig.signalType ? signalTypeLabel(sig.signalType) : 'Not yet selected'"></span>
            </div>

            <!-- Target -->
            <div class="field-row">
              <span class="field-label">SLO Target</span>
              <input type="text" class="field-input-prose" placeholder="e.g., 85%"
                x-model="sig.sloTarget" @input="schedulePersist()">
            </div>

            <!-- Time window -->
            <div class="field-row">
              <span class="field-label">Time window</span>
              <input type="text" class="field-input-prose" placeholder="e.g., 7 days"
                x-model="sig.timeWindow" @input="schedulePersist()">
            </div>

            <!-- Rationale -->
            <div class="field-row">
              <span class="field-label">Why this target</span>
              <textarea class="field-input-prose" placeholder="Business rationale for the target..."
                x-model="sig.whyThisTarget" @input="schedulePersist()"></textarea>
            </div>
          </div>
        </div>
      </template>

      <!-- Empty state -->
      <div class="empty-state" x-show="service.signals.filter(function(s) { return s.layer === 'L3'; }).length === 0">No health signals defined yet.</div>

      <!-- Add button -->
      <button class="add-btn" @click="addSignal('L3')">+ Add Health Signal</button>
    </div>

    <!-- Impact Bridge -->
    <div class="bridge-element" id="impact-bridge">
      <div class="bridge-header">SIGNAL COVERAGE: Impact</div>
      <div class="bridge-prompt">
        For each stakeholder impact description above, <strong>how would you quantify the business impact</strong> when expectations are not met?
      </div>
      <div class="coverage-matrix" id="impact-coverage" x-data="{ get cov() { return computeCoverage('impact') } }">
        <template x-for="cat in cov.categories" :key="cat.code">
          <div class="coverage-category">
            <div class="coverage-category-header">
              <span class="cat-dot" :style="'background:' + (CATEGORY_COLORS_BADGE[cat.code] || {}).text"></span>
              <span x-text="categoryName(cat.code)"></span>
            </div>
            <template x-for="exp in cat.expectations" :key="exp.stakeholder">
              <div>
                <div class="coverage-expectation">
                  <span x-text="exp.label || '(no impact description)'"></span>
                  <span class="coverage-stakeholder" x-text="'(' + (exp.stakeholder || 'unnamed') + ')'"></span>
                </div>
                <div class="coverage-signals" x-show="exp.signals.length > 0">
                  <span class="arrow">&#8594;</span>
                  <span x-text="exp.signals.join(', ')"></span>
                </div>
                <div class="coverage-gap" x-show="exp.signals.length === 0">No signals quantify this impact</div>
              </div>
            </template>
          </div>
        </template>
        <template x-for="orphan in cov.orphans" :key="orphan">
          <div class="coverage-orphan" x-text="orphan + ': unlinked signal (quantifies no impact)'"></div>
        </template>
        <div class="bridge-summary-metrics" x-show="cov.total > 0">
          <div class="bridge-metric">
            <span class="bridge-metric-value" x-text="cov.covered + '/' + cov.total"></span>
            <span class="bridge-metric-label">Impacts Covered</span>
          </div>
          <div class="bridge-metric">
            <span class="bridge-metric-value bridge-metric-zero" x-text="cov.orphans.length"></span>
            <span class="bridge-metric-label">Orphan Signals</span>
          </div>
          <div class="bridge-metric">
            <span class="bridge-metric-value bridge-metric-accent" x-text="cov.signalCount"></span>
            <span class="bridge-metric-label">Impact Signals Defined</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Section 1.4: Impact Signals (L4) -->
    <div class="ac-section" id="section-1-4">
      <div class="ac-label po">AC 1.4 — BUSINESS IMPACT SIGNALS</div>
      <div class="ac-desc">Define signals that quantify business impact when health signals indicate problems. Each impact signal should quantify at least one stakeholder impact description.</div>

      <!-- Signal cards -->
      <template x-for="sig in service.signals.filter(function(s) { return s.layer === 'L4'; })" :key="sig.id">
        <div class="card po-card signal-card">
          <button class="remove-btn" @click="removeSignal(sig)" title="Remove signal">&times;</button>
          <input type="text" class="card-name-input" placeholder="Impact signal name..."
            x-model="sig.name" @input="schedulePersist()">

          <!-- Quantifies checkboxes (trace links to stakeholders) -->
          <div class="field-row">
            <span class="field-label">Quantifies</span>
            <div class="trace-checkbox-list">
              <template x-for="stk in service.stakeholders" :key="stk.id">
                <label class="trace-checkbox">
                  <input type="checkbox"
                    :checked="sig.quantifies.includes(stk.id)"
                    @change="toggleTrace(sig, 'quantifies', stk.id)">
                  <span class="trace-badge" :style="categoryStyle(stk.impactCategory)"
                    x-text="categoryName(stk.impactCategory)"></span>
                  <span x-text="stk.impactDescription || '(no impact description)'"></span>
                  <span class="stakeholder-name" x-text="'(' + (stk.stakeholder || 'unnamed') + ')'"></span>
                </label>
              </template>
              <span class="empty-state" x-show="service.stakeholders.length === 0" style="padding:4px 0;text-align:left">No stakeholders defined yet</span>
            </div>
          </div>

          <!-- Description -->
          <div class="field-list">
            <div class="field-row">
              <span class="field-label">What it tells me</span>
              <textarea class="field-input-prose" placeholder="What business impact does this signal quantify?"
                x-model="sig.whatItTellsMe" @input="schedulePersist()"></textarea>
            </div>

            <!-- Impact category -->
            <div class="field-row">
              <span class="field-label">Impact category</span>
              <select class="meta-select" x-model="sig.impactCategory" @change="schedulePersist()">
                <option value="">Select category...</option>
                <template x-for="opt in DROPDOWN_OPTS.impactCategory" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>

            <!-- Impact unit -->
            <div class="field-row">
              <span class="field-label">Impact unit</span>
              <input type="text" class="field-input-prose" placeholder="e.g., customers, dollars, violations..."
                x-model="sig.impactUnit" @input="schedulePersist()">
            </div>

            <!-- sloTarget, timeWindow, whyThisTarget: HIDDEN for business_impact (spec C.7) -->
          </div>
        </div>
      </template>

      <!-- Empty state -->
      <div class="empty-state" x-show="service.signals.filter(function(s) { return s.layer === 'L4'; }).length === 0">No impact signals defined yet.</div>

      <!-- Add button -->
      <button class="add-btn" @click="addSignal('L4')">+ Add Impact Signal</button>
    </div>
  </div>

  <!-- Tab 2: Dev Story -->
  <div class="tab-panel" x-show="$store.app.activeTab === 'dev'">
    <div class="story-header">
      <div class="story-num dev">STORY 2</div>
      <h2>Developer: Signal Implementation</h2>
      <div class="story-statement">
        <strong>As a</strong> Developer, <strong>I want to</strong> implement signal queries and instrumentation
        so that health, process, and impact signals produce measurable data from production systems.
      </div>
    </div>

    <!-- Section 2.1: Health Signal Queries (MIRROR of 1.3 L3 signals) -->
    <div class="ac-section" id="section-2-1">
      <div class="ac-label dev">AC 2.1 — HEALTH SIGNAL QUERIES</div>
      <div class="ac-desc">Implement queries for health signals defined by the Product Owner. Signal names are set in the PO Story tab.</div>
      <div class="mirror-note">Mirror of Section 1.3. Signal names are set in the PO Story tab. Add or remove health signals there.</div>

      <template x-for="sig in service.signals.filter(function(s) { return s.layer === 'L3'; })" :key="sig.id">
        <div class="card dev-card">
          <div class="card-name-input" style="border:none;cursor:default;background:transparent;font-weight:bold;color:var(--wf-gray-700);"
            x-text="sig.name || '(unnamed signal)'"></div>

          <div class="field-list">
            <!-- Signal type (editable — Dev owns signal type selection for L3) -->
            <div class="field-row">
              <span class="field-label">Signal type</span>
              <select class="meta-select" x-model="sig.signalType" @change="schedulePersist()">
                <option value="">Select type...</option>
                <template x-for="opt in DROPDOWN_OPTS.signalTypeL3" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>

            <!-- PO context fields (read-only — shows what PO has defined) -->
            <div class="field-row">
              <span class="field-label">What it tells me</span>
              <span style="color:var(--wf-gray-500);font-style:italic;" x-text="sig.whatItTellsMe || '(not yet defined by PO)'"></span>
            </div>
            <div class="field-row">
              <span class="field-label">SLO Target</span>
              <span style="color:var(--wf-gray-500);font-style:italic;" x-text="sig.sloTarget || '(not yet defined by PO)'"></span>
            </div>
            <div class="field-row">
              <span class="field-label">Time window</span>
              <span style="color:var(--wf-gray-500);font-style:italic;" x-text="sig.timeWindow || '(not yet defined by PO)'"></span>
            </div>
            <div class="field-row">
              <span class="field-label">Why this target</span>
              <span style="color:var(--wf-gray-500);font-style:italic;" x-text="sig.whyThisTarget || '(not yet defined by PO)'"></span>
            </div>

            <!-- Ratio-specific fields -->
            <div class="field-row" x-show="sig.signalType === 'sli_ratio'">
              <span class="field-label">Good events query</span>
              <textarea class="field-input-code" placeholder="Numerator query..."
                x-model="sig.queryNumerator" @input="schedulePersist()"></textarea>
            </div>
            <div class="field-row" x-show="sig.signalType === 'sli_ratio'">
              <span class="field-label">Total events query</span>
              <textarea class="field-input-code" placeholder="Denominator query..."
                x-model="sig.queryDenominator" @input="schedulePersist()"></textarea>
            </div>

            <!-- Threshold-specific fields -->
            <div class="field-row" x-show="sig.signalType === 'sli_threshold'">
              <span class="field-label">Measurement query</span>
              <textarea class="field-input-code" placeholder="Measurement query..."
                x-model="sig.queryNumerator" @input="schedulePersist()"></textarea>
            </div>
            <div class="field-row" x-show="sig.signalType === 'sli_threshold'">
              <span class="field-label">Operator</span>
              <select class="meta-select" x-model="sig.thresholdOperator" @change="schedulePersist()">
                <option value="">Select operator...</option>
                <template x-for="opt in DROPDOWN_OPTS.thresholdOperator" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
            <div class="field-row" x-show="sig.signalType === 'sli_threshold'">
              <span class="field-label">Unit</span>
              <select class="meta-select" x-model="sig.thresholdUnit" @change="schedulePersist()">
                <option value="">Select unit...</option>
                <template x-for="opt in DROPDOWN_OPTS.thresholdUnit" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>

            <!-- Not yet selected message -->
            <div class="field-row" x-show="!sig.signalType">
              <span class="field-label" style="color:#E74C3C;font-style:italic;">Select signal type to show implementation fields</span>
            </div>

            <div class="field-row">
              <span class="field-label">Data Source</span>
              <select class="meta-select" x-model="sig.dataSource" @change="schedulePersist()">
                <option value="">Select data source</option>
                <template x-for="opt in DROPDOWN_OPTS.dataSource" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
            <div class="field-row">
              <span class="field-label">Data Source Details</span>
              <input type="text" class="field-input-prose"
                placeholder="e.g., index=app_events, or prometheus.internal:9090"
                x-model="sig.dataSourceDetails" @input="schedulePersist()">
            </div>

            <div class="field-row">
              <span class="field-label">Technical Owner</span>
              <input type="text" class="field-input-prose" placeholder="Team or person maintaining this signal..."
                x-model="sig.technicalOwner" @input="schedulePersist()">
            </div>
          </div>
        </div>
      </template>

      <div class="empty-state" x-show="service.signals.filter(function(s) { return s.layer === 'L3'; }).length === 0">
        No health signals defined yet. Add health signals in the PO Story tab (Section 1.3).
      </div>
    </div>

    <!-- Section 2.2: Process Signals (L2 — CRUD) -->
    <div class="ac-section" id="section-2-2">
      <div class="ac-label dev">AC 2.2 — PROCESS SIGNALS</div>
      <div class="ac-desc">Define process-level signals that measure technical workflow health: build times, deployment frequency, queue depths, error rates. These signals are owned and defined by the Developer.</div>

      <template x-for="sig in service.signals.filter(function(s) { return s.layer === 'L2'; })" :key="sig.id">
        <div class="card dev-card signal-card">
          <button class="remove-btn" @click="removeSignal(sig)" title="Remove signal">&times;</button>
          <input type="text" class="card-name-input" placeholder="Process signal name..."
            x-model="sig.name" @input="schedulePersist()">

          <div class="field-list">
            <div class="field-row">
              <span class="field-label">Signal type</span>
              <select class="meta-select" x-model="sig.signalType" @change="schedulePersist()">
                <option value="">Select type...</option>
                <template x-for="opt in DROPDOWN_OPTS.signalTypeL2" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>

            <div class="field-row">
              <span class="field-label">What it tells me</span>
              <textarea class="field-input-prose" placeholder="What does this process signal measure?"
                x-model="sig.whatItTellsMe" @input="schedulePersist()"></textarea>
            </div>

            <div class="field-row">
              <span class="field-label">SLO Target</span>
              <input type="text" class="field-input-prose" placeholder="e.g., < 500ms p95"
                x-model="sig.sloTarget" @input="schedulePersist()">
            </div>

            <div class="field-row">
              <span class="field-label">Time window</span>
              <input type="text" class="field-input-prose" placeholder="e.g., 24 hours"
                x-model="sig.timeWindow" @input="schedulePersist()">
            </div>

            <div class="field-row">
              <span class="field-label">Why this target</span>
              <textarea class="field-input-prose" placeholder="Technical rationale for the target..."
                x-model="sig.whyThisTarget" @input="schedulePersist()"></textarea>
            </div>

            <div class="field-row" x-show="sig.signalType === 'sli_ratio'">
              <span class="field-label">Good events query</span>
              <textarea class="field-input-code" placeholder="Numerator query..."
                x-model="sig.queryNumerator" @input="schedulePersist()"></textarea>
            </div>
            <div class="field-row" x-show="sig.signalType === 'sli_ratio'">
              <span class="field-label">Total events query</span>
              <textarea class="field-input-code" placeholder="Denominator query..."
                x-model="sig.queryDenominator" @input="schedulePersist()"></textarea>
            </div>

            <div class="field-row" x-show="sig.signalType === 'sli_threshold'">
              <span class="field-label">Measurement query</span>
              <textarea class="field-input-code" placeholder="Measurement query..."
                x-model="sig.queryNumerator" @input="schedulePersist()"></textarea>
            </div>
            <div class="field-row" x-show="sig.signalType === 'sli_threshold'">
              <span class="field-label">Operator</span>
              <select class="meta-select" x-model="sig.thresholdOperator" @change="schedulePersist()">
                <option value="">Select operator...</option>
                <template x-for="opt in DROPDOWN_OPTS.thresholdOperator" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
            <div class="field-row" x-show="sig.signalType === 'sli_threshold'">
              <span class="field-label">Unit</span>
              <select class="meta-select" x-model="sig.thresholdUnit" @change="schedulePersist()">
                <option value="">Select unit...</option>
                <template x-for="opt in DROPDOWN_OPTS.thresholdUnit" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>

            <!-- Not yet selected message -->
            <div class="field-row" x-show="!sig.signalType">
              <span class="field-label" style="color:#E74C3C;font-style:italic;">Select signal type to show query fields</span>
            </div>

            <div class="field-row">
              <span class="field-label">Data Source</span>
              <select class="meta-select" x-model="sig.dataSource" @change="schedulePersist()">
                <option value="">Select data source</option>
                <template x-for="opt in DROPDOWN_OPTS.dataSource" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
            <div class="field-row">
              <span class="field-label">Data Source Details</span>
              <input type="text" class="field-input-prose"
                placeholder="e.g., index=app_events, or prometheus.internal:9090"
                x-model="sig.dataSourceDetails" @input="schedulePersist()">
            </div>

            <div class="field-row">
              <span class="field-label">Technical Owner</span>
              <input type="text" class="field-input-prose" placeholder="Team or person maintaining this signal..."
                x-model="sig.technicalOwner" @input="schedulePersist()">
            </div>
          </div>
        </div>
      </template>

      <div class="empty-state" x-show="service.signals.filter(function(s) { return s.layer === 'L2'; }).length === 0">
        No process signals defined yet.
      </div>

      <button class="add-btn" @click="addSignal('L2')">+ Add Process Signal</button>
    </div>

    <!-- Section 2.3: Impact Quantification (MIRROR of 1.4 L4 signals) -->
    <div class="ac-section" id="section-2-3">
      <div class="ac-label dev">AC 2.3 — IMPACT QUANTIFICATION</div>
      <div class="ac-desc">Implement queries to quantify business impact signals defined by the Product Owner.</div>
      <div class="mirror-note">Mirror of Section 1.4. Signal names are set in the PO Story tab. Add or remove impact signals there.</div>

      <template x-for="sig in service.signals.filter(function(s) { return s.layer === 'L4'; })" :key="sig.id">
        <div class="card dev-card">
          <div class="card-name-input" style="border:none;cursor:default;background:transparent;font-weight:bold;color:var(--wf-gray-700);"
            x-text="sig.name || '(unnamed signal)'"></div>

          <div class="field-list">
            <div class="field-row">
              <span class="field-label">Impact query</span>
              <textarea class="field-input-code" placeholder="Query to quantify impact..."
                x-model="sig.queryNumerator" @input="schedulePersist()"></textarea>
            </div>
            <div class="field-row">
              <span class="field-label">Data Source</span>
              <select class="meta-select" x-model="sig.dataSource" @change="schedulePersist()">
                <option value="">Select data source</option>
                <template x-for="opt in DROPDOWN_OPTS.dataSource" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
            <div class="field-row">
              <span class="field-label">Data Source Details</span>
              <input type="text" class="field-input-prose"
                placeholder="e.g., index=app_events, or prometheus.internal:9090"
                x-model="sig.dataSourceDetails" @input="schedulePersist()">
            </div>

            <div class="field-row">
              <span class="field-label">Technical Owner</span>
              <input type="text" class="field-input-prose" placeholder="Team or person maintaining this signal..."
                x-model="sig.technicalOwner" @input="schedulePersist()">
            </div>
          </div>
        </div>
      </template>

      <div class="empty-state" x-show="service.signals.filter(function(s) { return s.layer === 'L4'; }).length === 0">
        No impact signals defined yet. Add impact signals in the PO Story tab (Section 1.4).
      </div>
    </div>
  </div>

  <!-- Tab 3: Platform Story -->
  <div class="tab-panel" x-show="$store.app.activeTab === 'plat'">
    <div class="story-header">
      <div class="story-num plat">STORY 3</div>
      <h2>Platform: Operational Configuration</h2>
      <div class="story-statement">
        <strong>As a</strong> Platform Engineer, <strong>I want to</strong> configure alerts, dashboards, and playbooks
        so that production signals translate into actionable operational responses when thresholds are crossed.
      </div>
    </div>

    <!-- Section 3.1: System Signals (L1 — CRUD) -->
    <div class="ac-section" id="section-3-1">
      <div class="ac-label plat">AC 3.1 — SYSTEM SIGNALS</div>
      <div class="ac-desc">Define infrastructure-level signals: CPU, memory, disk, network, container health. These signals are owned and defined by the Platform team.</div>

      <template x-for="sig in service.signals.filter(function(s) { return s.layer === 'L1'; })" :key="sig.id">
        <div class="card platform-card signal-card">
          <button class="remove-btn" @click="removeSignal(sig)" title="Remove signal">&times;</button>
          <input type="text" class="card-name-input" placeholder="System signal name..."
            x-model="sig.name" @input="schedulePersist()">

          <div class="field-list">
            <div class="field-row">
              <span class="field-label">What it tells me</span>
              <textarea class="field-input-prose" placeholder="What does this system signal measure?"
                x-model="sig.whatItTellsMe" @input="schedulePersist()"></textarea>
            </div>
            <div class="field-row">
              <span class="field-label">SLO Target</span>
              <input type="text" class="field-input-prose" placeholder="e.g., 95"
                x-model="sig.sloTarget" @input="schedulePersist()">
            </div>
            <div class="field-row">
              <span class="field-label">Time window</span>
              <input type="text" class="field-input-prose" placeholder="e.g., 1h"
                x-model="sig.timeWindow" @input="schedulePersist()">
            </div>
            <div class="field-row">
              <span class="field-label">Why this target</span>
              <textarea class="field-input-prose" placeholder="Business rationale for the target..."
                x-model="sig.whyThisTarget" @input="schedulePersist()"></textarea>
            </div>
            <div class="field-row">
              <span class="field-label">Signal type</span>
              <select class="meta-select" x-model="sig.signalType" @change="schedulePersist()">
                <option value="">Select type...</option>
                <template x-for="opt in DROPDOWN_OPTS.signalTypeL1" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
            <!-- Ratio-specific -->
            <div class="field-row" x-show="sig.signalType === 'sli_ratio'">
              <span class="field-label">Good events query</span>
              <textarea class="field-input-code" placeholder="Numerator query..."
                x-model="sig.queryNumerator" @input="schedulePersist()"></textarea>
            </div>
            <div class="field-row" x-show="sig.signalType === 'sli_ratio'">
              <span class="field-label">Total events query</span>
              <textarea class="field-input-code" placeholder="Denominator query..."
                x-model="sig.queryDenominator" @input="schedulePersist()"></textarea>
            </div>
            <!-- Threshold-specific -->
            <div class="field-row" x-show="sig.signalType === 'sli_threshold'">
              <span class="field-label">Measurement query</span>
              <textarea class="field-input-code" placeholder="Measurement query..."
                x-model="sig.queryNumerator" @input="schedulePersist()"></textarea>
            </div>
            <div class="field-row" x-show="sig.signalType === 'sli_threshold'">
              <span class="field-label">Operator</span>
              <select class="meta-select" x-model="sig.thresholdOperator" @change="schedulePersist()">
                <option value="">Select operator...</option>
                <template x-for="opt in DROPDOWN_OPTS.thresholdOperator" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
            <div class="field-row" x-show="sig.signalType === 'sli_threshold'">
              <span class="field-label">Unit</span>
              <select class="meta-select" x-model="sig.thresholdUnit" @change="schedulePersist()">
                <option value="">Select unit...</option>
                <template x-for="opt in DROPDOWN_OPTS.thresholdUnit" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
            <!-- Not yet selected message -->
            <div class="field-row" x-show="!sig.signalType">
              <span class="field-label" style="color:#E74C3C;font-style:italic;">Select signal type to show measurement fields</span>
            </div>
            <div class="field-row">
              <span class="field-label">Technical Owner</span>
              <input type="text" class="field-input-prose" placeholder="Team or person maintaining this signal..."
                x-model="sig.technicalOwner" @input="schedulePersist()">
            </div>
            <div class="field-row">
              <span class="field-label">Alert Threshold</span>
              <input type="text" class="field-input-prose" placeholder="e.g., 80"
                x-model="sig.alertThreshold" @input="schedulePersist()">
            </div>
            <div class="field-row">
              <span class="field-label">Page Threshold</span>
              <input type="text" class="field-input-prose" placeholder="e.g., 95"
                x-model="sig.pageThreshold" @input="schedulePersist()">
            </div>
          </div>
        </div>
      </template>

      <div class="empty-state" x-show="service.signals.filter(function(s) { return s.layer === 'L1'; }).length === 0">
        No system signals defined yet.
      </div>

      <button class="add-btn" @click="addSignal('L1')">+ Add System Signal</button>
    </div>

    <!-- Section 3.2: Alert Thresholds (MIRROR — L1+L2+L3, filter: layer !== 'L4') -->
    <div class="ac-section" id="section-3-2">
      <div class="ac-label plat">AC 3.2 — ALERT THRESHOLDS</div>
      <div class="ac-desc">Configure alert and page thresholds for all health-type signals (System, Process, Business Health). Business Impact signals do not have thresholds.</div>
      <div class="mirror-note">Mirror of Sections 1.3, 2.2, and 3.1. Signal names are set in their source tabs. Configure alert and page thresholds for each signal.</div>

      <template x-for="sig in service.signals.filter(function(s) { return s.layer !== 'L4'; })" :key="sig.id">
        <div class="card platform-card">
          <div class="card-name-input" style="border:none;cursor:default;background:transparent;font-weight:bold;color:var(--wf-gray-700);"
            x-text="(sig.name || '(unnamed)') + ' (' + layerDisplayName(sig.layer) + ')'"></div>

          <div class="field-list">
            <div class="field-row">
              <span class="field-label">Data Source</span>
              <span style="color:var(--wf-gray-500);font-style:italic;"
                x-text="sig.dataSource || '(not yet defined, set on Dev tab)'"></span>
            </div>
            <div class="field-row">
              <span class="field-label">Alert Threshold</span>
              <input type="text" class="field-input-prose" placeholder="e.g., 80"
                x-model="sig.alertThreshold" @input="schedulePersist()">
            </div>
            <div class="field-row">
              <span class="field-label">Alert Severity</span>
              <select class="meta-select" x-model="sig.alertSeverity" @change="schedulePersist()">
                <template x-for="opt in DROPDOWN_OPTS.severity" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
            <div class="field-row">
              <span class="field-label">Page Threshold</span>
              <input type="text" class="field-input-prose" placeholder="e.g., 95"
                x-model="sig.pageThreshold" @input="schedulePersist()">
            </div>
            <div class="field-row">
              <span class="field-label">Page Severity</span>
              <select class="meta-select" x-model="sig.pageSeverity" @change="schedulePersist()">
                <template x-for="opt in DROPDOWN_OPTS.severity" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
            <div class="field-row">
              <span class="field-label">Operator</span>
              <select class="meta-select" x-model="sig.thresholdOperator" @change="schedulePersist()">
                <option value="">Select operator...</option>
                <template x-for="opt in DROPDOWN_OPTS.thresholdOperator" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
            <div class="field-row">
              <span class="field-label">Unit</span>
              <select class="meta-select" x-model="sig.thresholdUnit" @change="schedulePersist()">
                <option value="">Select unit...</option>
                <template x-for="opt in DROPDOWN_OPTS.thresholdUnit" :key="opt.value">
                  <option :value="opt.value" x-text="opt.label"></option>
                </template>
              </select>
            </div>
          </div>
        </div>
      </template>

      <div class="empty-state" x-show="service.signals.filter(function(s) { return s.layer !== 'L4'; }).length === 0">
        No health-type signals defined yet. Add signals in PO Story, Dev Story, or Platform Story above.
      </div>
    </div>

    <!-- Section 3.3: Alert Routing -->
    <div class="ac-section" id="section-3-3">
      <div class="ac-label plat">AC 3.3 — ALERT ROUTING</div>
      <div class="ac-desc">Configure how alerts are routed when thresholds are crossed: notification targets and escalation policy.</div>

      <div class="card platform-card">
        <div class="field-list">
          <div class="field-row">
            <span class="field-label">Notification Targets</span>
            <textarea class="field-input-code" placeholder="e.g., page:platform-oncall, slack:#service-alerts"
              x-model="service.operational.alertNotificationTargets" @input="schedulePersist()"></textarea>
          </div>
          <div class="field-row">
            <span class="field-label">Escalation Policy</span>
            <textarea class="field-input-prose" placeholder="Escalation rules when alerts are not acknowledged..."
              x-model="service.operational.escalationPolicy" @input="schedulePersist()"></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- Section 3.4: Dashboard -->
    <div class="ac-section" id="section-3-4">
      <div class="ac-label plat">AC 3.4 — DASHBOARD</div>
      <div class="ac-desc">Reference the operational dashboard that visualizes this service's signals.</div>

      <div class="card platform-card">
        <div class="field-list">
          <div class="field-row">
            <span class="field-label">Dashboard URL</span>
            <input type="text" class="field-input-code" placeholder="https://grafana.internal/d/..."
              x-model="service.operational.dashboardUrl" @input="schedulePersist()">
          </div>
          <div class="field-row">
            <span class="field-label">Description</span>
            <textarea class="field-input-prose" placeholder="What does this dashboard show?"
              x-model="service.operational.dashboardDescription" @input="schedulePersist()"></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- Section 3.5: Playbook -->
    <div class="ac-section" id="section-3-5">
      <div class="ac-label plat">AC 3.5 — PLAYBOOK</div>
      <div class="ac-desc">Reference the runbook/playbook for incident response related to this service.</div>

      <div class="card platform-card">
        <div class="field-list">
          <div class="field-row">
            <span class="field-label">Runbook URL</span>
            <input type="text" class="field-input-code" placeholder="https://confluence.internal/..."
              x-model="service.operational.runbookUrl" @input="schedulePersist()">
          </div>
          <div class="field-row">
            <span class="field-label">Description</span>
            <textarea class="field-input-prose" placeholder="What does this playbook cover?"
              x-model="service.operational.runbookDescription" @input="schedulePersist()"></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab 4: How It Works -->
  <div class="tab-panel" x-show="$store.app.activeTab === 'how'" x-data="{ activeLayer: 'l3' }">
    <div class="story-header">
      <div class="story-num how">HOW IT WORKS</div>
      <h2>Business Observability: How It Works</h2>
    </div>

    <!-- Section 1: Who Does What, Layer by Layer -->
    <div class="ac-label">Section 1: Who Does What, Layer by Layer</div>
    <div class="ac-desc">Click each layer to see the persona flow: who defines, implements, and operationalizes the signal.</div>

    <div class="layer-tab-nav">
      <button class="layer-tab-btn" data-layer-btn="l3" :class="{ active: activeLayer === 'l3' }" @click="activeLayer = 'l3'">Business Health Signal</button>
      <button class="layer-tab-btn" data-layer-btn="l4" :class="{ active: activeLayer === 'l4' }" @click="activeLayer = 'l4'">Business Impact Signal</button>
      <button class="layer-tab-btn" data-layer-btn="l2" :class="{ active: activeLayer === 'l2' }" @click="activeLayer = 'l2'">Process Signal</button>
      <button class="layer-tab-btn" data-layer-btn="l1" :class="{ active: activeLayer === 'l1' }" @click="activeLayer = 'l1'">System Signal</button>
    </div>

    <!-- L3 Panel: Credit Check Success Rate (sli_ratio, 3 actors, 8 steps) -->
    <div data-layer-panel="l3" x-show="activeLayer === 'l3'">
      <div style="margin-bottom: 12px; font-size: 13px; color: var(--wf-gray-500);"><strong>Credit Check Success Rate</strong>: 8 steps, PO → Dev → Platform</div>

      <div class="flow-step"><div class="flow-actor po">PO</div><div class="flow-content"><strong>Names the signal:</strong> "Credit Check Success Rate" / "Percentage of credit checks completing successfully" <span class="flow-fields">signal_display_name, description_business</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor po">PO</div><div class="flow-content"><strong>Sets the target:</strong> 85% over 7 days / "Below 85% indicates systemic bureau connectivity issues" <span class="flow-fields">sloTarget, timeWindow, sloTargetRationale</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor dev">Dev</div><div class="flow-content"><strong>Determines measurement type:</strong> sli_ratio (good/total) / Splunk <span class="flow-fields">signal_type, data_source</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor dev">Dev</div><div class="flow-content"><strong>Writes queries:</strong> <code>search index=app_events status=success | stats count</code> / <code>search index=app_events | stats count</code> <span class="flow-fields">query_numerator, query_denominator</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Sets alert thresholds:</strong> Alert at 80%, Page at 70% <span class="flow-fields">alertingThreshold, pageThreshold</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Configures alert:</strong> Uses Dev's query against PO's threshold over PO's time window</div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Builds dashboard panel:</strong> Target line at 85%, alert line at 80%</div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Writes playbook:</strong> When signal degrades → check Customers Blocked (impact) → notify Loan Applicants</div></div>
    </div>

    <!-- L4 Panel: Customers Blocked (business_impact, 3 actors, 5 steps) -->
    <div data-layer-panel="l4" x-show="activeLayer === 'l4'">
      <div style="margin-bottom: 12px; font-size: 13px; color: var(--wf-gray-500);"><strong>Customers Blocked</strong>: 5 steps, PO → Dev → Platform</div>

      <div class="flow-step"><div class="flow-actor po">PO</div><div class="flow-content"><strong>Names the impact:</strong> "Customers Blocked" / "Number of loan applicants unable to proceed" <span class="flow-fields">signal_display_name, description_business</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor po">PO</div><div class="flow-content"><strong>Categorizes the impact:</strong> customer_experience / customers <span class="flow-fields">impact_category, impact_unit</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor dev">Dev</div><div class="flow-content"><strong>Writes quantification query:</strong> business_impact / <code>search index=app_events status=blocked | stats dc(customer_id)</code> / Splunk <span class="flow-fields">signal_type, query_numerator, data_source</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Adds to impact dashboard:</strong> Customer count visualization</div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Adds to playbook escalation:</strong> When Business Health degrades, check this impact for severity</div></div>
    </div>

    <!-- L2 Panel: Credit Check Response Time (sli_threshold, 2 actors, 8 steps) -->
    <div data-layer-panel="l2" x-show="activeLayer === 'l2'">
      <div style="margin-bottom: 12px; font-size: 13px; color: var(--wf-gray-500);"><strong>Credit Check Response Time</strong>: 8 steps, Dev → Platform</div>

      <div class="flow-step"><div class="flow-actor dev">Dev</div><div class="flow-content"><strong>Identifies process signal:</strong> "Credit Check Response Time" / "Average time for credit check completion" <span class="flow-fields">signal_display_name, description_business</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor dev">Dev</div><div class="flow-content"><strong>Sets the target:</strong> 3 sec over 1 hour / "Above 3s indicates bureau latency" <span class="flow-fields">sloTarget, timeWindow, sloTargetRationale</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor dev">Dev</div><div class="flow-content"><strong>Determines measurement type:</strong> sli_threshold / &lt; / 3 / seconds <span class="flow-fields">signal_type, threshold_operator, threshold_value, threshold_unit</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor dev">Dev</div><div class="flow-content"><strong>Writes measurement query:</strong> <code>search index=app_events | stats avg(response_time)</code> / Splunk <span class="flow-fields">query_numerator, data_source</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Sets alert thresholds:</strong> Alert at 5 sec, Page at 10 sec <span class="flow-fields">alertingThreshold, pageThreshold</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Configures alert:</strong> Uses Dev's query against Dev's threshold over Dev's time window</div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Builds dashboard panel:</strong> Target line at 3s, alert line at 5s</div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Writes playbook:</strong> When response time exceeds threshold → investigate bureau connectivity + app performance</div></div>
    </div>

    <!-- L1 Panel: Bureau Connection Health (sli_threshold, 1 actor, 8 steps) -->
    <div data-layer-panel="l1" x-show="activeLayer === 'l1'">
      <div style="margin-bottom: 12px; font-size: 13px; color: var(--wf-gray-500);"><strong>Bureau Connection Health</strong>: 8 steps, Platform</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Identifies system dependency:</strong> "Bureau Connection Health" / "Percentage of successful connections to credit bureau API" <span class="flow-fields">signal_display_name, description_business</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Sets the target:</strong> 99% over 1 hour / "Below 99% indicates network or bureau API issues" <span class="flow-fields">sloTarget, timeWindow, sloTargetRationale</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Determines measurement type:</strong> sli_threshold / &gt; / 99 / percent <span class="flow-fields">signal_type, threshold_operator, threshold_value, threshold_unit</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Writes measurement query:</strong> <code>search index=infra source=bureau_api | stats count(status=200)/count * 100</code> / Splunk <span class="flow-fields">query_numerator, data_source</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Sets alert thresholds:</strong> Alert at 95%, Page at 90% <span class="flow-fields">alertingThreshold, pageThreshold</span></div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Configures alert:</strong> Uses own query against own threshold over own time window</div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Builds dashboard panel:</strong> Target line at 99%, alert line at 95%</div></div>
      <div class="flow-arrow">↓</div>

      <div class="flow-step"><div class="flow-actor plat">Platform</div><div class="flow-content"><strong>Writes playbook:</strong> When connection rate drops → check bureau API → verify network → check for maintenance windows</div></div>
    </div>

    <!-- Section 2: How Failures Cascade -->
    <div class="ac-label" style="margin-top: 2rem;">Section 2: How Failures Cascade</div>
    <div class="ac-desc">One representative signal per layer shows the causal chain from infrastructure to business impact.</div>

    <div class="causal-chain">
      <div class="causal-step">
        <div class="causal-layer l1">System</div>
        <div class="causal-content"><strong>Bureau Connection Health</strong>, target: 99% over 1 hour
          <div class="causal-actor"><span class="actor-badge plat">Platform</span> defines + implements + operationalizes</div>
        </div>
      </div>

      <div class="causal-arrow">↓</div>
      <div style="font-size: 12px; color: var(--wf-gray-500); margin-left: 50px; margin-bottom: 4px;">Credit check requests can't reach the bureau → response times increase</div>

      <div class="causal-step">
        <div class="causal-layer l2">Process</div>
        <div class="causal-content"><strong>Credit Check Response Time</strong>, target: 3s over 1 hour
          <div class="causal-actor"><span class="actor-badge dev">Dev</span> defines + implements <span class="actor-badge plat">Platform</span> operationalizes</div>
        </div>
      </div>

      <div class="causal-arrow">↓</div>
      <div style="font-size: 12px; color: var(--wf-gray-500); margin-left: 50px; margin-bottom: 4px;">Requests that do complete take too long; some time out → success rate drops</div>

      <div class="causal-step">
        <div class="causal-layer l3">Business Health</div>
        <div class="causal-content"><strong>Credit Check Success Rate</strong>, target: 85% over 7 days
          <div class="causal-actor"><span class="actor-badge po">PO</span> defines <span class="actor-badge dev">Dev</span> implements <span class="actor-badge plat">Platform</span> operationalizes</div>
        </div>
      </div>

      <div class="causal-arrow">↓</div>
      <div style="font-size: 12px; color: var(--wf-gray-500); margin-left: 50px; margin-bottom: 4px;">Credit checks aren't returning valid scores → applicants can't proceed</div>

      <div class="causal-step">
        <div class="causal-layer l4">Business Impact</div>
        <div class="causal-content"><strong>Customers Blocked</strong>, customer_experience / customers
          <div class="causal-actor"><span class="actor-badge po">PO</span> defines <span class="actor-badge dev">Dev</span> implements <span class="actor-badge plat">Platform</span> operationalizes</div>
        </div>
      </div>
    </div>

    <div style="margin-top: 16px; padding: 12px 16px; background: var(--wf-gray-50); border-left: 3px solid var(--wf-gray-500); font-size: 13px;"><strong>Diagnostic Direction:</strong> Start at Business Health (is the signal degraded?) → look down to Process (is it slow?) → look down to System (is the infrastructure failing?) → look up to Business Impact (what's the consequence?).</div>

    <!-- Section 3: Signal Correlation Patterns -->
    <div class="ac-label" style="margin-top: 2rem;">Section 3: Signal Correlation Patterns</div>
    <div class="ac-desc">The causal chain above shows ONE incident path. In practice, layers degrade in different combinations. The patterns below tell the on-call team what each combination means.</div>

    <div class="through-line-table-wrapper">
    <table class="through-line-table" id="correlation-table">
      <thead><tr>
        <th>System</th><th>Process</th><th>Business Health</th>
        <th>Pattern</th><th>Urgency</th><th>Diagnosis Direction</th>
      </tr></thead>
      <tbody>
        <tr>
          <td>Healthy</td><td>Healthy</td><td>Healthy</td>
          <td class="sig-name">All Clear</td><td>None</td>
          <td>Normal operations. Establish baselines.</td>
        </tr>
        <tr>
          <td>Healthy</td><td>Healthy</td><td style="font-weight:700">Degraded</td>
          <td class="sig-name">Silent Business Failure</td><td style="font-weight:700">High</td>
          <td>Business logic, external dependencies, config changes</td>
        </tr>
        <tr>
          <td style="font-weight:700">Degraded</td><td>Healthy</td><td>Healthy</td>
          <td class="sig-name">Infrastructure Noise</td><td>Low</td>
          <td>Monitor. Don't escalate unless it propagates.</td>
        </tr>
        <tr>
          <td style="font-weight:700">Critical</td><td style="font-weight:700">Degraded</td><td style="font-weight:700">Degraded</td>
          <td class="sig-name">Infrastructure Cascade</td><td style="font-weight:700">Critical</td>
          <td>Fix System infrastructure. Business impact is consequence.</td>
        </tr>
        <tr>
          <td>Healthy</td><td style="font-weight:700">Degraded</td><td style="font-weight:700">Degraded</td>
          <td class="sig-name">Process Failure</td><td style="font-weight:700">High</td>
          <td>Application code, recent deployments, data quality</td>
        </tr>
        <tr>
          <td style="font-weight:700">Degraded</td><td style="font-weight:700">Degraded</td><td style="font-weight:700">Degraded</td>
          <td class="sig-name">Multi-Layer Degradation</td><td style="font-weight:700">Critical</td>
          <td>Stabilize System layer first, then reassess upper layers</td>
        </tr>
        <tr>
          <td>Healthy</td><td style="font-weight:700">Degraded</td><td>Healthy</td>
          <td class="sig-name">Contained Process Issue</td><td>Medium</td>
          <td>Non-critical paths. Fix but don't escalate.</td>
        </tr>
      </tbody>
    </table>
    </div>

  </div>

  <!-- Tab 5: Service Status -->
  <div class="tab-panel" x-show="$store.app.activeTab === 'status'">
    <div class="story-header">
      <div class="story-num status">SERVICE STATUS</div>
      <h2>Service Status: Completeness Evaluation</h2>
    </div>

    <!-- Signal Journey Table -->
    <div class="ac-label">Signal Journey</div>
    <div class="ac-desc">How each signal flows through the three-actor chain.</div>

    <div class="through-line-table-wrapper">
    <table class="through-line-table" id="signal-journey-table">
      <thead><tr>
        <th>Signal</th><th>Layer</th><th>Type</th>
        <th>PO Defined</th><th>Dev Implemented</th><th>Platform Operationalized</th>
      </tr></thead>
      <tbody>
        <template x-for="sig in (service ? service.signals : [])" :key="sig.id">
          <tr>
            <td class="sig-name" x-text="sig.name || '(unnamed)'"></td>
            <td x-text="layerDisplayName(sig.layer)"></td>
            <td x-text="signalTypeLabel(sig.signalType)"></td>
            <td x-text="signalJourneyPO(sig)"></td>
            <td x-text="signalJourneyDev(sig)"></td>
            <td x-text="signalJourneyPlat(sig)"></td>
          </tr>
        </template>
      </tbody>
    </table>
    </div>

    <!-- Completeness Evaluation -->
    <div class="ac-label" style="margin-top: 2rem;">Completeness Evaluation</div>
    <div class="ac-desc">Runtime evaluation of signal coverage, field completeness, and operational readiness.</div>

    <div id="completeness-eval" x-data="{
      get layerCov() { return evaluateLayerCoverage(service ? service.signals : []) },
      get sigComplete() { return evaluateSignalCompleteness(service ? service.signals : []) },
      get thresholds() { return evaluateThresholds(service ? service.signals : []) },
      get traceability() { return evaluateTraceability(service ? service.signals : [], service ? service.stakeholders : []) },
      get opsReady() { return evaluateOperational(service ? service.operational : null) }
    }">

      <!-- Dim 1: Layer Coverage -->
      <div class="completeness-dim">
        <strong>Layer Coverage: <span x-text="layerCov.filter(function(l) { return l.count > 0 }).length + '/4 layers'"></span></strong>
        <table class="through-line-table" style="margin-top: 8px; font-size: 13px;">
          <thead><tr><th>Signal Layer</th><th>Signals</th></tr></thead>
          <tbody>
            <template x-for="l in layerCov" :key="l.layer">
              <tr>
                <td x-text="l.label"></td>
                <td :class="l.count > 0 ? 'completeness-ok' : 'completeness-missing'" x-text="l.count"></td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>

      <!-- Dim 2: Per-Signal Completeness -->
      <div class="completeness-dim">
        <strong>Per-Signal Completeness: <span x-text="sigComplete.filter(function(s) { return s.filled === s.total }).length + '/' + sigComplete.length + ' fully defined'"></span></strong>
        <template x-if="sigComplete.length > 0">
          <table class="through-line-table" style="margin-top: 8px; font-size: 13px;">
            <thead><tr><th>Signal</th><th>Type</th><th>Layer</th><th>Fields</th><th>Missing</th></tr></thead>
            <tbody>
              <template x-for="s in sigComplete" :key="s.name + s.layer">
                <tr>
                  <td class="sig-name" x-text="s.name"></td>
                  <td x-text="signalTypeLabel(s.type)"></td>
                  <td x-text="layerDisplayName(s.layer)"></td>
                  <td :class="s.filled === s.total ? 'completeness-ok' : ''" x-text="s.filled + '/' + s.total"></td>
                  <td class="completeness-missing" x-text="s.missing.join(', ')"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </template>
      </div>

      <!-- Dim 3: Threshold Evaluation -->
      <div class="completeness-dim">
        <strong>Health Signal Thresholds: <span x-text="thresholds.defined + '/' + thresholds.total + ' defined'"></span></strong>
        <template x-if="thresholds.missing.length > 0">
          <div class="completeness-missing" x-text="'Missing: ' + thresholds.missing.join(', ')"></div>
        </template>
      </div>

      <!-- Dim 4: Stakeholder-Impact Traceability -->
      <div class="completeness-dim">
        <strong>Stakeholder-Impact Traceability: <span x-text="traceability.traced + '/' + traceability.total + ' traced'"></span></strong>
        <template x-if="traceability.untraced.length > 0">
          <div class="completeness-missing" x-text="'Untraced: ' + traceability.untraced.join(', ')"></div>
        </template>
      </div>

      <!-- Dim 5: Operational Readiness -->
      <div class="completeness-dim">
        <strong>Operational Readiness: <span x-text="opsReady.defined + '/' + opsReady.total + ' defined'"></span></strong>
        <template x-if="opsReady.missing.length > 0">
          <div class="completeness-missing" x-text="'Missing: ' + opsReady.missing.join(', ')"></div>
        </template>
      </div>

    </div>
  </div>

  <!-- Tab 6: Dashboard Preview -->
  <div class="tab-panel" x-show="$store.app.activeTab === 'flow'">
    <div class="story-header">
      <div class="story-num flow">DASHBOARD PREVIEW</div>
      <h2>Dashboard Preview: Operational Output</h2>
    </div>

    <!-- Section A: Service Identity Header -->
    <div class="dash-section" style="border-left: 4px solid #2980B9; position: relative;">
      <div class="dash-section-heading">
        <span x-text="service ? (service.identity.serviceName || '(no service name)') : ''"></span>
        <span class="dash-ac-ref">AC 1.1</span>
      </div>
      <p style="font-size: 14px; color: var(--wf-gray-700); margin-bottom: 12px;"
         x-text="service ? (service.identity.description || '') : ''"></p>
      <div style="display: flex; gap: 24px; flex-wrap: wrap;">
        <div><span class="dash-meta-label">Owner</span><br>
          <span style="font-size: 13px;" x-text="service ? (service.identity.technicalOwner || '') : ''"></span></div>
        <div><span class="dash-meta-label">Product</span><br>
          <span style="font-size: 13px;" x-text="service ? (service.identity.productLine || '') : ''"></span></div>
        <div><span class="dash-meta-label">Service ID</span><br>
          <span style="font-size: 13px;" x-text="service ? (service.identity.serviceId || '') : ''"></span></div>
      </div>
    </div>

    <!-- Section B: Stakeholder Expectations -->
    <div class="dash-section" x-show="service && service.stakeholders.length > 0">
      <div class="dash-section-heading">
        Stakeholder Expectations
        <span class="dash-ac-ref">AC 1.2</span>
      </div>
      <table class="dash-stakeholder-table">
        <thead><tr>
          <th>Stakeholder</th><th>Expectation</th><th>If It Fails</th><th>Category</th><th>Priority</th>
        </tr></thead>
        <tbody>
          <template x-for="stk in (service ? service.stakeholders : [])" :key="stk.id">
            <tr>
              <td x-text="stk.stakeholder || '(unnamed)'"></td>
              <td x-text="stk.expectationStatement || ''"></td>
              <td x-text="stk.impactDescription || ''"></td>
              <td><span style="padding: 2px 8px; border-radius: 3px; font-size: 11px; font-weight: 600;"
                        :style="categoryStyle(stk.impactCategory)"
                        x-text="categoryName(stk.impactCategory)"></span></td>
              <td x-text="stk.priority || ''"></td>
            </tr>
          </template>
        </tbody>
      </table>
    </div>

    <!-- Section C: Signal Health: Four Layer Model -->
    <div class="dash-section">
      <div class="dash-section-heading">
        Signal Health: Four Layer Model
        <span class="dash-ac-ref">AC 2+3</span>
      </div>

      <template x-for="layerDef in [
        {layer:'L1',label:'SYSTEM HEALTH',badge:'var(--wf-gray-500)',border:'#E67E22'},
        {layer:'L2',label:'PROCESS HEALTH',badge:'#935116',border:'#27AE60'},
        {layer:'L3',label:'BUSINESS HEALTH',badge:'#922B21',border:'#2980B9'},
        {layer:'L4',label:'BUSINESS IMPACT',badge:'#1A5276',border:'#2980B9'}
      ]" :key="layerDef.layer">
        <div class="dash-layer-card" x-show="(service ? service.signals : []).filter(function(s) { return s.layer === layerDef.layer }).length > 0"
             :style="'border-left: 4px solid ' + layerDef.border">
          <div style="margin-bottom: 8px;">
            <span class="dash-layer-badge" :style="'background:' + layerDef.badge" x-text="layerDef.label"></span>
          </div>
          <template x-for="sig in (service ? service.signals : []).filter(function(s) { return s.layer === layerDef.layer })" :key="sig.id">
            <div :class="layerDef.layer === 'L4' ? 'dash-signal-row-impact' : 'dash-signal-row'">
              <div class="dash-status-dot" style="background: var(--wf-gray-500);"></div>
              <div style="font-size: 13px;">
                <strong x-text="sig.name || '(unnamed)'"></strong>
                <span style="color: var(--wf-gray-500); font-size: 12px;" x-text="sig.whatItTellsMe ? ': ' + sig.whatItTellsMe : ''"></span>
              </div>
              <template x-if="layerDef.layer !== 'L4'">
                <div style="font-size: 12px; color: var(--wf-gray-500);" x-text="'Target: ' + formatTarget(sig)"></div>
              </template>
              <template x-if="layerDef.layer === 'L4'">
                <div style="font-size: 12px; color: var(--wf-gray-500);" x-text="sig.impactUnit || ''"></div>
              </template>
            </div>
          </template>
        </div>
      </template>
    </div>

    <!-- Section D: Business Impact (If Degraded) -->
    <div class="dash-section" x-show="(service ? service.signals : []).filter(function(s) { return s.layer === 'L4' }).length > 0">
      <div class="dash-section-heading">
        Business Impact (If Degraded)
        <span class="dash-ac-ref">AC 2.4</span>
      </div>
      <div class="dash-impact-grid">
        <template x-for="sig in (service ? service.signals : []).filter(function(s) { return s.layer === 'L4' })" :key="sig.id">
          <div class="dash-impact-card" :style="'border-left: 4px solid ' + ((CATEGORY_COLORS[sig.impactCategory] || {}).dot || 'var(--wf-gray-500)')">
            <div style="font-size: 11px; font-weight: 600; text-transform: uppercase; color: var(--wf-gray-500); margin-bottom: 4px;"
                 x-text="categoryName(sig.impactCategory)"></div>
            <div style="font-size: 13px; margin-bottom: 4px;"
                 x-text="dashImpactDescription(sig, service ? service.stakeholders : []) || sig.whatItTellsMe || ''"></div>
            <div style="font-size: 12px; color: var(--wf-gray-500);" x-text="sig.impactUnit ? 'Unit: ' + sig.impactUnit : ''"></div>
          </div>
        </template>
      </div>
    </div>

    <!-- Section E: Operations -->
    <div class="dash-section" style="border-left: 4px solid #E67E22;">
      <div class="dash-section-heading">
        Operations
        <span class="dash-ac-ref">AC 3</span>
      </div>

      <div style="margin-bottom: 12px;">
        <span class="dash-meta-label">Alert Targets</span><br>
        <span style="font-size: 13px;" x-text="service && service.operational.alertNotificationTargets ? service.operational.alertNotificationTargets : '(not set)'"></span>
      </div>

      <template x-if="(service ? service.signals : []).filter(function(s) { return s.layer !== 'L4' && s.alertThreshold }).length > 0">
        <div style="margin-bottom: 12px;">
          <span class="dash-meta-label">Threshold Configuration</span>
          <table class="through-line-table" style="margin-top: 8px; font-size: 13px;">
            <thead><tr><th>Signal</th><th>Alert</th><th>Page</th></tr></thead>
            <tbody>
              <template x-for="sig in (service ? service.signals : []).filter(function(s) { return s.layer !== 'L4' && s.alertThreshold })" :key="sig.id">
                <tr>
                  <td class="sig-name" x-text="sig.name || '(unnamed)'"></td>
                  <td>
                    <span x-text="formatThreshold(sig.alertThreshold, sig)"></span>
                    <span x-show="sig.alertSeverity"
                      class="severity-badge"
                      :class="'severity-' + sig.alertSeverity"
                      x-text="sig.alertSeverity"></span>
                  </td>
                  <td>
                    <span x-text="formatThreshold(sig.pageThreshold, sig)"></span>
                    <span x-show="sig.pageSeverity"
                      class="severity-badge"
                      :class="'severity-' + sig.pageSeverity"
                      x-text="sig.pageSeverity"></span>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </template>

      <div class="dash-ops-grid">
        <div>
          <span class="dash-meta-label">Dashboard URL</span><br>
          <span style="font-size: 13px;" x-text="service && service.operational.dashboardUrl ? service.operational.dashboardUrl : '(not set)'"></span>
        </div>
        <div>
          <span class="dash-meta-label">Runbook URL</span><br>
          <span style="font-size: 13px;" x-text="service && service.operational.runbookUrl ? service.operational.runbookUrl : '(not set)'"></span>
        </div>
      </div>
    </div>

  </div>

  </div><!-- /FORM VIEW -->

</div>

<!-- Export Status Bar -->
<div class="export-status-bar" x-data="{
  get changes() { return $store.app.meta.changesSinceExport || 0 },
  get lastExport() { return $store.app.meta.lastExport },
  get statusColor() {
    if (!this.lastExport && this.changes === 0 && Object.keys($store.app.services).length === 0) return 'green';
    if (!this.lastExport) return 'red';
    if (this.changes === 0) return 'green';
    if (this.changes <= 10) return 'amber';
    return 'red';
  },
  get statusText() {
    if (!this.lastExport && Object.keys($store.app.services).length === 0) return 'No services yet';
    if (!this.lastExport) return 'Never exported';
    if (this.changes === 0) return 'Last exported: ' + formatTimestamp(this.lastExport);
    return 'Last exported: ' + formatTimestamp(this.lastExport) + ' (' + this.changes + ' changes since)';
  }
}">
  <span class="export-status-text" :class="statusColor" x-text="statusText"></span>
  <div class="export-btn-bar" x-show="$store.app.activeServiceId">
    <button @click="exportService()">Export JSON</button>
    <button @click="exportMarkdown()">Export Markdown</button>
  </div>
</div>

<!-- 5a. SVG bracket system for persona flow graphic -->
<script>
/* SVG bracket system — rounded corners + arrowheads */
function createBrackets() {
    var container = document.getElementById('persona-rows');
    if (!container || window.innerWidth < 768) return;
    container.querySelectorAll('.bracket-svg').forEach(function(el) { el.remove(); });
    var cRect = container.getBoundingClientRect();
    var w = container.offsetWidth;
    var h = container.offsetHeight;
    function mid(sel) {
        var el = container.querySelector('[data-label="' + sel + '"]');
        var r = el.getBoundingClientRect();
        return r.top + r.height / 2 - cRect.top;
    }
    var poY  = mid('po');
    var devY = mid('dev');
    var opsY = mid('ops');
    var fbY  = mid('feedback');
    var ns = 'http://www.w3.org/2000/svg';
    var svg = document.createElementNS(ns, 'svg');
    svg.classList.add('bracket-svg');
    svg.style.cssText = 'position:absolute;top:0;left:0;width:' + w + 'px;height:' + h + 'px;pointer-events:none;margin-top:0;z-index:5;';
    svg.setAttribute('viewBox', '0 0 ' + w + ' ' + h);
    var color = '#9CA3AF';
    var sw = 2;
    var cr = 8;
    var arm = 18;
    var ts = 6;
    var lx = 3;
    var rx = w - 3;
    function addPath(d) {
        var p = document.createElementNS(ns, 'path');
        p.setAttribute('d', d);
        p.setAttribute('stroke', color);
        p.setAttribute('stroke-width', sw);
        p.setAttribute('fill', 'none');
        p.setAttribute('stroke-linecap', 'round');
        p.setAttribute('stroke-linejoin', 'round');
        svg.appendChild(p);
    }
    function addTriangle(tipX, tipY, dir) {
        var p = document.createElementNS(ns, 'path');
        var d;
        if (dir === 'right') {
            d = 'M' + (tipX - ts*1.4) + ',' + (tipY - ts) +
                ' L' + tipX + ',' + tipY +
                ' L' + (tipX - ts*1.4) + ',' + (tipY + ts) + ' Z';
        } else {
            d = 'M' + (tipX + ts*1.4) + ',' + (tipY - ts) +
                ' L' + tipX + ',' + tipY +
                ' L' + (tipX + ts*1.4) + ',' + (tipY + ts) + ' Z';
        }
        p.setAttribute('d', d);
        p.setAttribute('fill', color);
        svg.appendChild(p);
    }
    addPath(
        'M ' + (lx + arm) + ',' + poY +
        ' H ' + (lx + cr) +
        ' Q ' + lx + ',' + poY + ' ' + lx + ',' + (poY + cr) +
        ' V ' + (fbY - cr) +
        ' Q ' + lx + ',' + fbY + ' ' + (lx + cr) + ',' + fbY +
        ' H ' + (lx + arm)
    );
    addPath('M ' + lx + ',' + devY + ' H ' + (lx + arm));
    addPath('M ' + lx + ',' + opsY + ' H ' + (lx + arm));
    addTriangle(lx + arm + ts, poY, 'right');
    addTriangle(lx + arm + ts, devY, 'right');
    addTriangle(lx + arm + ts, opsY, 'right');
    addPath(
        'M ' + (rx - arm) + ',' + poY +
        ' H ' + (rx - cr) +
        ' Q ' + rx + ',' + poY + ' ' + rx + ',' + (poY + cr) +
        ' V ' + (fbY - cr) +
        ' Q ' + rx + ',' + fbY + ' ' + (rx - cr) + ',' + fbY +
        ' H ' + (rx - arm)
    );
    addPath('M ' + rx + ',' + devY + ' H ' + (rx - arm));
    addPath('M ' + rx + ',' + opsY + ' H ' + (rx - arm));
    addTriangle(rx - arm - ts, fbY, 'left');
    container.appendChild(svg);
}
document.fonts.ready.then(function() {
    requestAnimationFrame(function() { requestAnimationFrame(createBrackets); });
});
window.addEventListener('resize', createBrackets);
if (document.getElementById('persona-rows')) {
    new ResizeObserver(createBrackets).observe(document.getElementById('persona-rows'));
}
</script>

<!-- 5. Manual Alpine start (after DOM is ready) -->
<script>
Alpine.start();
</script>

</body>
</html>
